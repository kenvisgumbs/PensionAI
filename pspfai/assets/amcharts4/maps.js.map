{"version":3,"sources":["webpack:///../../../../../src/.internal/charts/map/ZoomControl.ts","webpack:///../../../../../src/.internal/charts/map/MapObject.ts","webpack:///../../../../../src/.internal/charts/map/MapImage.ts","webpack:///../../../../../src/.internal/charts/map/MapPolygon.ts","webpack:///../../../../../src/.internal/charts/map/Geo.ts","webpack:///../../../../../../src/.internal/charts/map/projections/Projection.ts","webpack:///../../../../../src/.internal/charts/types/MapChart.ts","webpack:///../../../../../src/.internal/charts/map/MapLineObject.ts","webpack:///../../../../../src/.internal/charts/map/MapLine.ts","webpack:///../../../../../src/.internal/charts/map/MapSpline.ts","webpack:///../../../../../src/.internal/charts/map/MapArc.ts","webpack:///../../../../../src/.internal/charts/map/MapUtils.ts","webpack:///../../../../../src/.internal/charts/map/MapPolygonSeries.ts","webpack:///../../../../../src/.internal/charts/map/MapLineSeries.ts","webpack:///../../../../../src/.internal/charts/map/MapSplineSeries.ts","webpack:///../../../../../src/.internal/charts/map/MapImageSeries.ts","webpack:///../../../../../src/.internal/charts/map/MapArcSeries.ts","webpack:///../../../../../../src/.internal/charts/map/projections/Mercator.ts","webpack:///../../../../../../src/.internal/charts/map/projections/Miller.ts","webpack:///../../../../../../src/.internal/charts/map/projections/Eckert6.ts","webpack:///../../../../../../src/.internal/charts/map/projections/Orthographic.ts","webpack:///./maps.js","webpack:///../../../../../src/.internal/charts/map/SmallMap.ts"],"names":["__webpack_require__","d","__webpack_exports__","ZoomControl","__WEBPACK_IMPORTED_MODULE_0_tslib__","__WEBPACK_IMPORTED_MODULE_1__core_Container__","__WEBPACK_IMPORTED_MODULE_2__core_elements_Button__","__WEBPACK_IMPORTED_MODULE_3__core_elements_RoundedRectangle__","__WEBPACK_IMPORTED_MODULE_4__core_utils_Disposer__","__WEBPACK_IMPORTED_MODULE_5__core_utils_Keyboard__","__WEBPACK_IMPORTED_MODULE_6__core_interaction_Interaction__","__WEBPACK_IMPORTED_MODULE_7__core_utils_Percent__","__WEBPACK_IMPORTED_MODULE_8__core_Registry__","__WEBPACK_IMPORTED_MODULE_9__core_utils_InterfaceColorSet__","_super","_this","call","this","_chart","className","align","valign","layout","padding","interfaceColors","plusButton","createChild","shouldClone","label","text","slider","background","fill","getFor","fillOpacity","events","on","handleBackgroundClick","updateThumbSize","thumb","draggable","handleThumbDrag","minusButton","role","readerLive","readerTitle","language","translate","applyTheme","event","property","fixLayout","undefined","_disposers","push","prototype","x","y","width","height","Object","marginTop","marginBottom","toFront","toBack","minX","maxX","minY","maxY","sprite","target","spritePoint","chart","maxPower","Math","log","maxZoomLevel","LN2","minPower","minZoomLevel","power","pixelHeight","zoomLevel","pow","zoomToGeoPoint","zoomGeoPoint","defineProperty","get","set","updateThumb","zoomOut","body","ev","topParent","hasFocused","isKey","isFocused","zoomIn","minHeight","min","stepCount","visible","minWidth","pixelWidth","isDown","step","pixelY","pixelX","createBackground","registeredClasses","MapObject_MapObject","MapObject","isMeasured","clickable","tslib_es6","validate","series","itemReaderText","Container","Registry","MapImage_MapImage","MapImage","getPropertyValue","value","setPropertyValue","validatePosition","Type","latitude","longitude","moveTo","projection","convert","MapPolygon_MapPolygon","MapPolygon","polygon","Polygon","InterfaceColorSet","stroke","strokeOpacity","tooltipPosition","multiGeoPolygon","points","projectGeoArea","measureElement","dataItem","north","south","east","west","normalizePoint","geoPoint","wrapAngleTo180","asin","sin","utils_Math","latitude180","abs","normalizeMultiline","multiline","multiline_1","multiline_1_1","next","done","segment","segment_1","segment_1_1","point","angle","geoToPoint","Projection_Projection","Projection","deltaLongitude","deltaLatitude","deltaGama","centerPoint","scale","geoArea","clippedGeoArea","clipGeoArea","convertGeoArea","projectGeoLine","geoLine","convertGeoLine","clipGeoLine","getClipRectangle1","getClipRectangle2","getRect1","getRect2","clippedLine","clipRectangle1","clipRectangle2","i","len","length","clippedSegments","clipLine","concat","clippedSegments2","clippedArea","rect1","rect2","surface","hole","clippedAreas","surfaceRect","getExtremes","isInside","isOutside","clippedSurface1","clip","clippedHole1","clippedSurface2","clippedHole2","clippedAreas_1","clippedAreas_1_1","area","convertedPoints","convertedAreaPoints","convertedSurface","s","slen","convertedHole","hlen","convertedSegmentPoints","rotate","pointInRadians","project","invert","unproject","unrotate","lambda","phi","deltaGamma","deltaLambda","deltaPhi","cosDeltaPhi","cos","sinDeltaPhi","cosDeltaGamma","sinDeltaGamma","cosPhi","z","k","atan2","subjectPolyline","clipPolygon","cp1","cp2","e","inside","p","intersection","dc","dp","n1","n2","n3","j","inputList","subjectPolygon","outputList","geoPoints","r1","r2","intermediatePoint","pointA","pointB","position","phi1","lambda1","phi2","lambda2","sinPhi1","cosPhi1","sinLambda1","cosLambda1","sinPhi2","cosPhi2","sinLambda2","cosLambda2","a","delta","sqrt","A","B","phi3","lambda3","MapChart_MapChartDataItem","MapChartDataItem","SerialChart","MapChart_MapChart","MapChart","scaleRatio","zoomDuration","zoomEasing","Ease","_prevZoomGeoPoint","maxPanOut","homeZoomLevel","zoomStep","once","handleAllInited","seriesContainer","inert","resizable","handleMapTransform","handleDoubleHit","handleDrag","zIndex","updateExtremes","chartContainer","parent","inited","_mapAnimation","stop","updateScaleRatio","_zoomGeoPointReal","each","updateTooltipBounds","chartContainerBg","dragStart","interactions","downPointers","getIndex","dragStop","focusable","handleMapDown","Interaction","_zoomControl","Keyboard","getEventKey","pan","mouseWheelBehavior","goHome","ww","seriesWidth","hh","seriesHeight","maxWidth","max","maxHeight","applyInternalDefaults","svgPoint","Utils","htmlContainer","svgContainer","cssScale","svgPointToGeo","handleWheel","shift","_mouseWheelDisposer","dispose","wheelable","invalidateProjection","pWest","pEast","pNorth","pSouth","Iterator","iterator","northPoint","southPoint","westPoint","eastPoint","vScale","innerWidth","hScale","innerHeight","Infinity","projectionScaleChanged","northPoint2","westPoint2","_centerGeoPoint","definedBBox","invalidate","dispatch","seriesPoint","seriesPointToGeo","geoPointToSVG","geoPointToSeries","_geodata","geodata","invalidateData","_dataUsers","center","duration","mapPoint","animate","to","pixelPaddingLeft","pixelPaddingTop","zoomToMapObject","mapObject","dataItem_1","bbox","polygonPoint","zoomToRectangle","level","_prevZoomLevel","_smallMap","smallMap","SmallMap","removeDispose","zoomControl","createSeries","MapSeries","_dataSources","getDataSource","component","loadData","setDataSourceEvents","processConfig","config","createClassInstance","type","configOrder","b","asIs","field","homeGeoPoint","centerGeoPoint","setPaper","paper","hideOverflow","setLegend","legend","MapLineObject_MapLineObject","MapLineObject","adjustRotation","mapLine","positionToPoint","rotation","MapLine_MapLine","MapLine","createLine","line","Color","shortestDistance","Polyline","multiGeoLine","images","image","map","hasKey","getKey","imagesToConnect","_a","_b","newMultiGeoLine","newGeoLine","plen","geoPointA","geoPointB","previousPoint","segments","_arrow","lineObjects","handleGlobalScale","_lineObjects","List","handleLineObjectAdded","template","mapLineObject","newValue","arrow","triangle","Triangle","Percent","horizontalCenter","verticalCenter","copyFrom","source","clone","getTooltipX","getTooltipY","MapSpline_MapSpline","MapSpline","Polyspline","tensionX","tensionY","MapArc_MapArc","MapArc","Polyarc","multiPolygonToGeo","multiPolygon","multiGeoArea","multiPointToGeo","multiLineToGeo","multiLine","pointToGeo","MapPolygonSeries_MapPolygonSeriesDataItem","MapPolygonSeriesDataItem","_mapPolygon","mapPolygon_1","mapPolygons","create","addSprite","Disposer","removeValue","_polygon","_multiPolygon","_geoPolygon","geoPolygon","_multiGeoPolygon","updateAreaExtremes","mapPolygon","MapPolygonSeries_MapPolygonSeries","MapPolygonSeries","parsingStepDuration","dataFields","createDataItem","processIncExc","clear","validateData","data","_parseDataFrom","useGeodata","geoJSON","features","indexOf","geometry","console","feature","id_1","id","this_1","checkInclude","include","exclude","coordinates","dataObject","utils_Array","properties","dataItems","moveValue","_mapPolygons","polygonTemplate","handleObjectAdded","getPolygonById","dataContext","MapLineSeries_MapLineSeriesDataItem","MapLineSeriesDataItem","_mapLine","mapLine_1","mapLines","_line","_multiLine","_geoLine","_multiGeoLine","updateLineExtremes","MapLineSeries_MapLineSeries","MapLineSeries","_mapLines","lineTemplate","MapSplineSeries_MapSplineSeriesDataItem","MapSplineSeriesDataItem","MapSplineSeries_MapSplineSeries","MapSplineSeries","MapImageSeries_MapImageSeriesDataItem","MapImageSeriesDataItem","_mapImage","mapImage_1","mapImages","_point","_geoPoint","mapImage","MapImageSeries_MapImageSeries","MapImageSeries","multiPoint","multiGeoPoint","_mapImages","validateDataElement","MapArcSeries_MapArcSeriesDataItem","MapArcSeriesDataItem","MapArcSeries_MapArcSeries","MapArcSeries","Mercator_Mercator","Mercator","atan","exp","PI","tan","Miller_Miller","Miller","Eckert6_Eckert6","Eckert6","Orthographic_Orthographic","Orthographic","len_1","prevPoint","i_1","extraPoints","splice","apply","window","am4maps","maps_namespaceObject","__WEBPACK_IMPORTED_MODULE_2__core_elements_Rectangle__","__WEBPACK_IMPORTED_MODULE_3__core_utils_List__","__WEBPACK_IMPORTED_MODULE_5__core_Registry__","__WEBPACK_IMPORTED_MODULE_6__core_utils_Color__","__WEBPACK_IMPORTED_MODULE_7__core_utils_InterfaceColorSet__","__WEBPACK_IMPORTED_MODULE_8__core_utils_Utils__","__WEBPACK_IMPORTED_MODULE_9__core_utils_Type__","percentHeight","percentWidth","margin","moveToPosition","updateMapSize","rectangle","strokeWidth","_series","handleSeriesAdded","handleSeriesRemoved","contains","newSeries","dataUsers","interactionsEnabled","rectPoint","updateRectangle","ceil","afterDraw","maskRectangle"],"mappings":";;;;;;;;;;;;;;;;;;;uEAAAA,EAAAC,EAAAC,EAAA,sBAAAC,IAAA,IAAAC,EAAAJ,EAAA,QAAAK,EAAAL,EAAA,QAAAM,EAAAN,EAAA,QAAAO,EAAAP,EAAA,QAAAQ,EAAAR,EAAA,QAAAS,EAAAT,EAAA,QAAAU,EAAAV,EAAA,QAAAW,EAAAX,EAAA,QAAAY,EAAAZ,EAAA,QAAAa,EAAAb,EAAA,QA8DAG,EAAA,SAAAW,GAkDC,SAAAX,IAAA,IAAAY,EACCD,EAAAE,KAAAC,OAAOA,KAXEF,EAAAG,OAAyC,IAAIV,EAAA,EAatDO,EAAKI,UAAY,cAEjBJ,EAAKK,MAAQ,QACbL,EAAKM,OAAS,SAEdN,EAAKO,OAAS,WACdP,EAAKQ,QAAQ,EAAG,EAAG,EAAG,GAEtB,IAAIC,EAAkB,IAAIX,EAAA,EAEtBY,EAAqBV,EAAKW,YAAYpB,EAAA,GAC1CmB,EAAWE,aAAc,EACzBF,EAAWG,MAAMC,KAAO,IAExBd,EAAKU,WAAaA,EAElB,IAAIK,EAAoBf,EAAKW,YAAYrB,EAAA,GACzCyB,EAAOH,aAAc,EACrBG,EAAOC,WAAWC,KAAOR,EAAgBS,OAAO,yBAChDH,EAAOC,WAAWG,YAAc,IAChCJ,EAAOC,WAAWI,OAAOC,GAAG,MAAOrB,EAAKsB,sBAAuBtB,GAAM,GACrEe,EAAOK,OAAOC,GAAG,cAAerB,EAAKuB,gBAAiBvB,GAAM,GAC5DA,EAAKe,OAASA,EAEd,IAAIS,EAAgBT,EAAOJ,YAAYpB,EAAA,GACvCiC,EAAMZ,aAAc,EACpBY,EAAMhB,QAAQ,EAAG,EAAG,EAAG,GACvBgB,EAAMC,WAAY,EAClBD,EAAMJ,OAAOC,GAAG,OAAQrB,EAAK0B,gBAAiB1B,GAAM,GACpDA,EAAKwB,MAAQA,EAEb,IAAIG,EAAsB3B,EAAKW,YAAYpB,EAAA,UAC3CoC,EAAYf,aAAc,EAC1Be,EAAYd,MAAMC,KAAO,IAEzBd,EAAK2B,YAAcA,EAGnB3B,EAAKwB,MAAMI,KAAO,SAClB5B,EAAKwB,MAAMK,WAAa,SAGxB7B,EAAKwB,MAAMM,YAAc9B,EAAK+B,SAASC,UAAU,qCACjDhC,EAAK2B,YAAYG,YAAc9B,EAAK+B,SAASC,UAAU,0BACvDhC,EAAKU,WAAWoB,YAAc9B,EAAK+B,SAASC,UAAU,2BAEtDhC,EAAKiC,aAELjC,EAAKoB,OAAOC,GAAG,kBAAmB,SAACa,GACZ,UAAlBA,EAAMC,UACTnC,EAAKoC,kBAEJC,GAAW,GAEdrC,EAAKsC,WAAWC,KAAKvC,EAAKG,QAE1BH,EAAKoC,cA4PP,OAzWiC/C,EAAA,EAAAD,EAAAW,GAgHtBX,EAAAoD,UAAAJ,UAAV,WAEC,IAAI1B,EAAaR,KAAKQ,WAClBiB,EAAczB,KAAKyB,YAEnBH,EAAQtB,KAAKsB,MACbT,EAASb,KAAKa,OAElBL,EAAW+B,OAAIJ,EACf3B,EAAWgC,OAAIL,EAEfV,EAAYc,OAAIJ,EAChBV,EAAYe,OAAIL,EAEhBb,EAAMiB,OAAIJ,EACVb,EAAMkB,OAAIL,EAEVtB,EAAO0B,OAAIJ,EACXtB,EAAO2B,OAAIL,EAEX3B,EAAWF,QAAQ,EAAG,GAAI,EAAG,IAC7BmB,EAAYnB,QAAQ,EAAG,GAAI,EAAG,IAE9BmB,EAAYd,MAAMR,MAAQ,SAC1BsB,EAAYd,MAAMP,OAAS,SAE3BI,EAAWG,MAAMR,MAAQ,SACzBK,EAAWG,MAAMP,OAAS,SAEP,YAAfJ,KAAKK,QACRL,KAAKyC,MAAQ,GACbzC,KAAK0C,YAASP,EAEdV,EAAYgB,MAAQE,OAAAjD,EAAA,EAAAiD,CAAQ,KAC5BlB,EAAYiB,YAASP,EAErBb,EAAMmB,MAAQE,OAAAjD,EAAA,EAAAiD,CAAQ,KACtBrB,EAAMoB,YAASP,EAEf3B,EAAWiC,MAAQE,OAAAjD,EAAA,EAAAiD,CAAQ,KAC3BnC,EAAWkC,YAASP,EAEpBtB,EAAO4B,MAAQE,OAAAjD,EAAA,EAAAiD,CAAQ,KACvBlB,EAAYmB,UAAY,EACxBpC,EAAWqC,aAAe,EAE1BhC,EAAO6B,OAAS,EAEhBjB,EAAYqB,UACZtC,EAAWuC,SAEXzB,EAAM0B,KAAO,EACb1B,EAAM2B,KAAO,EACb3B,EAAM4B,KAAO,GAIU,cAAflD,KAAKK,SACbL,KAAK0C,OAAS,GACd1C,KAAKyC,WAAQN,EAEbV,EAAYiB,OAASC,OAAAjD,EAAA,EAAAiD,CAAQ,KAC7BlB,EAAYgB,WAAQN,EAEpB3B,EAAWkC,OAASC,OAAAjD,EAAA,EAAAiD,CAAQ,KAC5BnC,EAAWiC,WAAQN,EAEnBb,EAAMoB,OAASC,OAAAjD,EAAA,EAAAiD,CAAQ,KACvBrB,EAAMmB,WAAQN,EAEdb,EAAM0B,KAAO,EACb1B,EAAM4B,KAAO,EACb5B,EAAM6B,KAAO,EAEbtC,EAAO6B,OAASC,OAAAjD,EAAA,EAAAiD,CAAQ,KACxB9B,EAAO4B,MAAQ,EAEfhB,EAAYsB,SACZvC,EAAWsC,YAWN5D,EAAAoD,UAAAlB,sBAAP,SAA6BY,GAC5B,IAAIoB,EAAiBpB,EAAMqB,OACvBb,EAAYR,EAAMsB,YAAYd,EAC9Be,EAAkBvD,KAAKuD,MAEvBC,EAAmBC,KAAKC,IAAIH,EAAMI,cAAgBF,KAAKG,IACvDC,EAAmBJ,KAAKC,IAAIH,EAAMO,cAAgBL,KAAKG,IAEvDG,GAAiBX,EAAOY,YAAcxB,GAAKY,EAAOY,aAAeH,GAAYL,EAAWK,IACxFI,EAAoBR,KAAKS,IAAI,EAAGH,GACpCR,EAAMY,eAAeZ,EAAMa,aAAcH,IAQ1CtB,OAAA0B,eAAWnF,EAAAoD,UAAA,aAgCX,WACC,OAAOtC,KAAKC,OAAOqE,WAjCpB,SAAiBf,GAAjB,IAAAzD,EAAAE,KACCA,KAAKC,OAAOsE,IAAIhB,EAAO,IAAIhE,EAAA,GAC1BgE,EAAMrC,OAAOC,GAAG,iBAAkBnB,KAAKqB,gBAAiBrB,MAAM,GAC9DuD,EAAMrC,OAAOC,GAAG,mBAAoBnB,KAAKwE,YAAaxE,MAAM,GAE5DA,KAAKyB,YAAYP,OAAOC,GAAG,MAAO,WAAQoC,EAAMkB,QAAQlB,EAAMa,eAAiBb,GAAO,GAEtFZ,OAAAlD,EAAA,EAAAkD,GAAiB+B,KAAKxD,OAAOC,GAAG,QAAS,SAACwD,GACrC7E,EAAK8E,UAAUC,aACdrF,EAAA,EAASsF,MAAMH,EAAG3C,MAAO,SACxBlC,EAAK2B,YAAYsD,UACpBxB,EAAMkB,UAEE3E,EAAKU,WAAWuE,WACxBxB,EAAMyB,SAGCxF,EAAA,EAASsF,MAAMH,EAAG3C,MAAO,QACjCuB,EAAMyB,SAEExF,EAAA,EAASsF,MAAMH,EAAG3C,MAAO,UACjCuB,EAAMkB,YAGNlB,GACHvD,KAAKQ,WAAWU,OAAOC,GAAG,MAAO,WAAQoC,EAAMyB,OAAOzB,EAAMa,eAAiBb,GAAO,uCAgB/ErE,EAAAoD,UAAAjB,gBAAP,WAEC,GADYrB,KAAKuD,MACN,CACV,IAAI1C,EAAoBb,KAAKa,OACzBS,EAAgBtB,KAAKsB,MACN,YAAftB,KAAKK,QACRiB,EAAM2D,UAAYxB,KAAKyB,IAAIlF,KAAKa,OAAOmD,YAAa,IAEpD1C,EAAMoB,OAAS7B,EAAOmD,YAAchE,KAAKmF,UACzC7D,EAAM6B,KAAOtC,EAAOmD,YAAc1C,EAAM0C,YAEpC1C,EAAM0C,aAAe,EACxB1C,EAAM8D,SAAU,EAGhB9D,EAAM8D,SAAU,IAIjB9D,EAAM+D,SAAW5B,KAAKyB,IAAIlF,KAAKa,OAAOyE,WAAY,IAClDhE,EAAMmB,MAAQ5B,EAAOyE,WAAatF,KAAKmF,UACvC7D,EAAM2B,KAAOpC,EAAOyE,WAAahE,EAAMgE,WAEnChE,EAAMgE,YAAc,EACvBhE,EAAM8D,SAAU,EAGhB9D,EAAM8D,SAAU,KAWblG,EAAAoD,UAAAkC,YAAP,WACC,IAAI3D,EAAoBb,KAAKa,OACzB0C,EAAkBvD,KAAKuD,MACvBjC,EAAgBtB,KAAKsB,MAEzB,IAAKA,EAAMiE,OAAQ,CAClB,IAAIC,GAAgB/B,KAAKC,IAAIH,EAAMU,WAAaR,KAAKC,IAAI1D,KAAKuD,MAAMO,eAAiBL,KAAKG,IAEvE,YAAf5D,KAAKK,OACRiB,EAAMkB,EAAI3B,EAAOmD,aAAenD,EAAOmD,YAAc1C,EAAM0C,aAAewB,EAAOxF,KAAKmF,UAAY7D,EAAM0C,YAGxG1C,EAAMiB,EAAI1B,EAAOyE,WAAaE,EAAOxF,KAAKmF,YAUtCjG,EAAAoD,UAAAd,gBAAP,WACC,IAGIgE,EAHA3E,EAAoBb,KAAKa,OACzB0C,EAAkBvD,KAAKuD,MACvBjC,EAAgBtB,KAAKsB,MAWzBkE,EARc/B,KAAKC,IAAI1D,KAAKuD,MAAMO,cAAgBL,KAAKG,KAGtD4B,EADkB,YAAfxF,KAAKK,OACDL,KAAKmF,WAAatE,EAAOmD,YAAc1C,EAAMmE,OAASnE,EAAM0C,cAAgBnD,EAAOmD,YAAc1C,EAAM0C,aAGvGhE,KAAKmF,UAAY7D,EAAMoE,OAAS7E,EAAOyE,YAI/C,IAAIrB,EAAoBR,KAAKS,IAAI,EAAGsB,GACpCjC,EAAMY,oBAAehC,EAAW8B,GAAW,EAAO,IAUnDtB,OAAA0B,eAAWnF,EAAAoD,UAAA,iBAAX,WACC,OAAOmB,KAAKC,IAAI1D,KAAKuD,MAAMI,cAAgBF,KAAKG,IAAMH,KAAKC,IAAI1D,KAAKuD,MAAMO,cAAgBL,KAAKG,qCASzF1E,EAAAoD,UAAAqD,iBAAP,WACC,OAAO,IAAIrG,EAAA,GAGbJ,EAzWA,CAAiCE,EAAA,GAiXjCO,EAAA,EAASiG,kBAA+B,YAAI1G,+iEC1W5C2G,EAAA,SAAAhG,GA2BC,SAAAiG,IAAA,IAAAhG,EAGCD,EAAAE,KAAAC,OAAOA,YACPF,EAAKI,UAAY,YAGjBJ,EAAKiG,YAAa,EAClBjG,EAAKO,OAAS,OACdP,EAAKkG,WAAY,EAGjBlG,EAAKiC,eAeP,OAtD+BkE,EAAA,EAAAH,EAAAjG,GAgDvBiG,EAAAxD,UAAA4D,SAAP,WACKlG,KAAKmG,SACRnG,KAAK4B,YAAc5B,KAAKmG,OAAOC,gBAEhCvG,EAAAyC,UAAM4D,SAAQnG,KAAAC,OAEhB8F,EAtDA,CAA+BO,EAAA,GA8D/BC,EAAA,EAASV,kBAA6B,UAAIC,kBCjE1CU,EAAA,SAAA1G,GA8BC,SAAA2G,IAAA,IAAA1G,EACCD,EAAAE,KAAAC,OAAOA,YAEPF,EAAKI,UAAY,WACjBJ,EAAKiC,eA+CP,OAjF8BkE,EAAA,EAAAO,EAAA3G,GA0C7B8C,OAAA0B,eAAWmC,EAAAlE,UAAA,gBAOX,WACC,OAAOtC,KAAKyG,iBAAiB,iBAR9B,SAAoBC,GACnB1G,KAAK2G,iBAAiB,WAAYD,GAAO,GAAO,oCAejD/D,OAAA0B,eAAWmC,EAAAlE,UAAA,iBAOX,WACC,OAAOtC,KAAKyG,iBAAiB,kBAR9B,SAAqBC,GACpB1G,KAAK2G,iBAAiB,YAAaD,GAAO,GAAO,oCAe3CF,EAAAlE,UAAAsE,iBAAP,WACKC,EAAA,SAAe7G,KAAK8G,WAAaD,EAAA,SAAe7G,KAAK+G,YACxD/G,KAAKgH,OAAOhH,KAAKmG,OAAO5C,MAAM0D,WAAWC,SAAUJ,SAAU9G,KAAK8G,SAAUC,UAAW/G,KAAK+G,aAE7FlH,EAAAyC,UAAMsE,iBAAgB7G,KAAAC,OAGxBwG,EAjFA,CAA8BX,GAyF9BS,EAAA,EAASV,kBAA4B,SAAIW,8BC3FzCY,EAAA,SAAAtH,GAoCC,SAAAuH,IAAA,IAAAtH,EACCD,EAAAE,KAAAC,OAAOA,KAEPF,EAAKI,UAAY,aAEjBJ,EAAKuH,QAAUvH,EAAKW,YAAY6G,EAAA,GAChCxH,EAAKuH,QAAQ3G,aAAc,EAE3B,IAAIH,EAAkB,IAAIgH,EAAA,SAE1BzH,EAAKiB,KAAOR,EAAgBS,OAAO,mBACnClB,EAAK0H,OAASjH,EAAgBS,OAAO,yBACrClB,EAAK2H,cAAgB,EAErB3H,EAAK4H,gBAAkB,UAEvB5H,EAAKiC,eAuFP,OA3IgCkE,EAAA,EAAAmB,EAAAvH,GA4D/B8C,OAAA0B,eAAW+C,EAAA9E,UAAA,uBAOX,WACC,OAAOtC,KAAKyG,iBAAiB,wBAR9B,SAA2BkB,GAC1B3H,KAAK2G,iBAAiB,kBAAmBgB,GAAiB,oCAepDP,EAAA9E,UAAA4D,SAAP,WACKlG,KAAKmG,SACRnG,KAAKqH,QAAQO,OAAS5H,KAAKmG,OAAO5C,MAAM0D,WAAWY,eAAe7H,KAAK2H,kBAGxE9H,EAAAyC,UAAM4D,SAAQnG,KAAAC,OAMRoH,EAAA9E,UAAAwF,eAAP,aAUAnF,OAAA0B,eAAW+C,EAAA9E,UAAA,gBAAX,WACC,IAAIyF,EAAW/H,KAAK+H,SACpB,OAAOA,EAASC,OAASD,EAASE,MAAQF,EAASC,OAAS,mCAS7DrF,OAAA0B,eAAW+C,EAAA9E,UAAA,iBAAX,WACC,IAAIyF,EAAW/H,KAAK+H,SACpB,OAAOA,EAASG,MAAQH,EAASI,KAAOJ,EAASG,MAAQ,mCAgB1DvF,OAAA0B,eAAW+C,EAAA9E,UAAA,kBAAX,WACC,OAAOtC,KAAKqH,QAAQ/B,4CASrB3C,OAAA0B,eAAW+C,EAAA9E,UAAA,mBAAX,WACC,OAAOtC,KAAKqH,QAAQrD,6CAEtBoD,EA3IA,CAAgCvB,GAmJhCS,EAAA,EAASV,kBAA8B,WAAIuB,kBC7LpC,SAAAiB,EAAwBC,GAC9B,IAAItB,EAAYuB,EAAeD,EAAStB,WACpCD,EAAWrD,KAAK8E,KAAK9E,KAAK+E,IAAKH,EAASvB,SAAW2B,EAAA,UAAmBA,EAAA,QAEtEC,EAAcJ,EAAeD,EAASvB,UAS1C,OAPIrD,KAAKkF,IAAID,GAAe,KAC3B3B,EAAYuB,EAAevB,EAAY,MAGxCsB,EAAStB,UAAYA,EACrBsB,EAASvB,SAAWA,EAEbuB,EAUD,SAAAO,EAA4BC,OAClC,IAAoB,IAAAC,EAAA7C,EAAA,EAAA4C,GAASE,EAAAD,EAAAE,QAAAD,EAAAE,KAAAF,EAAAD,EAAAE,OAAA,CAAxB,IAAIE,EAAOH,EAAArC,UACf,IAAkB,IAAAyC,EAAAlD,EAAA,EAAAiD,GAAOE,EAAAD,EAAAH,QAAAI,EAAAH,KAAAG,EAAAD,EAAAH,OAAA,CAApB,IAAIK,EAAKD,EAAA1C,MACb2C,EAAQjB,EAAeiB,wMAGzB,OAAOR,cAWD,SAAAP,EAAwBgB,GAU9B,OATAA,GAAgB,KAEJ,MACXA,GAAS,KAENA,GAAS,MACZA,GAAS,KAGHA,EAUD,SAAAC,EAAoBlB,GAC1B,OAAS9F,EAAG8F,EAAStB,UAAWvE,EAAG6F,EAASvB,UCvD7C,IAAA0C,EAAA,oBAAAC,IAEQzJ,KAAA0J,eAAyB,EAEzB1J,KAAA2J,cAAwB,EAExB3J,KAAA4J,UAAoB,EAEpB5J,KAAA6J,aAAwBtH,EAAG,EAAGC,EAAG,GAEjCxC,KAAA8J,MAAgB,EAgfxB,OA9eQL,EAAAnH,UAAAuF,eAAP,SAAsBkC,GAErB,IAAIC,EAAkChK,KAAKiK,YAAYF,GAGvD,OAFoC/J,KAAKkK,eAAeF,IAKlDP,EAAAnH,UAAA6H,eAAP,SAAsBC,GACrB,OAAOpK,KAAKqK,eAAerK,KAAKsK,YAAYF,KAGtCX,EAAAnH,UAAAiI,kBAAP,WACC,IAAIxD,EAAYuB,EAAoB,IAAMtI,KAAK0J,gBAC3C5C,EAAWwB,EAAoBtI,KAAK2J,eAGxC,QAAU5C,WAAY,IAAKD,SAAUA,EAAW,KAAQC,UAAWA,EADpD,KAC0ED,SAAUA,EAAW,KAAQC,UAAWA,EADlH,KACwID,SAAUA,EAAW,KAAQC,WAAY,IAAKD,SAAUA,EAAW,MAGpN2C,EAAAnH,UAAAkI,kBAAP,WACC,IAAIzD,EAAYuB,EAAoB,IAAMtI,KAAK0J,gBAI/C,QAAU3C,UAAWA,EADN,KAC4BD,UAAW,KAAQC,UAAW,IAAKD,UAAW,KAAQC,UAAW,IAAKD,SAAU,KAAQC,UAAWA,EAD/H,KACqJD,SAAU,MAGxK2C,EAAAnH,UAAAmI,SAAP,WACC,IAAI1D,EAAYuB,EAAoB,IAAMtI,KAAK0J,gBAC3C5C,EAAWwB,EAAoBtI,KAAK2J,eAExC,OAAS3B,MAAOlB,EAAW,GAAImB,MAAOnB,EAAW,GAAIqB,KAAMpB,EAAY,IAAKmB,KAAMnB,IAG5E0C,EAAAnH,UAAAoI,SAAP,WACC,IAAI3D,EAAYuB,EAAoB,IAAMtI,KAAK0J,gBAC3C5C,EAAWwB,EAAoBtI,KAAK2J,eAExC,OAAS3B,MAAOlB,EAAW,GAAImB,MAAOnB,EAAW,GAAIqB,KAAMpB,EAAWmB,KAAOnB,EAAY,MAKhF0C,EAAAnH,UAAAgI,YAAV,SAAsBF,GACrB,GAAKA,EAAL,CASA,IALA,IAAIO,KAEAC,EAAiB5K,KAAKuK,oBACtBM,EAAiB7K,KAAKwK,oBAEjBM,EAAI,EAAGC,EAAMX,EAAQY,OAAQF,EAAIC,EAAKD,IAAK,CACnD,IAAI5B,EAAuBkB,EAAQU,GAEnC,GAAI5B,EAAS,CACZ,IAAI+B,EAAiCjL,KAAKkL,SAAShC,EAAS0B,GAG5D,GAFAD,EAAcA,EAAYQ,OAAOF,GAEN,GAAvBjL,KAAK0J,eAAqB,CAC7B,IAAI0B,EAAkCpL,KAAKkL,SAAShC,EAAS2B,GAC7DF,EAAcA,EAAYQ,OAAOC,KAKpC,OAAOT,IAIElB,EAAAnH,UAAA2H,YAAV,SAAsBF,GAErB,GAAKA,EAAL,CAYA,IARA,QAAIsB,KAEAT,EAAiB5K,KAAKuK,oBACtBM,EAAiB7K,KAAKwK,oBAEtBc,EAAQtL,KAAKyK,WACbc,EAAQvL,KAAK0K,WAERI,EAAI,EAAGC,EAAMhB,EAAQiB,OAAQF,EAAIC,EAAKD,IAAK,CAEnD,IAAIU,EAAuBzB,EAAQe,GAAG,GAClCW,EAAoB1B,EAAQe,GAAG,GAE/BY,KAEJ,GAAIF,EAAS,CAEZ,IAAIG,EAAc3L,KAAK4L,YAAYJ,GAEnC,GAAKxL,KAAK6L,SAASF,EAAaL,IAAWtL,KAAK8L,UAAUH,EAAaL,GAMtEI,EAAarJ,MAAMmJ,EAASC,QANkD,CAC9E,IAAIM,EAA+B/L,KAAKgM,KAAKR,EAASZ,GAClDqB,EAA4BjM,KAAKgM,KAAKP,EAAMb,GAChDc,EAAarJ,MAAM0J,EAAiBE,IAMrC,IAAKjM,KAAK6L,SAASF,EAAaJ,KAAWvL,KAAK8L,UAAUH,EAAaJ,GAAQ,CAC9E,IAAIW,EAA+BlM,KAAKgM,KAAKR,EAASX,GAClDsB,EAA4BnM,KAAKgM,KAAKP,EAAMZ,GAChDa,EAAarJ,MAAM6J,EAAiBC,SAItC,IAAiB,IAAAC,EAAAnG,EAAA,EAAAyF,GAAYW,EAAAD,EAAApD,QAAAqD,EAAApD,KAAAoD,EAAAD,EAAApD,OAAA,CAAxB,IAAIsD,EAAID,EAAA3F,MACZ2E,EAAYhJ,KAAKiK,sGAInB,OAAOjB,IAGE5B,EAAAnH,UAAA4H,eAAV,SAAyBH,GAExB,GAAKA,EAAL,CAMA,IAFA,IAAIwC,KAEKzB,EAAI,EAAGC,EAAMhB,EAAQiB,OAAQF,EAAIC,EAAKD,IAAK,CAEnD,IAAIU,EAAuBzB,EAAQe,GAAG,GAClCW,EAAoB1B,EAAQe,GAAG,GAE/B0B,KAEJ,GAAIhB,EAAS,CAGZ,IAFA,IAAIiB,KAEKC,EAAI,EAAGC,EAAOnB,EAAQR,OAAQ0B,EAAIC,EAAMD,IAAK,CACrD,IAAIrD,EAAgBrJ,KAAKkH,QAAQsE,EAAQkB,IAEzCD,EAAiBpK,KAAKgH,GAEvBmD,EAAoBnK,KAAKoK,GAG1B,GAAIhB,EAAM,CAET,IADA,IAAImB,KACYC,GAAPH,EAAI,EAAUjB,EAAKT,QAAQ0B,EAAIG,EAAMH,IAAK,CAC9CrD,EAAgBrJ,KAAKkH,QAAQuE,EAAKiB,IAEtCE,EAAcvK,KAAKgH,GAEpBmD,EAAoBnK,KAAKuK,GAE1BL,EAAgBlK,KAAKmK,GAEtB,OAAOD,IAGE9C,EAAAnH,UAAA+H,eAAV,SAAyBD,GACxB,GAAKA,EAAL,CAKA,IAFA,IAAImC,KAEKzB,EAAI,EAAGC,EAAMX,EAAQY,OAAQF,EAAIC,EAAKD,IAAK,CAMnD,IAJA,IAAI5B,EAAuBkB,EAAQU,GAE/BgC,KAEKJ,EAAI,EAAGC,EAAOzD,EAAQ8B,OAAQ0B,EAAIC,EAAMD,IAAK,CACrD,IAAIrE,EAAsBa,EAAQwD,GAE9BrD,EAAgBrJ,KAAKkH,QAAQmB,GACjCyE,EAAuBzK,KAAKgH,GAG7BkD,EAAgBlK,KAAKyK,GAEtB,OAAOP,IASD9C,EAAAnH,UAAA4E,QAAP,SAAemB,GACdA,EAAWD,EAAoBC,GAC/BA,EAAWrI,KAAK+M,OAAO1E,EAAUrI,KAAK0J,eAAgB1J,KAAK2J,cAAe3J,KAAK4J,WAC/E,IAAIoD,EAAyBhN,KAAKiN,QAAQ5E,EAAStB,UAAY0B,EAAA,QAAeJ,EAASvB,SAAW2B,EAAA,SAClG,OACClG,EAAGkG,EAAA,MAAYuE,EAAezK,EAAIkG,EAAA,QAAgBzI,KAAK6J,YAAYtH,EAAG,GAAKvC,KAAK8J,MAChFtH,EAAGiG,EAAA,OAAauE,EAAexK,EAAIiG,EAAA,QAAgBzI,KAAK6J,YAAYrH,EAAG,GAAKxC,KAAK8J,QAS5EL,EAAAnH,UAAA4K,OAAP,SAAc7D,GACb,IAAI2D,EAA4BhN,KAAKmN,WAAW9D,EAAM9G,EAAIvC,KAAK8J,MAAQ9J,KAAK6J,YAAYtH,GAAKkG,EAAA,UAAiBY,EAAM7G,EAAIxC,KAAK8J,MAAQ9J,KAAK6J,YAAYrH,GAAKiG,EAAA,SAEvJJ,GAAatB,UAAWiG,EAAejG,UAAY0B,EAAA,QAAe3B,SAAUkG,EAAelG,SAAW2B,EAAA,SAI1G,OAFAJ,EAAWrI,KAAKoN,SAAS/E,EAAUrI,KAAK0J,eAAgB1J,KAAK2J,cAAe3J,KAAK4J,YAc3EH,EAAAnH,UAAA2K,QAAP,SAAeI,EAAgBC,GAC9B,OAAS/K,EAAG8K,EAAQ7K,EAAG8K,IAYjB7D,EAAAnH,UAAA6K,UAAP,SAAiB5K,EAAWC,GAC3B,OAASuE,UAAWxE,EAAGuE,SAAUtE,IAIlCiH,EAAAnH,UAAAyK,OAAA,SAAO1E,EAAqBqB,EAAwBC,EAAuB4D,GAE1E,IAAIC,EAAc9D,EAAiBjB,EAAA,QAC/BgF,EAAW9D,EAAgBlB,EAAA,QAC/B8E,GAA0B9E,EAAA,QAE1B,IAAI4E,EAAShF,EAAStB,UAAY0B,EAAA,QAAgB+E,EAC9CF,EAAMjF,EAASvB,SAAW2B,EAAA,QAE1BiF,EAAcjK,KAAKkK,IAAIF,GACvBG,EAAcnK,KAAK+E,IAAIiF,GACvBI,EAAgBpK,KAAKkK,IAAIJ,GACzBO,EAAgBrK,KAAK+E,IAAI+E,GAEzBQ,EAAStK,KAAKkK,IAAIL,GAElB/K,EAAIkB,KAAKkK,IAAIN,GAAUU,EACvBvL,EAAIiB,KAAK+E,IAAI6E,GAAUU,EACvBC,EAAIvK,KAAK+E,IAAI8E,GACbW,EAAID,EAAIN,EAAcnL,EAAIqL,EAE9B,OAAS7G,UAAW0B,EAAA,QAAgBhF,KAAKyK,MAAM1L,EAAIqL,EAAgBI,EAAIH,EAAevL,EAAImL,EAAcM,EAAIJ,GAAc9G,SAAU2B,EAAA,QAAgBhF,KAAK8E,KAAK0F,EAAIJ,EAAgBrL,EAAIsL,KAGvLrE,EAAAnH,UAAA8K,SAAA,SAAS/E,EAAqBqB,EAAwBC,EAAuB4D,GAE5E,IAAIC,EAAc9D,EAAiBjB,EAAA,QAC/BgF,EAAW9D,EAAgBlB,EAAA,QAC/B8E,GAA0B9E,EAAA,QAE1B,IAAI4E,EAAShF,EAAStB,UAAY0B,EAAA,QAAgB+E,EAC9CF,EAAMjF,EAASvB,SAAW2B,EAAA,QAE1BiF,EAAcjK,KAAKkK,IAAIF,GACvBG,EAAcnK,KAAK+E,IAAIiF,GACvBI,EAAgBpK,KAAKkK,IAAIJ,GACzBO,EAAgBrK,KAAK+E,IAAI+E,GAEzBQ,EAAStK,KAAKkK,IAAIL,GAElB/K,EAAIkB,KAAKkK,IAAIN,GAAUU,EACvBvL,EAAIiB,KAAK+E,IAAI6E,GAAUU,EACvBC,EAAIvK,KAAK+E,IAAI8E,GACbW,EAAID,EAAIH,EAAgBrL,EAAIsL,EAEhC,OAAS/G,UAAW0B,EAAA,QAAgBhF,KAAKyK,MAAM1L,EAAIqL,EAAgBG,EAAIF,EAAevL,EAAImL,EAAcO,EAAIL,GAAc9G,SAAU2B,EAAA,QAAgBhF,KAAK8E,KAAK0F,EAAIP,EAAcnL,EAAIqL,KAKrLnE,EAAAnH,UAAA4I,SAAA,SAASiD,EAA8BC,GAEtC,GAAKD,GAA6C,GAA1BA,EAAgBnD,OAAxC,CAIA,IAAIqD,EACAC,EAMA5B,EACA6B,EALAC,EAAS,SAASC,GACrB,OAAQH,EAAIvH,UAAYsH,EAAItH,YAAc0H,EAAE3H,SAAWuH,EAAIvH,WAAawH,EAAIxH,SAAWuH,EAAIvH,WAAa2H,EAAE1H,UAAYsH,EAAItH,YAOvH2H,EAAe,WAClB,IAAIC,EAAkBN,EAAItH,UAAYuH,EAAIvH,UAAtC4H,EAA2DN,EAAIvH,SAAWwH,EAAIxH,SAC9E8H,EAAkBlC,EAAE3F,UAAYwH,EAAExH,UAAlC6H,EAAuDlC,EAAE5F,SAAWyH,EAAEzH,SACtE+H,EAAKR,EAAItH,UAAYuH,EAAIxH,SAAWuH,EAAIvH,SAAWwH,EAAIvH,UACvD+H,EAAKpC,EAAE3F,UAAYwH,EAAEzH,SAAW4F,EAAE5F,SAAWyH,EAAExH,UAC/CgI,EAAK,GAAOJ,EAAeC,EAAcD,EAAcC,GAE3D,OAAS7H,WAAY8H,EAAKD,EAAeE,EAAKH,GAAgBI,EAAIjI,UAAW+H,EAAKD,EAAcE,EAAKH,GAAeI,IAGjH7F,EAAuBiF,EAE3BE,EAAMD,EAAYA,EAAYpD,OAAS,GAEvC,IAAK,IAAIgE,EAAI,EAAGA,EAAIZ,EAAYpD,SAAUgE,EAAG,CAC5CV,EAAMF,EAAYY,GAClB,IAAIC,EAAY/F,EAChBA,KACAwD,EAAIuC,EAAU,GACd,IAAK,IAAInE,EAAI,EAAGC,EAAMkE,EAAUjE,OAAQF,EAAIC,EAAKD,IAG5C0D,EAFJD,EAAIU,EAAUnE,KAGR0D,EAAO9B,IACXxD,EAAQ7G,KAAKqM,KAEdxF,EAAQ7G,KAAKkM,IAELC,EAAO9B,IACfxD,EAAQ7G,KAAKqM,KAGdhC,EAAI6B,EAELF,EAAMC,EAGP,OAAQpF,KAQTO,EAAAnH,UAAA0J,KAAA,SAAKkD,EAA6Bd,GAEjC,GAAKc,GAA2C,GAAzBA,EAAelE,OAAtC,CAIA,IAAIqD,EACAC,EAMA5B,EACA6B,EALAC,EAAS,SAASC,GACrB,OAAQH,EAAIvH,UAAYsH,EAAItH,YAAc0H,EAAE3H,SAAWuH,EAAIvH,WAAawH,EAAIxH,SAAWuH,EAAIvH,WAAa2H,EAAE1H,UAAYsH,EAAItH,YAMvH2H,EAAe,WAClB,IAAIC,EAAkBN,EAAItH,UAAYuH,EAAIvH,UAAtC4H,EAA2DN,EAAIvH,SAAWwH,EAAIxH,SAC9E8H,EAAkBlC,EAAE3F,UAAYwH,EAAExH,UAAlC6H,EAAuDlC,EAAE5F,SAAWyH,EAAEzH,SACtE+H,EAAKR,EAAItH,UAAYuH,EAAIxH,SAAWuH,EAAIvH,SAAWwH,EAAIvH,UACvD+H,EAAKpC,EAAE3F,UAAYwH,EAAEzH,SAAW4F,EAAE5F,SAAWyH,EAAExH,UAC/CgI,EAAK,GAAOJ,EAAeC,EAAcD,EAAcC,GAE3D,OAAS7H,WAAY8H,EAAKD,EAAeE,EAAKH,GAAgBI,EAAIjI,UAAW+H,EAAKD,EAAcE,EAAKH,GAAeI,IAGjHI,EAAaD,EAEjBb,EAAMD,EAAYA,EAAYpD,OAAS,GAEvC,IAAK,IAAIgE,EAAI,EAAGA,EAAIZ,EAAYpD,SAAUgE,EAAG,CAC5CV,EAAMF,EAAYY,GAClB,IAAIC,EAAYE,EAChBA,KACAzC,EAAIuC,EAAUA,EAAUjE,OAAS,GAEjC,IAAK,IAAIF,EAAI,EAAGC,EAAMkE,EAAUjE,OAAQF,EAAIC,IAAOD,EAG9C0D,EAFJD,EAAIU,EAAUnE,KAGR0D,EAAO9B,IACXyC,EAAW9M,KAAKqM,KAEjBS,EAAW9M,KAAKkM,IAERC,EAAO9B,IACfyC,EAAW9M,KAAKqM,KAEjBhC,EAAI6B,EAGLF,EAAMC,EAEP,OAAOa,IAID1F,EAAAnH,UAAAsJ,YAAP,SAAmBwD,GAOlB,IALA,IAAIjH,EAAeiH,EAAU,GAAGrI,UAC5BmB,EAAekH,EAAU,GAAGrI,UAC5BiB,EAAgBoH,EAAU,GAAGtI,SAC7BmB,EAAgBmH,EAAU,GAAGtI,SAExB4F,EAAY,EAAGA,EAAI0C,EAAUpE,OAAQ0B,IAAK,CAClD,IAAI3F,EAAoBqI,EAAU1C,GAAG3F,UACjCD,EAAmBsI,EAAU1C,GAAG5F,SAE/BqB,EAAOpB,IACXoB,EAAOpB,GAEHmB,EAAOnB,IACXmB,EAAOnB,GAGHiB,EAAQlB,IACZkB,EAAQlB,GAEJmB,EAAQnB,IACZmB,EAAQnB,GAIV,OAASkB,MAAOA,EAAOE,KAAMA,EAAMD,MAAOA,EAAOE,KAAMA,IAIjDsB,EAAAnH,UAAAuJ,SAAP,SAAgBwD,EAAmBC,GAClC,OAAID,EAAGrH,MAAQsH,EAAGtH,OAASqH,EAAGpH,MAAQqH,EAAGrH,OAASoH,EAAGlH,KAAOmH,EAAGnH,MAAQkH,EAAGnH,KAAOoH,EAAGpH,MAO9EuB,EAAAnH,UAAAwJ,UAAP,SAAiBuD,EAAmBC,GACnC,OAAID,EAAGpH,MAAQqH,EAAGtH,OAASqH,EAAGrH,MAAQsH,EAAGrH,OAASoH,EAAGlH,KAAOmH,EAAGpH,MAAQmH,EAAGnH,KAAOoH,EAAGnH,MAS9EsB,EAAAnH,UAAAiN,kBAAP,SAAyBC,EAAmBC,EAAmBC,GAC9D,IAAIC,EAAOH,EAAO1I,SAAW2B,EAAA,QACzBmH,EAAUJ,EAAOzI,UAAY0B,EAAA,QAE7BoH,EAAOJ,EAAO3I,SAAW2B,EAAA,QACzBqH,EAAUL,EAAO1I,UAAY0B,EAAA,QAE7BsH,EAAUtM,KAAK+E,IAAImH,GACnBK,EAAUvM,KAAKkK,IAAIgC,GACnBM,EAAaxM,KAAK+E,IAAIoH,GACtBM,EAAazM,KAAKkK,IAAIiC,GACtBO,EAAU1M,KAAK+E,IAAIqH,GACnBO,EAAU3M,KAAKkK,IAAIkC,GACnBQ,EAAa5M,KAAK+E,IAAIsH,GACtBQ,EAAa7M,KAAKkK,IAAImC,GAGtBrC,EAAWoC,EAAOF,EAClBnC,EAAcsC,EAAUF,EACxBW,EAAI9M,KAAK+E,IAAIiF,EAAW,GAAKhK,KAAK+E,IAAIiF,EAAW,GAAKhK,KAAKkK,IAAIgC,GAAQlM,KAAKkK,IAAIkC,GAAQpM,KAAK+E,IAAIgF,EAAc,GAAK/J,KAAK+E,IAAIgF,EAAc,GAC3IgD,EAAQ,EAAI/M,KAAKyK,MAAMzK,KAAKgN,KAAKF,GAAI9M,KAAKgN,KAAK,EAAIF,IAEnDG,EAAIjN,KAAK+E,KAAK,EAAIkH,GAAYc,GAAS/M,KAAK+E,IAAIgI,GAChDG,EAAIlN,KAAK+E,IAAIkH,EAAWc,GAAS/M,KAAK+E,IAAIgI,GAE1CjO,EAAImO,EAAIV,EAAUE,EAAaS,EAAIP,EAAUE,EAC7C9N,EAAIkO,EAAIV,EAAUC,EAAaU,EAAIP,EAAUC,EAC7CrC,EAAI0C,EAAIX,EAAUY,EAAIR,EAEtBS,EAAOnN,KAAKyK,MAAMF,EAAGvK,KAAKgN,KAAKlO,EAAIA,EAAIC,EAAIA,IAC3CqO,EAAUpN,KAAKyK,MAAM1L,EAAGD,GAE5B,OAASuE,SAAU8J,EAAOnI,EAAA,QAAe1B,UAAW8J,EAAUpI,EAAA,UAEhEgB,EA1fA,GAmgBAnD,EAAA,EAASV,kBAA8B,WAAI4D,8EC3e3CsH,EAAA,SAAAjR,GAUC,SAAAkR,IAAA,IAAAjR,EACCD,EAAAE,KAAAC,OAAOA,YACPF,EAAKI,UAAY,mBACjBJ,EAAKiC,eAGP,OAhBsCkE,EAAA,EAAA8K,EAAAlR,GAgBtCkR,EAhBA,CAAsCC,EAAA,GA4PtCC,EAAA,SAAApR,GAqLC,SAAAqR,IAAA,IAAApR,EAGCD,EAAAE,KAAAC,OAAOA,KAzIDF,EAAAqR,WAAqB,EA0ErBrR,EAAAsR,aAAuB,IAKvBtR,EAAAuR,WAAwCC,EAAA,SAUxCxR,EAAAgE,aAAuB,EAUvBhE,EAAA6D,aAAuB,GAcpB7D,EAAAyR,mBAAiCzK,SAAU,EAAGC,UAAW,GAyBlEjH,EAAKI,UAAY,WAGjBJ,EAAKmH,WAAa,IAAIuC,EAEtB1J,EAAK4J,eAAiB,EACtB5J,EAAK0R,UAAY,GACjB1R,EAAK2R,cAAgB,EACrB3R,EAAK4R,SAAW,EAGhB5R,EAAKQ,QAAQ,EAAG,EAAG,EAAG,GAGtBR,EAAKuF,SAAW,GAChBvF,EAAKmF,UAAY,GAEjBnF,EAAKoB,OAAOyQ,KAAK,SAAU7R,EAAK8R,gBAAiB9R,GAAM,GAGvD,IAAI+R,EAAkB/R,EAAK+R,gBAC3BA,EAAgBtQ,WAAY,EAC5BsQ,EAAgBzM,SAAU,EAC1ByM,EAAgBC,OAAQ,EACxBD,EAAgBE,WAAY,EAC5BF,EAAgB3Q,OAAOC,GAAG,cAAerB,EAAKkS,mBAAoBlS,GAAM,GACxE+R,EAAgB3Q,OAAOC,GAAG,YAAarB,EAAKmS,gBAAiBnS,GAAM,GACnE+R,EAAgB3Q,OAAOC,GAAG,OAAQrB,EAAKoS,WAAYpS,GAAM,GACzD+R,EAAgBM,OAAS,EACzBN,EAAgB/Q,WAAWG,YAAc,EAIzCnB,EAAKoB,OAAOC,GAAG,gBAAiBrB,EAAKsS,eAAgBtS,GAAM,GAI3D,IAAIuS,EAAiBvS,EAAKuS,eAC1BA,EAAeC,OAASxS,EACxBuS,EAAetM,YAAa,EAC5BsM,EAAeF,QAAU,EAEzBrS,EAAKsC,WAAWC,KAAKwP,EAAgB3Q,OAAOC,GAAG,iBAAkB,WAC5DrB,EAAKyS,SACJzS,EAAK0S,eACR1S,EAAK0S,cAAcC,OAEpB3S,EAAK4S,mBACL5S,EAAKqE,eAAerE,EAAK6S,kBAAmB7S,EAAKmE,WAAW,EAAM,GAElEnE,EAAKqG,OAAOyM,KAAK,SAACzM,GACjBA,EAAO0M,+BAGP1Q,GAAW,IAEd,IAAI2Q,EAAmBT,EAAevR,kBACtCgS,EAAiB7R,YAAc,EAC/B6R,EAAiB5R,OAAOC,GAAG,OAAQ,SAACoN,GAAQzO,EAAK+R,gBAAgBkB,UAAUxE,EAAElL,OAAO2P,aAAaC,aAAaC,SAAS,KAAQpT,GAC/HgT,EAAiB5R,OAAOC,GAAG,KAAM,SAACoN,GAAQzO,EAAK+R,gBAAgBsB,YAAcrT,GAC7EgT,EAAiB5R,OAAOC,GAAG,YAAarB,EAAKmS,gBAAiBnS,GAC9DgT,EAAiBM,WAAY,EAE7Bf,EAAenR,OAAOC,GAAG,OAAQrB,EAAKuT,cAAevT,GAAM,GAG3DA,EAAKgB,WAAWG,YAAc,EAC9BnB,EAAKgB,WAAWc,YAAc9B,EAAK+B,SAASC,UAAU,+DAGtDhC,EAAKsC,WAAWC,KAAKM,OAAA2Q,EAAA,EAAA3Q,GAAiB+B,KAAKxD,OAAOC,GAAG,QAAS,SAACwD,GAC9D,GAAI7E,EAAK8E,UAAUC,cAAgB/E,EAAKyT,eAAiBzT,EAAKyT,aAAajS,MAAMyD,WAChF,OAAQyO,EAAA,EAASC,YAAY9O,EAAG3C,QAC/B,IAAK,KACJlC,EAAK4T,KAAMnR,EAAG,EAAGC,EAAG,KACpB,MACD,IAAK,OACJ1C,EAAK4T,KAAMnR,EAAG,EAAGC,GAAI,KACrB,MACD,IAAK,OACJ1C,EAAK4T,KAAMnR,EAAG,GAAKC,EAAG,IACtB,MACD,IAAK,QACJ1C,EAAK4T,KAAMnR,GAAI,GAAKC,EAAG,MAIxB1C,IAEHA,EAAK6T,mBAAqB,OAG1B7T,EAAKiC,eA09BP,OA/uC8BkE,EAAA,EAAAiL,EAAArR,GA0RnBqR,EAAA5O,UAAAsP,gBAAV,WACC,IAAIW,GAAS,EACbvS,KAAK6R,gBAAgBzM,SAAU,EAC/BpF,KAAKmG,OAAOyM,KAAK,SAACzM,GACZA,EAAOoM,SACXA,GAAS,KAGPA,GACHvS,KAAKoS,iBACLpS,KAAK4T,OAAO,IAGZtN,EAAA,EAASpF,OAAOyQ,KAAK,YAAa3R,KAAK4R,gBAAiB5R,MAAM,IAQtDkR,EAAA5O,UAAA4P,WAAV,WAEC,IAAI2B,EAAK7T,KAAK8T,YAAc9T,KAAKiE,UAAYjE,KAAKmR,WAC9C4C,EAAK/T,KAAKgU,aAAehU,KAAKiE,UAAYjE,KAAKmR,WAC/C5O,EAAIvC,KAAK6R,gBAAgBnM,OACzBlD,EAAIxC,KAAK6R,gBAAgBpM,OAEzB+L,EAAYxR,KAAKwR,UAEjBxO,EAAOS,KAAKyB,IAAIlF,KAAKiU,UAAY,EAAIzC,GAAaqC,EAAK,GAAIA,GAAMrC,EAAY,KAC7EjP,EAAIS,IACPT,EAAIS,GAGL,IAAIC,EAAOQ,KAAKyQ,IAAIlU,KAAKiU,SAAWzC,EAAYqC,EAAK,EAAG7T,KAAKiU,SAAWJ,GAAMrC,EAAY,KACtFjP,EAAIU,IACPV,EAAIU,GAIL,IAAIC,EAAOO,KAAKyB,IAAIlF,KAAKmU,WAAa,EAAI3C,GAAauC,EAAK,GAAIA,GAAMvC,EAAY,KAC9EhP,EAAIU,IACPV,EAAIU,GAGL,IAAIC,EAAOM,KAAKyQ,IAAIlU,KAAKmU,UAAY3C,EAAYuC,EAAK,EAAG/T,KAAKmU,UAAYJ,GAAMvC,EAAY,KACxFhP,EAAIW,IACPX,EAAIW,GAGLnD,KAAK6R,gBAAgB7K,QAASzE,EAAGA,EAAGC,EAAGA,QAAKL,OAAWA,GAAW,GAElEnC,KAAK2S,kBAAoB3S,KAAKoE,cAOrB8M,EAAA5O,UAAA8R,sBAAV,WAECvU,EAAAyC,UAAM8R,sBAAqBrU,KAAAC,MAItB6G,EAAA,SAAe7G,KAAK4B,eACxB5B,KAAK4B,YAAc5B,KAAK6B,SAASC,UAAU,SAWnCoP,EAAA5O,UAAA+Q,cAAV,WACKrT,KAAKwS,eACRxS,KAAKwS,cAAcC,QAUXvB,EAAA5O,UAAA2P,gBAAV,SAA0BjQ,GACzB,IAAIqS,EAAmBC,EAAA,mBAA0BtS,EAAMqH,MAAOrJ,KAAKuU,cAAevU,KAAKwU,aAAaC,UAChGpM,EAAsBrI,KAAK0U,cAAcL,GAC7CrU,KAAKgF,OAAOqD,IASH6I,EAAA5O,UAAAqS,YAAV,SAAsB3S,GAErB,IAAIqS,EAAmBC,EAAA,mBAA0BtS,EAAMqH,MAAOrJ,KAAKuU,cAAevU,KAAKwU,aAAaC,UAChGpM,EAAsBrI,KAAK0U,cAAcL,GAEzCrS,EAAM4S,MAAMpS,EAAI,EACnBxC,KAAKgF,OAAOqD,GAGZrI,KAAKyE,QAAQ4D,IAWf1F,OAAA0B,eAAW6M,EAAA5O,UAAA,0BAmBX,WACC,OAAOtC,KAAKyG,iBAAiB,2BApB9B,SAA8BC,GAEzB1G,KAAK2G,iBAAiB,qBAAsBD,KAClC,QAATA,GACH1G,KAAK6U,oBAAsB7U,KAAKqS,eAAenR,OAAOC,GAAG,QAASnB,KAAK2U,YAAa3U,MAAM,GAC1FA,KAAKoC,WAAWC,KAAKrC,KAAK6U,uBAGtB7U,KAAK6U,qBACR7U,KAAK6U,oBAAoBC,UAE1B9U,KAAKqS,eAAe0C,WAAY,qCAqCnCpS,OAAA0B,eAAW6M,EAAA5O,UAAA,kBAUX,WACC,OAAOtC,KAAKyG,iBAAiB,mBAX9B,SAAsBQ,GACrBA,EAAWyC,eAAiB1J,KAAK0J,eAC7B1J,KAAK2G,iBAAiB,aAAcM,IACvCjH,KAAKgV,wDAiBA9D,EAAA5O,UAAA8P,eAAP,eAAAtS,EAAAE,KAEKiV,EAAQjV,KAAKmI,KACb+M,EAAQlV,KAAKkI,KACbiN,EAASnV,KAAKgI,MACdoN,EAASpV,KAAKiI,MAElBjI,KAAKmI,KAAO,KACZnI,KAAKkI,KAAO,KACZlI,KAAKgI,MAAQ,KACbhI,KAAKiI,MAAQ,KAEb,IAAIoK,EAA4BrS,KAAKqS,eAkBrC,GAfAgD,EAAA,KAAWrV,KAAKmG,OAAOmP,WAAY,SAACnP,IAC9BrG,EAAKqI,KAAOhC,EAAOgC,OAAUtB,EAAA,SAAe/G,EAAKqI,SACrDrI,EAAKqI,KAAOhC,EAAOgC,OAEfrI,EAAKoI,KAAO/B,EAAO+B,OAAUrB,EAAA,SAAe/G,EAAKoI,SACrDpI,EAAKoI,KAAO/B,EAAO+B,OAGfpI,EAAKkI,MAAQ7B,EAAO6B,QAAWnB,EAAA,SAAe/G,EAAKkI,UACvDlI,EAAKkI,MAAQ7B,EAAO6B,QAEhBlI,EAAKmI,MAAQ9B,EAAO8B,QAAWpB,EAAA,SAAe/G,EAAKmI,UACvDnI,EAAKmI,MAAQ9B,EAAO8B,SAGlBpB,EAAA,SAAe7G,KAAKkI,OAASrB,EAAA,SAAe7G,KAAKgI,OAAQ,CAE5DhI,KAAKiH,WAAW4C,aAAgBtH,EAAG,EAAGC,EAAG,GACzCxC,KAAKiH,WAAW6C,MAAQ,EAGxB,IAAIJ,EAAiB1J,KAAKiH,WAAWyC,eACrC1J,KAAKiH,WAAWyC,eAAiB,EAEjC,IAAI6L,EAAqBvV,KAAKiH,WAAWC,SAAUH,WAAY/G,KAAKkI,KAAOlI,KAAKmI,MAAQ,EAAGrB,SAAU9G,KAAKgI,QACtGwN,EAAqBxV,KAAKiH,WAAWC,SAAUH,WAAY/G,KAAKkI,KAAOlI,KAAKmI,MAAQ,EAAGrB,SAAU9G,KAAKiI,QAEtGwN,EAAoBzV,KAAKiH,WAAWC,SAAUH,UAAW/G,KAAKmI,KAAMrB,SAAU,IAC9E4O,EAAoB1V,KAAKiH,WAAWC,SAAUH,UAAW/G,KAAKkI,KAAMpB,SAAU,IAElF9G,KAAKiH,WAAWyC,eAAiBA,EAEjC1J,KAAKiH,WAAW4C,aAAgBtH,EAAGkT,EAAUlT,GAAKmT,EAAUnT,EAAIkT,EAAUlT,GAAK,EAAGC,EAAG+S,EAAW/S,GAAKgT,EAAWhT,EAAI+S,EAAW/S,GAAK,GAEpI,IAAI2O,OAAU,EAEV2C,EAAc4B,EAAUnT,EAAIkT,EAAUlT,EACtCyR,EAAewB,EAAWhT,EAAI+S,EAAW/S,EAEzCmT,EAAiBtD,EAAeuD,WAAa9B,EAC7C+B,EAAiBxD,EAAeyD,YAAc9B,EAGjD7C,EADGwE,EAASE,EACCA,EAEAF,GAEV9O,EAAA,MAAYsK,IAAeA,GAAc4E,OAC5C5E,EAAa,GAGd,IAAI6E,GAAyB,EACzBhW,KAAKiH,WAAW6C,OAASqH,IAC5BnR,KAAKiH,WAAW6C,MAAQqH,EACxB6E,GAAyB,GAG1BhW,KAAK8T,YAAcA,EAAc3C,EACjCnR,KAAKgU,aAAeA,EAAe7C,EAEnC,IAAI8E,EAAsBjW,KAAKiH,WAAWC,SAAUH,WAAY/G,KAAKkI,KAAOlI,KAAKmI,MAAQ,EAAGrB,SAAU9G,KAAKgI,QACvGkO,EAAqBlW,KAAKiH,WAAWC,SAAUH,UAAW/G,KAAKmI,KAAOnI,KAAK0J,eAAgB5C,SAAU,IAEzG9G,KAAKmW,gBAAkBnW,KAAKiH,WAAWiG,QAAS3K,EAAG2T,EAAW3T,EAAIvC,KAAK8T,YAAc,EAAGtR,EAAGyT,EAAYzT,EAAIxC,KAAKgU,aAAe,IAI/HhU,KAAK6R,gBAAgBuE,aAAgB7T,EAAG2T,EAAW3T,EAAGC,EAAGyT,EAAYzT,EAAGC,MAAOzC,KAAK8T,YAAapR,OAAQ1C,KAAKgU,cAE9GhU,KAAK0S,mBAEL,IAAIb,EAA6B7R,KAAK6R,gBAEtCA,EAAgBtP,EAAI8P,EAAe/M,WAAa,EAChDuM,EAAgBrP,EAAI6P,EAAerO,YAAc,GAE7CgS,GAA0Bf,GAASjV,KAAKmI,MAAQ+M,GAASlV,KAAKkI,MAAQiN,GAAUnV,KAAKgI,OAASoN,GAAUpV,KAAKiI,QAChHoN,EAAA,KAAWrV,KAAKmG,OAAOmP,WAAY,SAACnP,GACnCA,EAAOkQ,iBAYDnF,EAAA5O,UAAAoQ,iBAAV,WACC,IAAIvB,EAEAwE,EAAiB3V,KAAKqS,eAAeuD,WAAa5V,KAAK8T,YACvD+B,EAAiB7V,KAAKqS,eAAeyD,YAAc9V,KAAKgU,aAG3D7C,EADGwE,EAASE,EACCA,EAEAF,GAGV9O,EAAA,MAAYsK,IAAeA,GAAc4E,OAC5C5E,EAAa,GAGVA,GAAcnR,KAAKmR,aACtBnR,KAAKmR,WAAaA,EAElBkE,EAAA,KAAWrV,KAAKmG,OAAOmP,WAAY,SAACnP,GACnCA,EAAO2D,MAAQqH,EACfhL,EAAO0M,wBAGR7S,KAAKsW,SAAS,uBAWTpF,EAAA5O,UAAAoS,cAAP,SAAqBrL,GACpB,IAAIlD,EAA+BnG,KAAKmG,OAAO+M,SAAS,GACxD,GAAI/M,EAAQ,CACX,IAAIoQ,EAAsBjC,EAAA,iBAAwBjL,EAAOlD,GACzD,OAAOnG,KAAKwW,iBAAiBD,KAWxBrF,EAAA5O,UAAAmU,cAAP,SAAqBpN,GACpB,IAAIlD,EAA+BnG,KAAKmG,OAAO+M,SAAS,GACxD,GAAI/M,EAAQ,CACX,IAAIoQ,EAAsBvW,KAAK0W,iBAAiBrN,GAChD,OAAOiL,EAAA,iBAAwBiC,EAAapQ,KAWvC+K,EAAA5O,UAAAkU,iBAAP,SAAwBnN,GACvB,OAAOrJ,KAAKiH,WAAWiG,OAAO7D,IAUxB6H,EAAA5O,UAAAoU,iBAAP,SAAwBrN,GACvB,OAAOrJ,KAAKiH,WAAWC,QAAQmC,IAYhC1G,OAAA0B,eAAW6M,EAAA5O,UAAA,eAcX,WACC,OAAOtC,KAAK2W,cAfb,SAAmBC,GACdA,GAAW5W,KAAK2W,WACnB3W,KAAK2W,SAAWC,EAChB5W,KAAK6W,iBAELxB,EAAA,KAAWrV,KAAK8W,WAAWxB,WAAY,SAAC/S,GACvCA,EAAEsU,qDAsBE3F,EAAA5O,UAAA6B,eAAP,SAAsBkF,EAAkBpF,EAAmB8S,EAAkBC,GAA7E,IAAAlX,EAAAE,KAMC,GAJKqJ,IACJA,EAAQrJ,KAAKoE,cAGTiF,EAAL,CAIArJ,KAAK2S,kBAAoBtJ,EAEzBpF,EAAYwE,EAAA,WAAiBxE,EAAWjE,KAAK8D,aAAc9D,KAAK2D,cAEhE,IAAI4S,EAAsBvW,KAAKiH,WAAWC,QAAQmC,GAE9CgL,EAAmBrU,KAAKyW,cAAcpN,GACtC4N,EAAW3C,EAAA,iBAAwBD,EAAUrU,MA+BjD,OA7BI+W,IACHE,GACC1U,EAAGvC,KAAKiU,SAAW,EACnBzR,EAAGxC,KAAKmU,UAAY,IAIjBtN,EAAA,SAAemQ,KACnBA,EAAWhX,KAAKoR,cAGjBpR,KAAKwS,cAAgBxS,KAAK6R,gBAAgBqF,UAExCjV,SAAU,QACVkV,GAAIlT,IAEJhC,SAAU,IACVkV,GAAIF,EAAS1U,EAAIgU,EAAYhU,EAAI0B,EAAYjE,KAAKmR,WAAanR,KAAKoX,mBAEpEnV,SAAU,IACVkV,GAAIF,EAASzU,EAAI+T,EAAY/T,EAAIyB,EAAYjE,KAAKmR,WAAanR,KAAKqX,kBACjEL,EAAUhX,KAAKqR,YAEpBrR,KAAKoC,WAAWC,KAAKrC,KAAKwS,cAActR,OAAOC,GAAG,iBAAkB,WACnErB,EAAK6S,kBAAoB7S,EAAKsE,gBAG/BpE,KAAK6R,gBAAgBjL,mBAEd5G,KAAKwS,gBAYNtB,EAAA5O,UAAAgV,gBAAP,SAAuBC,EAAsBtT,EAAoB8S,EAAkBC,GAMlF,QAJc7U,GAAV4U,IACHA,GAAS,GAGNQ,aAAqBhR,EAIxB,OAHIM,EAAA,MAAY5C,KACfA,EAAY,GAENjE,KAAKmE,gBAAiB2C,SAAUyQ,EAAUzQ,SAAUC,UAAWwQ,EAAUxQ,WAAa9C,EAAW8S,EAAQC,GAGjH,IAAIjP,EAAWwP,EAAUxP,SAMzB,GAJIA,GAAYlB,EAAA,SAAekB,EAAS9D,aACvCA,EAAY8D,EAAS9D,WAGlBsT,aAAqBpQ,EAAY,CACpC,IAAIqQ,EAAWD,EAAUxP,SACrB0P,EAAOF,EAAUlQ,QAAQoQ,KAExB5Q,EAAA,SAAe5C,KACnBA,EAAYR,KAAKyB,IAAIlF,KAAK8T,YAAc2D,EAAKhV,MAAOzC,KAAKgU,aAAeyD,EAAK/U,SAG9E,IAAI2F,OAAQ,EAEZ,GAAImP,GAAY3Q,EAAA,SAAe2Q,EAASpT,cACvCiE,EAAWmP,EAASpT,iBAEhB,CAEJ,IAAIsT,GAAiBnV,EAAGkV,EAAKlV,EAAIkV,EAAKhV,MAAQ,EAAGD,EAAGiV,EAAKjV,EAAIiV,EAAK/U,OAAS,GACvE6T,EAAcjC,EAAA,oBAA2BoD,EAAcH,EAAUlQ,QAASkQ,EAAUpR,QAExFkC,EAAWrI,KAAKwW,iBAAiBD,GAElC,OAAOvW,KAAKmE,eAAekE,EAAUpE,GAAW,EAAM+S,KAsBjD9F,EAAA5O,UAAAqV,gBAAP,SAAuB3P,EAAeE,EAAcD,EAAeE,EAAcyP,EAAgBb,EAAkBC,GAC9GnQ,EAAA,MAAY+Q,KACfA,EAAQ,GAET,IAAI3T,EAAY2T,EAAQnU,KAAKyB,KAAKlF,KAAKiI,MAAQjI,KAAKgI,QAAUC,EAAQD,IAAShI,KAAKmI,KAAOnI,KAAKkI,OAASC,EAAOD,IAEhH,OAAOlI,KAAKmE,gBAAiB2C,SAAUkB,GAASC,EAAQD,GAAS,EAAGjB,UAAWoB,GAAQD,EAAOC,GAAQ,GAAKlE,EAAW8S,EAAQC,IAWxH9F,EAAA5O,UAAA0C,OAAP,SAAcqD,EAAsB2O,GACnC,OAAOhX,KAAKmE,eAAekE,EAAUrI,KAAKiE,UAAYjE,KAAK0R,UAAU,EAAOsF,IAWtE9F,EAAA5O,UAAAmC,QAAP,SAAe4D,EAAsB2O,GACpC,OAAOhX,KAAKmE,eAAekE,EAAUrI,KAAKiE,UAAYjE,KAAK0R,UAAU,EAAOsF,IAkBtE9F,EAAA5O,UAAAoR,IAAP,SAAWkB,EAAeoC,GACzB,IAAI3N,EAAQrJ,KAAKyW,cAAczW,KAAKoE,cACpCiF,EAAM9G,GAAKvC,KAAKsF,WAAasP,EAAMrS,EACnC8G,EAAM7G,GAAKxC,KAAKgE,YAAc4Q,EAAMpS,EACpCxC,KAAKmE,eAAenE,KAAK0U,cAAcrL,GAAQrJ,KAAKiE,WAAW,EAAM+S,IAUtErU,OAAA0B,eAAW6M,EAAA5O,UAAA,oBAAX,WACC,IAAI+G,EAAQiL,EAAA,kBAA0B/R,EAAGvC,KAAKsF,WAAa,EAAG9C,EAAGxC,KAAKgE,YAAc,GAAKhE,MACzF,OAAOA,KAAK0U,cAAcrL,oCAS3B1G,OAAA0B,eAAW6M,EAAA5O,UAAA,iBAAX,WACC,OAAOtC,KAAK6R,gBAAgB/H,WAG7B,SAAqBpD,GACpB1G,KAAK6R,gBAAgB/H,MAAQpD,mCAMpBwK,EAAA5O,UAAA0P,mBAAV,WACKhS,KAAKiE,WAAajE,KAAK6X,iBAC1B7X,KAAKsW,SAAS,oBACdtW,KAAK6X,eAAiB7X,KAAKiE,YAGxBjE,KAAKoE,cAAiBpE,KAAKuR,kBAAkBzK,UAAY9G,KAAKoE,aAAa0C,UAAY9G,KAAKuR,kBAAkBxK,WAAa/G,KAAKoE,aAAa2C,WAChJ/G,KAAKsW,SAAS,uBA4BhB3T,OAAA0B,eAAW6M,EAAA5O,UAAA,gBAYX,WACC,IAAKtC,KAAK8X,UAAW,CACpB,IAAIC,EAAqB,IAAIC,EAAA,EAC7BhY,KAAK+X,SAAWA,EAEjB,OAAO/X,KAAK8X,eAjBb,SAAoBC,GACf/X,KAAK8X,WACR9X,KAAKiY,cAAcjY,KAAK8X,WAEzB9X,KAAK8X,UAAYC,EACjB/X,KAAK8X,UAAUvU,MAAQvD,KACvB+X,EAASzF,OAAStS,KAAKqS,gDAsCxB1P,OAAA0B,eAAW6M,EAAA5O,UAAA,mBAYX,WACC,OAAOtC,KAAKuT,kBAbb,SAAuB2E,GAClBlY,KAAKuT,cACRvT,KAAKiY,cAAcjY,KAAKuT,cAEzBvT,KAAKuT,aAAe2E,EACpBA,EAAY3U,MAAQvD,KACpBkY,EAAY5F,OAAStS,KAAKqS,gDAejBnB,EAAA5O,UAAA6V,aAAV,WACC,OAAO,IAAIC,EAAA,GAYZzV,OAAA0B,eAAW6M,EAAA5O,UAAA,sBASX,WACC,OAAOtC,KAAKyG,iBAAiB,uBAV9B,SAA0BC,GACrB1G,KAAK2G,iBAAiB,iBAAkB2B,EAAoB5B,KAC/D1G,KAAKgV,wDAsBPrS,OAAA0B,eAAW6M,EAAA5O,UAAA,iBAOX,WACC,OAAOtC,KAAKyG,iBAAiB,kBAR9B,SAAqBC,GACpB1G,KAAK2G,iBAAiB,YAAaD,oCAkBpC/D,OAAA0B,eAAW6M,EAAA5O,UAAA,oBAOX,WACC,OAAOtC,KAAKyG,iBAAiB,qBAR9B,SAAwBC,GACvB1G,KAAK2G,iBAAiB,eAAgBD,oCAkBvC/D,OAAA0B,eAAW6M,EAAA5O,UAAA,qBAOX,WACC,OAAOtC,KAAKyG,iBAAiB,sBAR9B,SAAyBC,GACxB1G,KAAK2G,iBAAiB,gBAAiBD,oCAiBxC/D,OAAA0B,eAAW6M,EAAA5O,UAAA,gBAOX,WACC,OAAOtC,KAAKyG,iBAAiB,iBAR9B,SAAoBC,GACnB1G,KAAK2G,iBAAiB,WAAYD,oCAazBwK,EAAA5O,UAAA0S,qBAAV,WACChV,KAAKoS,iBAELpS,KAAKiH,WAAWyC,eAAiB1J,KAAK0J,eAEtC2L,EAAA,KAAWrV,KAAKmG,OAAOmP,WAAY,SAACnP,GACnCA,EAAOkQ,gBAST1T,OAAA0B,eAAW6M,EAAA5O,UAAA,qBAiBX,WAIC,OAHKtC,KAAKqY,aAAsB,SAC/BrY,KAAKsY,cAAc,WAEbtY,KAAKqY,aAAsB,aArBnC,SAAyB3R,GAAzB,IAAA5G,EAAAE,KACKA,KAAKqY,aAAsB,SAC9BrY,KAAKiY,cAAcjY,KAAKqY,aAAsB,SAE/CrY,KAAKqY,aAAsB,QAAI3R,EAC/B1G,KAAKqY,aAAsB,QAAEE,UAAYvY,KACzCA,KAAKkB,OAAOC,GAAG,SAAU,WACxBrB,EAAK0Y,SAAS,YACZxY,MAAM,GACTA,KAAKyY,oBAAoB/R,EAAO,4CAqB1BwK,EAAA5O,UAAAoW,cAAP,SAAqBC,GAGhB9R,EAAA,SAAe8R,EAAmB,aAAM9R,EAAA,SAAe8R,EAAmB,cAC7EA,EAAmB,WAAI3Y,KAAK4Y,oBAAoBD,EAAmB,aAIhE9R,EAAA,SAAe8R,EAAOZ,YAAclR,EAAA,SAAe8R,EAAOZ,SAASc,QACtEF,EAAOZ,SAASc,KAAO,YAIpBhS,EAAA,SAAe8R,EAAOT,eAAiBrR,EAAA,SAAe8R,EAAOT,YAAYW,QAC5EF,EAAOT,YAAYW,KAAO,eAG3BhZ,EAAAyC,UAAMoW,cAAa3Y,KAAAC,KAAC2Y,IAcXzH,EAAA5O,UAAAwW,YAAV,SAAsBvI,EAAWwI,GAChC,OAAIxI,GAAKwI,EACD,EAGM,YAALxI,EACD,EAEM,YAALwI,GACA,EAEK,UAALxI,EACD,EAEM,UAALwI,GACA,EAGDlZ,EAAAyC,UAAMwW,YAAW/Y,KAAAC,KAACuQ,EAAGwI,IAUpB7H,EAAA5O,UAAA0W,KAAV,SAAeC,GACd,MAAgB,cAATA,GAAyBpZ,EAAAyC,UAAM0W,KAAIjZ,KAAAC,KAACiZ,IAQ5CtW,OAAA0B,eAAW6M,EAAA5O,UAAA,sBAAX,WACC,OAAOtC,KAAKmW,iDAONjF,EAAA5O,UAAAsR,OAAP,SAAcoD,GACb,IAAIkC,EAAelZ,KAAKkZ,aACnBA,IACJA,EAAelZ,KAAKmZ,gBAEjBD,GACHlZ,KAAKmE,eAAe+U,EAAclZ,KAAKyR,eAAe,EAAMuF,IAWvD9F,EAAA5O,UAAA8W,SAAP,SAAgBC,GAKf,OAJIrZ,KAAKwU,eACRxU,KAAKwU,aAAa8E,cAAe,GAG3BzZ,EAAAyC,UAAM8W,SAAQrZ,KAAAC,KAACqZ,IAQbnI,EAAA5O,UAAAiX,UAAV,SAAoBC,GACnB3Z,EAAAyC,UAAMiX,UAASxZ,KAAAC,KAACwZ,GACZA,IACHA,EAAOlH,OAAStS,KAAKqS,iBAGxBnB,EA/uCA,CAA8BF,EAAA,GAuvC9B1K,EAAA,EAASV,kBAA4B,SAAIqL,ECz9CzC,IAAAwI,EAAA,SAAA5Z,GA2BC,SAAA6Z,IAAA,IAAA5Z,EACCD,EAAAE,KAAAC,OAAOA,YACPF,EAAK6Z,gBAAiB,EACtB7Z,EAAKI,UAAY,gBACjBJ,EAAKiG,YAAa,EAClBjG,EAAKO,OAAS,OACdP,EAAKiC,eAsEP,OAvGmCkE,EAAA,EAAAyT,EAAA7Z,GAyC3B6Z,EAAApX,UAAAsE,iBAAP,WACC,GAAI5G,KAAK4Z,QAAS,CACjB,IAAIvQ,EAA2BrJ,KAAK4Z,QAAQC,gBAAgB7Z,KAAK0P,UASjE,GARA1P,KAAKuC,EAAI8G,EAAM9G,EACfvC,KAAKwC,EAAI6G,EAAM7G,EAEXxC,KAAK2Z,iBACR3Z,KAAK8Z,SAAWzQ,EAAMC,OAGRtJ,KAAK4Z,QAAQ7R,SACd,CACb,IAAI5B,EAASnG,KAAK4Z,QAAQ7R,SAASwQ,UACnCvY,KAAK8J,MAAQ,EAAI3D,EAAO2D,OAI1BjK,EAAAyC,UAAMsE,iBAAgB7G,KAAAC,OAavB2C,OAAA0B,eAAWqV,EAAApX,UAAA,gBAOX,WACC,OAAOtC,KAAKyG,iBAAiB,iBAR9B,SAAoBC,GACnB1G,KAAK2G,iBAAiB,WAAYD,GAAO,GAAO,oCAoBjD/D,OAAA0B,eAAWqV,EAAApX,UAAA,sBAOX,WACC,OAAOtC,KAAKyG,iBAAiB,uBAR9B,SAA0BC,GACzB1G,KAAK2G,iBAAiB,iBAAkBD,GAAO,GAAO,oCAUxDgT,EAvGA,CAAmCrT,EAAA,GA+GnCC,EAAA,EAASV,kBAAiC,cAAI6T,kECxG9CM,EAAA,SAAAla,GA8DC,SAAAma,IAAA,IAAAla,EAGCD,EAAAE,KAAAC,OAAOA,KACPF,EAAKI,UAAY,UAEjBJ,EAAKma,aACLna,EAAKoa,KAAK1S,OAAS7E,OAAAwX,EAAA,EAAAxX,GACnB7C,EAAKoa,KAAK5H,OAASxS,EACnBA,EAAK2H,cAAgB,EAGrB,IAAIlH,EAAkB,IAAIgH,EAAA,SAE1BzH,EAAK0H,OAASjH,EAAgBS,OAAO,QACrClB,EAAKsa,kBAAmB,EAGxBta,EAAKiC,eA+SP,OA/X6BkE,EAAA,EAAA+T,EAAAna,GAuFlBma,EAAA1X,UAAA2X,WAAV,WACCja,KAAKka,KAAO,IAAIG,EAAA,GAYVL,EAAA1X,UAAAuX,gBAAP,SAAuBnK,GACtB,OAAI1P,KAAKka,KACDla,KAAKka,KAAKL,gBAAgBnK,IAEzBnN,EAAG,EAAGC,EAAG,EAAG8G,MAAO,IAS7B3G,OAAA0B,eAAW2V,EAAA1X,UAAA,oBAOX,WACC,OAAOtC,KAAKyG,iBAAiB,qBAR9B,SAAwB6T,GACvBta,KAAK2G,iBAAiB,eAAgBiC,EAAwB0R,IAAe,oCAmB9E3X,OAAA0B,eAAW2V,EAAA1X,UAAA,uBAyBX,WACC,OAAOtC,KAAKyG,iBAAiB,wBA1B9B,SAA2B8T,GAE1B,IAFD,IAAAza,EAAAE,KAEU8K,EAAI,EAAGC,EAAMwP,EAAOvP,OAAQF,EAAIC,EAAKD,IAAK,CAClD,IAAI0P,EAAQD,EAAOzP,GACnB,GAAIjE,EAAA,SAAe2T,GAAQ,CAC1B,IAAIxa,KAAKya,IAAIC,OAAOF,GAKnB,SAJAA,EAAkBxa,KAAKya,IAAIE,OAAOH,GAClCD,EAAOzP,GAAK0P,EAMdA,EAAMtZ,OAAOC,GAAG,kBAAmB,SAACa,GACb,aAAlBA,EAAMC,UAA6C,YAAlBD,EAAMC,UAC1CnC,EAAKuW,cAEJrW,MAAM,GAEVA,KAAK2G,iBAAiB,kBAAmB4T,oCAenCP,EAAA1X,UAAA4D,SAAP,WACC,QAAI3C,EAAkBvD,KAAKmG,OAAO5C,MAE9B+W,EAA8Bta,KAAKsa,iBAEvC,GAAIta,KAAK4a,gBAAiB,CACzB,IAAI1R,KACJoR,GAAgBpR,OAEhB,IAAkB,IAAA2R,EAAA5U,EAAA,EAAAjG,KAAK4a,iBAAeE,EAAAD,EAAA7R,QAAA8R,EAAA7R,KAAA6R,EAAAD,EAAA7R,OAAA,CAAjC,IAAIwR,EAAKM,EAAApU,MACbwC,EAAQ7G,MAAO0E,UAAsByT,EAAOzT,UAAWD,SAAqB0T,EAAO1T,8GAIrF,GAAI9G,KAAKoa,iBAAkB,CAG1B,IAFA,IAAIW,KAEKjQ,EAAI,EAAGC,EAAMuP,EAAatP,OAAQF,EAAIC,EAAKD,IAAK,CAIxD,IAHA,IAAIV,EAAuBkQ,EAAaxP,GACpCkQ,KAEKvM,EAAI,EAAGwM,EAAO7Q,EAAQY,OAAQyD,EAAIwM,EAAMxM,IAAK,CAQrD,IAPA,IAAIyM,EAAuB9Q,EAAQqE,EAAI,GACnC0M,EAAuB/Q,EAAQqE,GAE/BtJ,EAAuI,EAAnH1B,KAAKyQ,IAAIzQ,KAAKkF,IAAIuS,EAAUpU,SAAWqU,EAAUrU,UAAWrD,KAAKkF,IAAIuS,EAAUnU,UAAYoU,EAAUpU,YAIpH/H,EAAI,EAAGA,EAAImG,EAAWnG,IAAK,CACnC,IAAIuQ,EAAoBhM,EAAM0D,WAAWsI,kBAAkB2L,EAAWC,EAAWnc,EAAImG,GAErF,GAAI6V,EAAWhQ,OAAS,EAAG,CAC1B,IAAIoQ,EAAgBJ,EAAWA,EAAWhQ,OAAS,GAC/CvH,KAAKkF,IAAIyS,EAAcrU,UAAYwI,EAAkBxI,WAAa,MACrEgU,EAAgB1Y,KAAK2Y,GACrBA,MAIFA,EAAW3Y,KAAKkN,GAGjByL,EAAW3Y,KAAK8Y,GAEjBJ,EAAgB1Y,KAAK2Y,GAEtBV,EAAeS,EAGhB/a,KAAKka,KAAKmB,SAAW9X,EAAM0D,WAAWkD,eAAemQ,GAEjDta,KAAKsb,QACRtb,KAAKsb,OAAO1U,mBAGbyO,EAAA,KAAWrV,KAAKub,YAAYjG,WAAY,SAAC/S,GACxCA,EAAEqE,qBAGH5G,KAAKwb,oBAEL3b,EAAAyC,UAAM4D,SAAQnG,KAAAC,OAMRga,EAAA1X,UAAAwF,eAAP,aAcAnF,OAAA0B,eAAW2V,EAAA1X,UAAA,wBAOX,WACC,OAAOtC,KAAKyG,iBAAiB,yBAR9B,SAA4BC,GAC3B1G,KAAK2G,iBAAiB,mBAAoBD,GAAO,oCAiBlD/D,OAAA0B,eAAW2V,EAAA1X,UAAA,mBAAX,WAQC,OAPKtC,KAAKyb,eACTzb,KAAKyb,aAAe,IAAIC,EAAA,EAA4B,IAAIjC,GACxDzZ,KAAKyb,aAAava,OAAOC,GAAG,WAAYnB,KAAK2b,sBAAuB3b,MAAM,GAC1EA,KAAKoC,WAAWC,KAAK,IAAIqZ,EAAA,EAAa1b,KAAKyb,eAC3Czb,KAAKoC,WAAWC,KAAKrC,KAAKyb,aAAaG,WAGjC5b,KAAKyb,8CAQHzB,EAAA1X,UAAAqZ,sBAAV,SAAgC3Z,GAC/B,IAAI6Z,EAA+B7Z,EAAM8Z,SACzCD,EAAcjC,QAAU5Z,KACxB6b,EAAcnb,aAAc,EAC5Bmb,EAAcvJ,OAAStS,MAWxB2C,OAAA0B,eAAW2V,EAAA1X,UAAA,aASX,WACC,IAAKtC,KAAKsb,OAAQ,CACjB,IAAIS,EAAuB/b,KAAKS,YAAYgZ,GAC5CsC,EAAMrb,aAAc,EACpBqb,EAAMtZ,MAAQ,EACdsZ,EAAMrZ,OAAS,GACfqZ,EAAMnC,QAAU5Z,KAChB+b,EAAMrM,SAAW,GAEjB,IAAIsM,EAAWD,EAAMtb,YAAYwb,EAAA,GAEjCD,EAAS/a,YAAc,EACvB+a,EAASvZ,MAAQE,OAAAuZ,EAAA,EAAAvZ,CAAQ,KACzBqZ,EAAStZ,OAASC,OAAAuZ,EAAA,EAAAvZ,CAAQ,KAC1BqZ,EAASlC,SAAW,GACpBkC,EAASG,iBAAmB,SAC5BH,EAASI,eAAiB,SAC1Bpc,KAAKsb,OAASS,EAEf,OAAO/b,KAAKsb,YA5Bb,SAAiBS,GAChB/b,KAAKsb,OAASS,EACdA,EAAMnC,QAAU5Z,KAChB+b,EAAMzJ,OAAStS,sCAkCTga,EAAA1X,UAAA+Z,SAAP,SAAgBC,GACfzc,EAAAyC,UAAM+Z,SAAQtc,KAAAC,KAACsc,GACftc,KAAKka,KAAKmC,SAASC,EAAOpC,MAC1Bla,KAAKub,YAAYc,SAASC,EAAOf,aAC7Be,EAAOhB,SACVtb,KAAK+b,MAAuBO,EAAOP,MAAMQ,UAU3C5Z,OAAA0B,eAAW2V,EAAA1X,UAAA,gBAAX,WACC,IAAIyF,EAAW/H,KAAK+H,SACpB,OAAOA,EAASC,OAASD,EAASE,MAAQF,EAASC,OAAS,mCAS7DrF,OAAA0B,eAAW2V,EAAA1X,UAAA,iBAAX,WACC,IAAIyF,EAAW/H,KAAK+H,SACpB,OAAOA,EAASG,MAAQH,EAASI,KAAOJ,EAASG,MAAQ,mCAQhD8R,EAAA1X,UAAAka,YAAV,WACC,OAAOxc,KAAKka,KAAKL,gBAAgB,IAAKtX,GAQ7ByX,EAAA1X,UAAAma,YAAV,WACC,OAAOzc,KAAKka,KAAKL,gBAAgB,IAAKrX,GAExCwX,EA/XA,CAA6BnU,GAuY7BS,EAAA,EAASV,kBAA2B,QAAImU,kBCraxC2C,EAAA,SAAA7c,GAmCC,SAAA8c,IAAA,IAAA7c,EAGCD,EAAAE,KAAAC,OAAOA,YACPF,EAAKI,UAAY,YAGjBJ,EAAKiC,eA2BP,OArE+BkE,EAAA,EAAA0W,EAAA9c,GAiDpB8c,EAAAra,UAAA2X,WAAV,WACCja,KAAKka,KAAO,IAAI0C,EAAA,EAChB5c,KAAKka,KAAK2C,SAAW,GACrB7c,KAAKka,KAAK4C,SAAW,IAUtBna,OAAA0B,eAAWsY,EAAAra,UAAA,wBAAX,WACC,OAAO,OAGR,SAA4BoE,qCAG7BiW,EArEA,CAA+B5C,GA6E/BzT,EAAA,EAASV,kBAA6B,UAAI8W,kBC7E1CK,EAAA,SAAAld,GA8BC,SAAAmd,IAAA,IAAAld,EAGCD,EAAAE,KAAAC,OAAOA,YACPF,EAAKI,UAAY,SAGjBJ,EAAKiC,eA6BP,OAlE4BkE,EAAA,EAAA+W,EAAAnd,GA4CjBmd,EAAA1a,UAAA2X,WAAV,WACCja,KAAKka,KAAO,IAAI+C,EAAA,GAYjBta,OAAA0B,eAAW2Y,EAAA1a,UAAA,wBAIX,WACC,OAAO,OALR,SAA4BoE,qCAS7BsW,EAlEA,CAA4BjD,GCnCrB,SAAAmD,EAA2BC,GAGjC,IAFA,IAAIC,KAEKtS,EAAI,EAAGC,EAAMoS,EAAanS,OAAQF,EAAIC,EAAKD,IAAK,CAExD,IAAIU,EAAsB2R,EAAarS,GAAG,GACtCW,EAAmB0R,EAAarS,GAAG,GAIvCsS,EAAatS,MAETU,GACH4R,EAAatS,GAAGzI,KAAKgb,EAAgB7R,IAGlCC,GACH2R,EAAatS,GAAGzI,KAAKgb,EAAgB5R,IAGvC,OAAO2R,EAUD,SAAAE,EAAwBC,GAG9B,IAFA,IAAIjD,KAEKxP,EAAI,EAAGC,EAAMwS,EAAUvS,OAAQF,EAAIC,EAAKD,IAChDwP,EAAajY,KAAKgb,EAAgBE,EAAUzS,KAE7C,OAAOwP,EASD,SAAA+C,EAAyBzV,GAE/B,IADA,IAAIwH,KACKtE,EAAI,EAAGC,EAAMnD,EAAOoD,OAAQF,EAAIC,EAAKD,IAC7CsE,EAAU/M,KAAKmb,EAAW5V,EAAOkD,KAElC,OAAOsE,EASD,SAAAoO,EAAoBnU,GAC1B,OAAStC,UAAWsC,EAAM,GAAIvC,SAAUuC,EAAM,IDiD/C/C,EAAA,EAASV,kBAA0B,OAAImX,8BE9FvCU,EAAA,SAAA5d,GAmCC,SAAA6d,IAAA,IAAA5d,EACCD,EAAAE,KAAAC,OAAOA,YACPF,EAAKI,UAAY,2BACjBJ,EAAKiC,eAuLP,OA7N8CkE,EAAA,EAAAyX,EAAA7d,GA+C7C8C,OAAA0B,eAAWqZ,EAAApb,UAAA,kBAAX,eAAAxC,EAAAE,KACC,IAAKA,KAAK2d,YAAa,CACtB,IAAIC,EAAa5d,KAAKuY,UAAUsF,YAAYC,SAC5C9d,KAAK2d,YAAcC,EACnB5d,KAAK+d,UAAUH,GAEf5d,KAAKoC,WAAWC,KAAKub,GACrB5d,KAAKoC,WAAWC,KAAK,IAAI2b,EAAA,EAAS,WAC7Ble,EAAKyY,WACRzY,EAAKyY,UAAUsF,YAAYI,YAAYL,MAI1C,OAAO5d,KAAK2d,6CAoBbhb,OAAA0B,eAAWqZ,EAAApb,UAAA,eAQX,WACC,OAAOtC,KAAKke,cATb,SAAmB7W,GAClBrH,KAAKke,SAAW7W,EAChBrH,KAAK2H,gBAAkBuV,GAA6B7V,qCAyCrD1E,OAAA0B,eAAWqZ,EAAApb,UAAA,oBAQX,WACC,OAAOtC,KAAKme,mBATb,SAAwBhB,GACvBnd,KAAKme,cAAgBhB,EACrBnd,KAAK2H,gBAAkBuV,EAA4BC,oCA2BpDxa,OAAA0B,eAAWqZ,EAAApb,UAAA,kBAQX,WACC,OAAOtC,KAAKoe,iBATb,SAAsBC,GACrBre,KAAKoe,YAAcC,EACnBre,KAAK2H,iBAAmB0W,oCAuCzB1b,OAAA0B,eAAWqZ,EAAApb,UAAA,uBASX,WACC,OAAOtC,KAAKse,sBAVb,SAA2B3W,GAC1B3H,KAAKse,iBAAmB3W,EACxB3H,KAAKue,mBAAmB5W,GACxB3H,KAAKwe,WAAW7W,gBAAkB3H,KAAKse,kDAiBjCZ,EAAApb,UAAAic,mBAAP,SAA0B5W,GACzB,IAAK,IAAImD,EAAI,EAAGC,EAAMpD,EAAgBqD,OAAQF,EAAIC,EAAKD,IAAK,CAC3D,IACIU,EAD4B7D,EAAgBmD,GACV,GACtC9K,KAAKoS,eAAe5G,KAIvBkS,EA7NA,CAA8CtF,EAAA,GAkS9CqG,EAAA,SAAA5e,GAwCC,SAAA6e,IAAA,IAAA5e,EAGCD,EAAAE,KAAAC,OAAOA,YAEPF,EAAK6e,oBAAsB,IAE3B7e,EAAKI,UAAY,mBAGjBJ,EAAK8e,WAAWzB,aAAe,eAC/Brd,EAAK8e,WAAWvX,QAAU,UAE1BvH,EAAK8e,WAAWP,WAAa,aAC7Bve,EAAK8e,WAAWjX,gBAAkB,kBAGlC7H,EAAKiC,eAkLP,OA3OsCkE,EAAA,EAAAyY,EAAA7e,GAmE3B6e,EAAApc,UAAAuc,eAAV,WACC,OAAO,IAAIpB,GAMFiB,EAAApc,UAAAwc,cAAV,WACC9e,KAAK6d,YAAYkB,QACjBlf,EAAAyC,UAAMwc,cAAa/e,KAAAC,OASb0e,EAAApc,UAAA0c,aAAP,eAAAlf,EAAAE,KAWC,GAVIA,KAAKif,KAAKjU,OAAS,GAA4B,GAAvBhL,KAAKkf,gBAChClf,KAAK6d,YAAYkB,QAGlB/e,KAAKmI,KAAO,KACZnI,KAAKkI,KAAO,KACZlI,KAAKgI,MAAQ,KACbhI,KAAKiI,MAAQ,KAGTjI,KAAKmf,YAAcnf,KAAK4W,QAAS,CACpC,IAAIwI,EAAgBpf,KAAKqY,aAAsB,aAAyBlW,EAArBnC,KAAKuD,MAAMqT,QAM9D,GAJG5W,KAAK4W,UACPwI,EAAUpf,KAAK4W,SAGZwI,EAAS,CAEZ,IAAIC,OAAQ,EAeZ,GAboB,qBAAhBD,EAAQvG,KACXwG,EAAWD,EAAQC,SAEK,WAAhBD,EAAQvG,KAChBwG,GAAYD,IAE0G,IAA7G,QAAS,aAAc,UAAW,aAAc,kBAAmB,gBAAgBE,QAAQF,EAAQvG,MAC5GwG,IAAcE,SAAUH,IAGxBI,QAAQ9b,IAAI,4BAGT2b,EACH,mBAASvU,EAAOC,GAEf,IAAI0U,EAAeJ,EAASvU,GACxByU,EAAgBE,EAAQF,SAC5B,GAAIA,EAAU,CACb,IAAI1G,EAAyC0G,EAAS1G,KAClD6G,EAAaD,EAAQE,GAEzB,GAAY,WAAR9G,GAA6B,gBAARA,EAAwB,CAEhD,IAAK+G,EAAKC,aAAaD,EAAKE,QAASF,EAAKG,QAASL,oBAInD,IAAIM,EAAqBT,EAASS,YAE9BA,GAES,WAARnH,IACHmH,GAAeA,IAKjB,IAAIC,EAAoCC,EAAA,KAAYN,EAAKX,KAAM,SAACvY,EAAOoE,GACtE,OAAOpE,EAAMiZ,IAAMD,IAKfO,EAOCA,EAAW9C,eACf8C,EAAW9C,aAAe6C,IAP3BC,GAAe9C,aAAc6C,EAAaL,GAAID,GAC9CE,EAAKX,KAAK5c,KAAK4d,IAWhB3L,EAAA,mBAA0BmL,EAAQU,WAAYF,aA3CxCnV,EAAI,EAAGC,EAAMsU,EAASrU,OAAQF,EAAIC,EAAKD,MAAvCA,IAmDZjL,EAAAyC,UAAM0c,aAAYjf,KAAAC,MAIlBqV,EAAA,KAAWrV,KAAKogB,UAAU9K,WAAY,SAACvN,GACtCjI,EAAK+d,YAAYwC,UAAUtY,EAASyW,eAS/BE,EAAApc,UAAA4D,SAAP,WACCrG,EAAAyC,UAAM4D,SAAQnG,KAAAC,MACdqV,EAAA,KAAWrV,KAAK6d,YAAYvI,WAAY,SAACkJ,GACxCA,EAAWtY,cASbvD,OAAA0B,eAAWqa,EAAApc,UAAA,mBAAX,WAEC,IAAKtC,KAAKsgB,aAAc,CACvB,IAAIC,EAA8B,IAAIpZ,EAElC0W,EAAwC,IAAInC,EAAA,EAAyB6E,GACzEvgB,KAAKoC,WAAWC,KAAK,IAAIqZ,EAAA,EAAamC,IACtC7d,KAAKoC,WAAWC,KAAKwb,EAAYjC,UACjCiC,EAAYjC,SAASxI,WAAY,EACjCyK,EAAY3c,OAAOC,GAAG,WAAYnB,KAAKwgB,kBAAmBxgB,MAAM,GAChEA,KAAKsgB,aAAezC,EAGrB,OAAO7d,KAAKsgB,8CAQN5B,EAAApc,UAAAme,eAAP,SAAsBd,GACrB,OAAOtK,EAAA,KAAWrV,KAAK6d,YAAYvI,WAAY,SAACkJ,GAE/C,OADuBA,EAAWzW,SAAS2Y,YACxBf,IAAMA,KASpBjB,EAAApc,UAAA+Z,SAAP,SAAgBC,GACftc,KAAK6d,YAAYjC,SAASS,SAASC,EAAOuB,YAAYjC,UACtD/b,EAAAyC,UAAM+Z,SAAQtc,KAAAC,KAACsc,IAEjBoC,EA3OA,CAAsCtG,EAAA,GAmPtC9R,EAAA,EAASV,kBAAoC,iBAAI6Y,EACjDnY,EAAA,EAASV,kBAA4C,yBAAI6X,ECthBzD,IAAAkD,EAAA,SAAA9gB,GAmCC,SAAA+gB,IAAA,IAAA9gB,EACCD,EAAAE,KAAAC,OAAOA,YACPF,EAAKI,UAAY,wBACjBJ,EAAKiC,eA6JP,OAnM2CkE,EAAA,EAAA2a,EAAA/gB,GA+C1C8C,OAAA0B,eAAWuc,EAAAte,UAAA,eAAX,eAAAxC,EAAAE,KACC,IAAKA,KAAK6gB,SAAU,CACnB,IAAIC,EAAU9gB,KAAKuY,UAAUwI,SAASjD,SAEtC9d,KAAK6gB,SAAWC,EAChB9gB,KAAK+d,UAAU+C,GAEf9gB,KAAKoC,WAAWC,KAAKye,GACrB9gB,KAAKoC,WAAWC,KAAK,IAAI2b,EAAA,EAAS,WAC7Ble,EAAKyY,WACRzY,EAAKyY,UAAUwI,SAAS9C,YAAY6C,MAIvC,OAAO9gB,KAAK6gB,0CAeble,OAAA0B,eAAWuc,EAAAte,UAAA,YAQX,WACC,OAAOtC,KAAKghB,WATb,SAAgB9G,GACfla,KAAKghB,MAAQ9G,EACbla,KAAKsa,aAAegD,GAA0BpD,qCA+B/CvX,OAAA0B,eAAWuc,EAAAte,UAAA,iBAQX,WACC,OAAOtC,KAAKihB,gBATb,SAAqB1D,GACpBvd,KAAKihB,WAAa1D,EAClBvd,KAAKsa,aAAegD,EAAyBC,oCAuB9C5a,OAAA0B,eAAWuc,EAAAte,UAAA,eAQX,WACC,OAAOtC,KAAKkhB,cATb,SAAmB9W,GAClBpK,KAAKkhB,SAAW9W,EAChBpK,KAAKsa,cAAgBlQ,oCAgCtBzH,OAAA0B,eAAWuc,EAAAte,UAAA,oBASX,WACC,OAAOtC,KAAKmhB,mBAVb,SAAwB7G,GACvBta,KAAKmhB,cAAgB7G,EACrBta,KAAKohB,mBAAmB9G,GACxBta,KAAK4Z,QAAQU,aAAeta,KAAKmhB,+CAiB3BP,EAAAte,UAAA8e,mBAAP,SAA0B9G,GACzB,IAAK,IAAIxP,EAAI,EAAGC,EAAMuP,EAAatP,OAAQF,EAAIC,EAAKD,IAAK,CACxD,IAAIV,EAAuBkQ,EAAaxP,GACxC9K,KAAKoS,eAAehI,KAIvBwW,EAnMA,CAA2CxI,EAAA,GAwQ3CiJ,EAAA,SAAAxhB,GA8CC,SAAAyhB,IAAA,IAAAxhB,EAGCD,EAAAE,KAAAC,OAAOA,YACPF,EAAKI,UAAY,gBAGjBJ,EAAK8e,WAAWrB,UAAY,YAC5Bzd,EAAK8e,WAAW1E,KAAO,OAEvBpa,EAAK8e,WAAWxU,QAAU,UAC1BtK,EAAK8e,WAAWtE,aAAe,eAG/Bxa,EAAKiC,eAgJP,OA5MmCkE,EAAA,EAAAqb,EAAAzhB,GAsExByhB,EAAAhf,UAAAuc,eAAV,WACC,OAAO,IAAI8B,GASLW,EAAAhf,UAAA0c,aAAP,eAAAlf,EAAAE,KAMC,GALIA,KAAKif,KAAKjU,OAAS,GAA4B,GAAvBhL,KAAKkf,gBAChClf,KAAK+gB,SAAShC,QAIX/e,KAAKmf,YAAcnf,KAAK4W,QAAS,CACpC,IAAIwI,EAAepf,KAAKuD,MAAMqT,QAC9B,GAAIwI,EAAS,CAEZ,IAAIC,OAAQ,EAeZ,GAboB,qBAAhBD,EAAQvG,KACXwG,EAAWD,EAAQC,SAEK,WAAhBD,EAAQvG,KAChBwG,GAAYD,IAE0G,IAA7G,QAAS,aAAc,UAAW,aAAc,kBAAmB,gBAAgBE,QAAQF,EAAQvG,MAC5GwG,IAAcE,SAAUH,IAGxBI,QAAQ9b,IAAI,4BAGT2b,EACH,mBAASvU,EAAOC,GAEf,IAAI0U,EAAeJ,EAASvU,GACxByU,EAAgBE,EAAQF,SAC5B,GAAIA,EAAU,CACb,IAAI1G,EAAyC0G,EAAS1G,KAClD6G,EAAaD,EAAQE,GACzB,GAAY,cAAR9G,GAAgC,mBAARA,EAA2B,CAEtD,IAAK+G,EAAKC,aAAaD,EAAKE,QAASF,EAAKG,QAASL,oBAInD,IAAIM,EAAqBT,EAASS,YAC9BC,EAAiCC,EAAA,KAAYN,EAAKX,KAAM,SAACvY,EAAOoE,GACnE,OAAOpE,EAAMiZ,IAAMD,IAGR,cAAR7G,IACHmH,GAAeA,IAGXC,EAKCA,EAAW1C,YACf0C,EAAW1C,UAAYyC,IALxBC,GAAe1C,UAAWyC,EAAaL,GAAID,GAC3CE,EAAKX,KAAK5c,KAAK4d,IAQhB3L,EAAA,mBAA0BmL,EAAQU,WAAYF,aAhCxCnV,EAAI,EAAGC,EAAMsU,EAASrU,OAAQF,EAAIC,EAAKD,MAAvCA,IAwCZjL,EAAAyC,UAAM0c,aAAYjf,KAAAC,MAGlBqV,EAAA,KAAWrV,KAAKogB,UAAU9K,WAAY,SAACvN,GACtCjI,EAAKihB,SAASV,UAAUtY,EAAS6R,YASnCjX,OAAA0B,eAAWid,EAAAhf,UAAA,gBAAX,WAEC,IAAKtC,KAAKuhB,UAAW,CACpB,IAAIC,EAAwBxhB,KAAKia,aAC7B8G,EAAW,IAAIrF,EAAA,EAAsB8F,GACzCxhB,KAAKoC,WAAWC,KAAK,IAAIqZ,EAAA,EAAaqF,IACtC/gB,KAAKoC,WAAWC,KAAK0e,EAASnF,UAC9BmF,EAAS7f,OAAOC,GAAG,WAAYnB,KAAKwgB,kBAAmBxgB,MAAM,GAC7DA,KAAKuhB,UAAYR,EAGlB,OAAO/gB,KAAKuhB,2CAQHD,EAAAhf,UAAA2X,WAAV,WACC,OAAO,IAAIF,GAQLuH,EAAAhf,UAAA4D,SAAP,WACCrG,EAAAyC,UAAM4D,SAAQnG,KAAAC,MACdqV,EAAA,KAAWrV,KAAK+gB,SAASzL,WAAY,SAACsE,GACrCA,EAAQ1T,cASHob,EAAAhf,UAAA+Z,SAAP,SAAgBC,GACftc,KAAK+gB,SAASnF,SAASS,SAASC,EAAOyE,SAASnF,UAChD/b,EAAAyC,UAAM+Z,SAAQtc,KAAAC,KAACsc,IAGjBgF,EA5MA,CAAmClJ,EAAA,GAoNnC9R,EAAA,EAASV,kBAAiC,cAAIyb,EAC9C/a,EAAA,EAASV,kBAAyC,sBAAI+a,ECletD,IAAAc,GAAA,SAAA5hB,GAeC,SAAA6hB,IAAA,IAAA5hB,EACCD,EAAAE,KAAAC,OAAOA,YACPF,EAAKI,UAAY,0BACjBJ,EAAKiC,eAGP,OArB6CkE,EAAA,EAAAyb,EAAA7hB,GAqB7C6hB,EArBA,CAA6Cf,GAoE7CgB,GAAA,SAAA9hB,GAmCC,SAAA+hB,IAAA,IAAA9hB,EACCD,EAAAE,KAAAC,OAAOA,YACPF,EAAKI,UAAY,kBACjBJ,EAAKiC,eAsBP,OA5DqCkE,EAAA,EAAA2b,EAAA/hB,GA+C1B+hB,EAAAtf,UAAAuc,eAAV,WACC,OAAO,IAAI4C,IAQFG,EAAAtf,UAAA2X,WAAV,WACC,OAAO,IAAIyC,GAGbkF,EA5DA,CAAqCP,GAoErC/a,EAAA,EAASV,kBAAmC,gBAAI+b,GAChDrb,EAAA,EAASV,kBAA2C,wBAAI6b,GCnIxD,IAAAI,GAAA,SAAAhiB,GA2BC,SAAAiiB,IAAA,IAAAhiB,EACCD,EAAAE,KAAAC,OAAOA,YACPF,EAAKI,UAAY,yBACjBJ,EAAKiC,eA6DP,OA3F4CkE,EAAA,EAAA6b,EAAAjiB,GAsC3C8C,OAAA0B,eAAWyd,EAAAxf,UAAA,gBAAX,eAAAxC,EAAAE,KACC,IAAKA,KAAK+hB,UAAW,CACpB,IAAIC,EAAWhiB,KAAKuY,UAAU0J,UAAUnE,SACxC9d,KAAK+d,UAAUiE,GACfhiB,KAAK+hB,UAAYC,EACjBhiB,KAAKoC,WAAWC,KAAK2f,GACrBhiB,KAAKoC,WAAWC,KAAK,IAAI2b,EAAA,EAAS,WAC7Ble,EAAKyY,WACRzY,EAAKyY,UAAU0J,UAAUhE,YAAY+D,MAIxC,OAAOhiB,KAAK+hB,2CASbpf,OAAA0B,eAAWyd,EAAAxf,UAAA,aAQX,WACC,OAAOtC,KAAKkiB,YATb,SAAiB7Y,GAChBrJ,KAAKkiB,OAAS7Y,EACdrJ,KAAKqI,SAAWmV,EAAqBnU,oCAetC1G,OAAA0B,eAAWyd,EAAAxf,UAAA,gBAWX,WACC,OAAOtC,KAAKmiB,eAZb,SAAoB9Z,GACnBrI,KAAKmiB,UAAY9Z,EACjBrI,KAAKoS,gBAAgBpS,KAAKmiB,YAE1BniB,KAAKoiB,SAAStb,SAAW9G,KAAKmiB,UAAUrb,SACxC9G,KAAKoiB,SAASrb,UAAY/G,KAAKmiB,UAAUpb,2CAU3C+a,EA3FA,CAA4C1J,EAAA,GAgK5CiK,GAAA,SAAAxiB,GAwCC,SAAAyiB,IAAA,IAAAxiB,EAGCD,EAAAE,KAAAC,OAAOA,YACPF,EAAKI,UAAY,iBAGjBJ,EAAK8e,WAAW2D,WAAa,aAC7BziB,EAAK8e,WAAWvV,MAAQ,QAExBvJ,EAAK8e,WAAWvW,SAAW,WAC3BvI,EAAK8e,WAAW4D,cAAgB,gBAGhC1iB,EAAKiC,eA2JP,OAjNoCkE,EAAA,EAAAqc,EAAAziB,GAgEzByiB,EAAAhgB,UAAAuc,eAAV,WACC,OAAO,IAAIgD,IASLS,EAAAhgB,UAAA0c,aAAP,eAAAlf,EAAAE,KAMC,GALIA,KAAKif,KAAKjU,OAAS,GAA4B,GAAvBhL,KAAKkf,gBAChClf,KAAKiiB,UAAUlD,QAIZ/e,KAAKmf,aACJnf,KAAKmf,YAAcnf,KAAK4W,SAAS,CACpC,IAAIwI,EAAepf,KAAKuD,MAAMqT,QAE1ByI,OAAQ,EAeZ,GAboB,qBAAhBD,EAAQvG,KACXwG,EAAWD,EAAQC,SAEK,WAAhBD,EAAQvG,KAChBwG,GAAYD,IAE0G,IAA7G,QAAS,aAAc,UAAW,aAAc,kBAAmB,gBAAgBE,QAAQF,EAAQvG,MAC5GwG,IAAcE,SAAUH,IAGxBI,QAAQ9b,IAAI,4BAGT2b,EACH,mBAASvU,EAAOC,GAEf,IAAI0U,EAAeJ,EAASvU,GACxByU,EAAgBE,EAAQF,SAC5B,GAAIA,EAAU,CACb,IAAI1G,EAAyC0G,EAAS1G,KAClD6G,EAAaD,EAAQE,GACzB,GAAY,SAAR9G,GAA2B,cAARA,EAAsB,CAE5C,IAAK+G,EAAKC,aAAaD,EAAKE,QAASF,EAAKG,QAASL,oBAInD,IAAIM,EAAqBT,EAASS,YAGtB,SAARnH,IACHmH,GAAeA,IAGhB,IAAIC,EAAkCC,EAAA,KAAYN,EAAKX,KAAM,SAACvY,EAAOoE,GACpE,OAAOpE,EAAMiZ,IAAMD,IAGfO,EAKCA,EAAWsC,aACftC,EAAWsC,WAAavC,IALzBC,GAAesC,WAAYvC,EAAaL,GAAID,GAC5CE,EAAKX,KAAK5c,KAAK4d,IAShB3L,EAAA,mBAA0BmL,EAAQU,WAAYF,aAnCxCnV,EAAI,EAAGC,EAAMsU,EAASrU,OAAQF,EAAIC,EAAKD,MAAvCA,GA2CZjL,EAAAyC,UAAM0c,aAAYjf,KAAAC,MAIlBqV,EAAA,KAAWrV,KAAKogB,UAAU9K,WAAY,SAACvN,GACtC,IAAIqa,EAAWra,EAASqa,SACxBtiB,EAAKmiB,UAAU5B,UAAU+B,GACrBvb,EAAA,SAAeub,EAAStb,WAAaD,EAAA,SAAeub,EAAStb,YAChEiB,EAASM,UAAavB,SAAUsb,EAAStb,SAAUC,UAAWqb,EAASrb,eAU1EpE,OAAA0B,eAAWie,EAAAhgB,UAAA,iBAAX,WAEC,IAAKtC,KAAKyiB,WAAY,CACrB,IAAI7G,EAAqB,IAAIrV,EACzB0b,EAAY,IAAIvG,EAAA,EAAuBE,GAC3C5b,KAAKoC,WAAWC,KAAK,IAAIqZ,EAAA,EAAauG,IACtCjiB,KAAKoC,WAAWC,KAAK4f,EAAUrG,UAC/BqG,EAAUrG,SAASxI,WAAY,EAC/B6O,EAAU/gB,OAAOC,GAAG,WAAYnB,KAAKwgB,kBAAmBxgB,MAAM,GAC9DA,KAAKyiB,WAAaR,EAGnB,OAAOjiB,KAAKyiB,4CASNH,EAAAhgB,UAAAogB,oBAAP,SAA2B3a,GAC1BlI,EAAAyC,UAAMogB,oBAAmB3iB,KAAAC,KAAC+H,GAC1BA,EAASqa,SAAS/L,cAQZiM,EAAAhgB,UAAA4D,SAAP,WACCrG,EAAAyC,UAAM4D,SAAQnG,KAAAC,MACdqV,EAAA,KAAWrV,KAAKiiB,UAAU3M,WAAY,SAAC8M,GACtCA,EAASxb,sBASJ0b,EAAAhgB,UAAA+Z,SAAP,SAAgBC,GACftc,KAAKiiB,UAAUrG,SAASS,SAASC,EAAO2F,UAAUrG,UAClD/b,EAAAyC,UAAM+Z,SAAQtc,KAAAC,KAACsc,IAGjBgG,EAjNA,CAAoClK,EAAA,GAyNpC9R,EAAA,EAASV,kBAAkC,eAAIyc,GAC/C/b,EAAA,EAASV,kBAA0C,uBAAIic,GC/XvD,IAAAc,GAAA,SAAA9iB,GAeC,SAAA+iB,IAAA,IAAA9iB,EACCD,EAAAE,KAAAC,OAAOA,YACPF,EAAKI,UAAY,uBACjBJ,EAAKiC,eAEP,OApB0CkE,EAAA,EAAA2c,EAAA/iB,GAoB1C+iB,EApBA,CAA0CjC,GAmE1CkC,GAAA,SAAAhjB,GAmCC,SAAAijB,IAAA,IAAAhjB,EACCD,EAAAE,KAAAC,OAAOA,YACPF,EAAKI,UAAY,eACjBJ,EAAKiC,eAsBP,OA5DkCkE,EAAA,EAAA6c,EAAAjjB,GA+CvBijB,EAAAxgB,UAAAuc,eAAV,WACC,OAAO,IAAI8D,IAQFG,EAAAxgB,UAAA2X,WAAV,WACC,OAAO,IAAI8C,GAGb+F,EA5DA,CAAkCzB,GAoElC/a,EAAA,EAASV,kBAAgC,aAAIid,GAC7Cvc,EAAA,EAASV,kBAAwC,qBAAI+c,oBCrHrDI,GAAA,SAAAljB,GAAA,SAAAmjB,mDA6BA,OA7B8B/c,EAAA,EAAA+c,EAAAnjB,GAQtBmjB,EAAA1gB,UAAA6K,UAAP,SAAiB5K,EAAWC,GAC3B,OACCuE,UAAWxE,EACXuE,SAAU,EAAIrD,KAAKwf,KAAKxf,KAAKyf,IAAI1gB,IAAMiB,KAAK0f,GAAK,IAW5CH,EAAA1gB,UAAA2K,QAAP,SAAeI,EAAgBC,GAC9B,OACC/K,EAAG8K,EACH7K,EAAGiB,KAAKC,IAAID,KAAK2f,KAAK3f,KAAK0f,GAAK,EAAI7V,GAAO,MAI9C0V,EA7BA,CAA8BxZ,GAqC9BlD,EAAA,EAASV,kBAA4B,SAAImd,GCrCzC,IAAAM,GAAA,SAAAxjB,GAAA,SAAAyjB,mDA8BA,OA9B4Brd,EAAA,EAAAqd,EAAAzjB,GASpByjB,EAAAhhB,UAAA6K,UAAP,SAAiB5K,EAAWC,GAC3B,OACCuE,UAAWxE,EACXuE,SAAU,IAAMrD,KAAKwf,KAAKxf,KAAKyf,IAAI,GAAM1gB,IAAM,KAAQiB,KAAK0f,KAWvDG,EAAAhhB,UAAA2K,QAAP,SAAeI,EAAgBC,GAC9B,OACC/K,EAAG8K,EACH7K,EAAG,KAAOiB,KAAKC,IAAID,KAAK2f,IAAI3f,KAAK0f,GAAK,EAAI,GAAM7V,MAInDgW,EA9BA,CAA4B9Z,GAsC5BlD,EAAA,EAASV,kBAA0B,OAAIyd,GCtCvC,IAAAE,GAAA,SAAA1jB,GAAA,SAAA2jB,mDAqCA,OArC6Bvd,EAAA,EAAAud,EAAA3jB,GASrB2jB,EAAAlhB,UAAA6K,UAAP,SAAiB5K,EAAWC,GAC3B,IAAIwM,EAAI,EAAIvL,KAAK0f,GAAK,EACrBlV,EAAIxK,KAAKgN,KAAKzB,EAAI,GACnB,OACCjI,UAAe,EAAJxE,EAAQ0L,GAAK,EAAIxK,KAAKkK,IAAInL,GAAKyL,IAC1CnH,SAAUrD,KAAK8E,MAAM/F,EAAIiB,KAAK+E,IAAIhG,IAAMwM,KAWnCwU,EAAAlhB,UAAA2K,QAAP,SAAeI,EAAgBC,GAE9B,IADA,IAAIW,GAAK,EAAIxK,KAAK0f,GAAK,GAAK1f,KAAK+E,IAAI8E,GAC5BxC,EAAI,EAAG0F,EAAQuF,IAAUjL,EAAI,IAAMrH,KAAKkF,IAAI6H,GAAS,KAAS1F,IACtEwC,GAAOkD,GAASlD,EAAM7J,KAAK+E,IAAI8E,GAAOW,IAAM,EAAIxK,KAAKkK,IAAIL,IAG1D,OADAW,EAAIxK,KAAKgN,KAAK,EAAIhN,KAAK0f,KAEtB5gB,EAAG8K,GAAU,EAAI5J,KAAKkK,IAAIL,IAAQW,EAClCzL,EAAG,EAAI8K,EAAMW,IAIhBuV,EArCA,CAA6Bha,GA6C7BlD,EAAA,EAASV,kBAA2B,QAAI2d,GC3CxC,IAAAE,GAAA,SAAA5jB,GAAA,SAAA6jB,mDAyJA,OAzJkCzd,EAAA,EAAAyd,EAAA7jB,GAS1B6jB,EAAAphB,UAAA2K,QAAP,SAAeI,EAAgBC,GAC9B,OAAS/K,EAAGkB,KAAKkK,IAAIL,GAAO7J,KAAK+E,IAAI6E,GAAS7K,EAAGiB,KAAK+E,IAAI8E,KAIpDoW,EAAAphB,UAAAiI,kBAAP,WACC,IAAIxD,EAAY,GAAK/G,KAAK0J,eACtB5C,GAAY9G,KAAK2J,cAGrB,QAAU5C,UAAWA,EAAY,IAAKD,SAAUA,EAAW,KAAQC,UAAWA,EAD/D,KACqFD,SAAUA,EAAW,KAAQC,UAAWA,EAD7H,KACmJD,SAAUA,EAAW,KAAQC,UAAWA,EAAY,IAAKD,SAAUA,EAAW,MAI1O4c,EAAAphB,UAAAmI,SAAP,WACC,IAAI1D,EAAY,GAAK/G,KAAK0J,eACtB5C,GAAY9G,KAAK2J,cAErB,OAAS3B,MAAOlB,EAAW,GAAImB,MAAOnB,EAAW,GAAIqB,KAAMpB,EAAY,IAAKmB,KAAMnB,IAG5E2c,EAAAphB,UAAAkI,kBAAP,WACC,IAKIgG,EALAzJ,EAAY,GAAK/G,KAAK0J,eACtB5C,GAAY9G,KAAK2J,cAarB,QAAU5C,UAXK,KAWiBA,EAAY,KAN3CyJ,EADGzJ,EAAY,GACN,IAGD,KAGgDD,SAAUA,EAAW,KAAQC,UAAWA,EAXlF,KAWyGyJ,EAAO1J,SAAUA,EAAW,KAAQC,UAAWA,EAXxJ,KAW+KyJ,EAAO1J,SAAUA,EAAW,KAAQC,UAXnN,KAWyOA,EAAY,IAAMyJ,EAAO1J,SAAUA,EAAW,MAKhS4c,EAAAphB,UAAAoI,SAAP,WACC,IAGI8F,EAHAzJ,EAAY,GAAK/G,KAAK0J,eACtB5C,GAAY9G,KAAK2J,cAUrB,OAAS3B,MAAOlB,EAAW,GAAImB,MAAOnB,EAAW,GAAIqB,KAAMpB,EAAY,KALtEyJ,EADGzJ,EAAY,GACN,IAGD,KAE2EmB,KAAMnB,EAAYyJ,IAK7FkT,EAAAphB,UAAA2H,YAAV,SAAsBF,GACrB,GAAKA,EAAL,CAYA,IARA,QAAIsB,KAEAT,EAAiB5K,KAAKuK,oBACtBM,EAAiB7K,KAAKwK,oBAEtBc,EAAQtL,KAAKyK,WACbc,EAAQvL,KAAK0K,WAERI,EAAI,EAAGC,EAAMhB,EAAQiB,OAAQF,EAAIC,EAAKD,IAAK,CAEnD,IAAIU,EAAuBzB,EAAQe,GAAG,GAClCW,EAAoB1B,EAAQe,GAAG,GAE/BY,KAEJ,GAAIF,EAAS,CAEZ,IAAIG,EAAc3L,KAAK4L,YAAYJ,GAEnC,GAAKxL,KAAK6L,SAASF,EAAaL,IAAWtL,KAAK8L,UAAUH,EAAaL,GAK9DtL,KAAK6L,SAASF,EAAaL,IACnCI,EAAarJ,MAAMmJ,EAASC,QANkD,CAC9E,IAAIM,EAA+B/L,KAAKgM,KAAKR,EAASZ,GAClDqB,EAA4BjM,KAAKgM,KAAKP,EAAMb,GAChDc,EAAarJ,MAAM0J,EAAiBE,IAMrC,GAAKjM,KAAK6L,SAASF,EAAaJ,IAAWvL,KAAK8L,UAAUH,EAAaJ,GAM9DvL,KAAK6L,SAASF,EAAaJ,IACnCG,EAAarJ,MAAMmJ,EAASC,QAPkD,CAC9E,IAAIS,EAA+BlM,KAAKgM,KAAKR,EAASX,GAClDsB,EAA4BnM,KAAKgM,KAAKP,EAAMZ,GAEhDa,EAAarJ,MAAM6J,EAAiBC,SAOtC,IAAiB,IAAAC,EAAAnG,EAAA,EAAAyF,GAAYW,EAAAD,EAAApD,QAAAqD,EAAApD,KAAAoD,EAAAD,EAAApD,OAAA,CAAxB,IAAIsD,EAAID,EAAA3F,MACZ2E,EAAYhJ,KAAKiK,sGAInB,IAASxB,EAAI,EAAGC,EAAMM,EAAYL,OAAQF,EAAIC,EAAKD,IAAK,CAKvD,GAHIU,EAAuBH,EAAYP,GAAG,GASzC,IAJA,IAAI6Y,EAAMnY,EAAQR,OAEd4Y,EAAYpY,EAAQmY,EAAM,GAErBE,EAAI,EAAGA,EAAIF,EAAKE,IAAK,CAC7B,IAAIxa,EAAQmC,EAAQqY,GAEpB,GAAIpb,EAAA,MAAYY,EAAMtC,UAAW,IAAM0B,EAAA,MAAYmb,EAAU7c,UAAW,GAAI,CAC3E,IAAI5B,EAAY1B,KAAKkF,IAA4C,GAAvCib,EAAU9c,SAAWuC,EAAMvC,WACjDgd,KAEJ,GAAI3e,EAAY,EAAG,CAClB,IAAK,IAAIuH,EAAI,EAAGA,EAAIvH,EAAWuH,IAC9BoX,EAAYzhB,MAAO0E,UAAW6c,EAAU7c,UAAWD,SAAU8c,EAAU9c,UAAYuC,EAAMvC,SAAW8c,EAAU9c,UAAY3B,EAAYuH,IAGvIlB,EAAQuY,OAAMC,MAAdxY,EAAOvF,EAAA,GAAQ4d,EAAG,GAAMC,IACxBD,GAAQC,EAAY9Y,QAItB4Y,EAAYva,GAKf,OAAOgC,IAITqY,EAzJA,CAAkCla,GAiKlClD,EAAA,EAASV,kBAAgC,aAAI6d,GCpN7CQ,OAAAC,QAAiBC,qCCDjBplB,EAAAC,EAAAC,EAAA,sBAAA+Y,IAAA,IAAA7Y,EAAAJ,EAAA,QAAAK,EAAAL,EAAA,QAAAqlB,EAAArlB,EAAA,QAAAslB,EAAAtlB,EAAA,QAAAQ,EAAAR,EAAA,QAAAulB,EAAAvlB,EAAA,QAAAwlB,EAAAxlB,EAAA,QAAAylB,EAAAzlB,EAAA,QAAA0lB,EAAA1lB,EAAA,QAAA2lB,EAAA3lB,EAAA,QAoEAiZ,EAAA,SAAAnY,GA0CC,SAAAmY,IAAA,IAAAlY,EAGCD,EAAAE,KAAAC,OAAOA,KAzBEF,EAAAG,OAAyC,IAAIV,EAAA,EA0BtDO,EAAKI,UAAY,WAGjBJ,EAAKK,MAAQ,OACbL,EAAKM,OAAS,SACdN,EAAK6kB,cAAgB,GACrB7kB,EAAK8kB,aAAe,GACpB9kB,EAAK+kB,OAAO,EAAG,EAAG,EAAG,GAErB,IAAItkB,EAAkB,IAAIikB,EAAA,EAG1B1kB,EAAKgB,WAAWG,YAAc,GAC9BnB,EAAKgB,WAAWC,KAAOR,EAAgBS,OAAO,cAG9ClB,EAAKoB,OAAOC,GAAG,MAAOrB,EAAKglB,eAAgBhlB,GAAM,GACjDA,EAAKoB,OAAOC,GAAG,iBAAkBrB,EAAKilB,cAAejlB,GAAM,GAG3DA,EAAK+R,gBAAkB/R,EAAKW,YAAYrB,EAAA,GACxCU,EAAK+R,gBAAgBnR,aAAc,EAGnC,IAAIskB,EAAuBllB,EAAKW,YAAY2jB,EAAA,UAC5CY,EAAUtkB,aAAc,EACxBskB,EAAUxd,OAASjH,EAAgBS,OAAO,yBAC1CgkB,EAAUC,YAAc,EACxBD,EAAUvd,cAAgB,GAC1Bud,EAAUjkB,KAAO4B,OAAA4hB,EAAA,EAAA5hB,GACjBqiB,EAAU5I,eAAiB,SAC3B4I,EAAU7I,iBAAmB,SAC7B6I,EAAUjf,YAAa,EACvBjG,EAAKklB,UAAYA,EAEjBllB,EAAKsC,WAAWC,KAAKvC,EAAKG,QAG1BH,EAAKiC,eA8JP,OAlP8B5C,EAAA,EAAA6Y,EAAAnY,GA+F7B8C,OAAA0B,eAAW2T,EAAA1V,UAAA,cAAX,WAMC,OALKtC,KAAKklB,UACTllB,KAAKklB,QAAU,IAAIb,EAAA,EACnBrkB,KAAKklB,QAAQhkB,OAAOC,GAAG,WAAYnB,KAAKmlB,kBAAmBnlB,MAAM,GACjEA,KAAKklB,QAAQhkB,OAAOC,GAAG,UAAWnB,KAAKolB,oBAAqBplB,MAAM,IAE5DA,KAAKklB,yCASHlN,EAAA1V,UAAA6iB,kBAAV,SAA4BnjB,GAC3B,IAAImE,EAAoBnE,EAAM8Z,SAC9B,GAAI9b,KAAKuD,MAAM4C,OAAOkf,SAASlf,GAAS,CACvC,IAAImf,EAAYnf,EAAOoW,QACvBvc,KAAKklB,QAAQjH,YAAY9X,GACzBnG,KAAKklB,QAAQ7iB,KAAKijB,GAClBnf,EAASmf,EAETtlB,KAAKuD,MAAMgiB,UAAUljB,KAAKijB,GAE3Bnf,EAAO5C,MAAQvD,KAAKuD,MACpB4C,EAAOmM,OAAStS,KAAK6R,gBACrB1L,EAAOqf,qBAAsB,GASpBxN,EAAA1V,UAAA8iB,oBAAV,SAA8BpjB,GAE7BhC,KAAKqW,cASC2B,EAAA1V,UAAAwiB,eAAP,SAAsB9iB,GACrB,IAAIyjB,EAAoBhB,EAAA,oBAA2BziB,EAAMsB,YAAatD,KAAMA,KAAK6R,iBAC7ExJ,EAAsBrI,KAAKuD,MAAMiT,iBAAiBiP,GACtDzlB,KAAKuD,MAAMY,eAAekE,EAAUrI,KAAKuD,MAAMU,WAAW,IAQ3DtB,OAAA0B,eAAW2T,EAAA1V,UAAA,aAaX,WACC,OAAOtC,KAAKC,OAAOqE,WAdpB,SAAiBf,GACZvD,KAAKuD,OAASA,GACjBvD,KAAKC,OAAOsE,IAAIhB,EAAO,IAAIhE,EAAA,GAE1BgE,EAAMrC,OAAOC,GAAG,qBAAsBnB,KAAK0lB,gBAAiB1lB,MAAM,GAClEuD,EAAMrC,OAAOC,GAAG,oBAAqBnB,KAAK+kB,cAAe/kB,MAAM,uCAiB3DgY,EAAA1V,UAAAojB,gBAAP,WACC,IAAIniB,EAAkBvD,KAAKuD,MACvBU,EAAoBV,EAAMU,UAC1B+gB,EAAuBhlB,KAAKglB,UAEhCA,EAAUviB,MAAQzC,KAAKsF,WAAarB,EACpC+gB,EAAUtiB,OAAS1C,KAAKgE,YAAcC,EAEtC,IAAI6F,EAAgBrG,KAAKyB,IAAIlF,KAAK4kB,aAAc5kB,KAAK2kB,eAAiB,IAElE9S,EAA6BtO,EAAMsO,gBAEvCmT,EAAUziB,EAAIkB,KAAKkiB,MAAM1hB,EAAY4N,EAAgBvM,WAAa,EAAIuM,EAAgBnM,QAAUoE,EAAQ7F,GACxG+gB,EAAUxiB,EAAIiB,KAAKkiB,MAAM1hB,EAAY4N,EAAgB7N,YAAc,EAAI6N,EAAgBpM,QAAUqE,EAAQ7F,GAEzG+gB,EAAU9e,YASJ8R,EAAA1V,UAAAyiB,cAAP,WACK/kB,KAAKuD,QACRvD,KAAK6R,gBAAgB/H,MAAQ9J,KAAKuD,MAAM4N,WAAa1N,KAAKyB,IAAIlF,KAAK4kB,aAAc5kB,KAAK2kB,eAAiB,IACvG3kB,KAAK0lB,kBACL1lB,KAAK4lB,cAOG5N,EAAA1V,UAAAsjB,UAAV,WACC/lB,EAAAyC,UAAMsjB,UAAS7lB,KAAAC,MACfA,KAAK6R,gBAAgB7K,QAASzE,EAAGvC,KAAKsF,WAAa,EAAG9C,EAAGxC,KAAKgE,YAAc,IAC5EhE,KAAKglB,UAAUa,eAAkBtjB,GAAI,EAAGC,GAAI,EAAGC,MAAOgB,KAAKkiB,KAAK3lB,KAAKsF,WAAa,GAAI5C,OAAQe,KAAKkiB,KAAK3lB,KAAKgE,YAAc,KASrHgU,EAAA1V,UAAAoW,cAAP,SAAqBC,GAEpB,GAAIA,GAGC+L,EAAA,SAAe/L,EAAOxS,SAAWue,EAAA,QAAc/L,EAAOxS,QACzD,IAAK,IAAI2E,EAAI,EAAGC,EAAM4N,EAAOxS,OAAO6E,OAAQF,EAAIC,EAAKD,IAAK,CACzD,IAAI3E,EAASwS,EAAOxS,OAAO2E,GACvB4Z,EAAA,SAAeve,IAAWue,EAAA,SAAeve,IAAWnG,KAAKya,IAAIC,OAAOvU,KACvEwS,EAAOxS,OAAO2E,GAAK9K,KAAKya,IAAIE,OAAOxU,IAOvCtG,EAAAyC,UAAMoW,cAAa3Y,KAAAC,KAAC2Y,IAItBX,EAlPA,CAA8B5Y,EAAA,GA0P9BklB,EAAA,EAAS1e,kBAA4B,SAAIoS","file":"maps.js","sourcesContent":["/**\r\n * Zoom control module\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Container, IContainerProperties, IContainerAdapters, IContainerEvents } from \"../../core/Container\";\r\nimport { Sprite, ISpriteEvents, SpriteEventDispatcher, AMEvent } from \"../../core/Sprite\";\r\nimport { Button } from \"../../core/elements/Button\";\r\nimport { MapChart } from \"../types/MapChart\";\r\nimport { RoundedRectangle } from \"../../core/elements/RoundedRectangle\";\r\nimport { MutableValueDisposer, MultiDisposer } from \"../../core/utils/Disposer\";\r\nimport { keyboard } from \"../../core/utils/Keyboard\";\r\nimport { getInteraction } from \"../../core/interaction/Interaction\";\r\nimport { percent } from \"../../core/utils/Percent\";\r\nimport { registry } from \"../../core/Registry\";\r\nimport { InterfaceColorSet } from \"../../core/utils/InterfaceColorSet\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines properties for [[ZoomControl]].\r\n */\r\nexport interface IZoomControlProperties extends IContainerProperties { }\r\n\r\n/**\r\n * Defines events for [[ZoomControl]].\r\n */\r\nexport interface IZoomControlEvents extends IContainerEvents { }\r\n\r\n/**\r\n * Defines adapters for [[ZoomControl]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface IZoomControlAdapters extends IContainerAdapters, IZoomControlProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Creates a control for zooming the map.\r\n *\r\n * @see {@link IZoomControlEvents} for a list of available events\r\n * @see {@link IZoomControlAdapters} for a list of available Adapters\r\n * @important\r\n */\r\nexport class ZoomControl extends Container {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IZoomControlProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IZoomControlAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IZoomControlEvents;\r\n\r\n\t/**\r\n\t * Zoom in button element.\r\n\t */\r\n\tpublic plusButton: Button;\r\n\r\n\t/**\r\n\t * Zoom out button element.\r\n\t */\r\n\tpublic minusButton: Button;\r\n\r\n\t/**\r\n\t * A zoom slider background element.\r\n\t */\r\n\tpublic slider: Container;\r\n\r\n\t/**\r\n\t * A zoom slider thumb element.\r\n\t */\r\n\tpublic thumb: Button;\r\n\r\n\t/**\r\n\t * A target map.\r\n\t */\r\n\tprotected _chart: MutableValueDisposer<MapChart> = new MutableValueDisposer<MapChart>();\r\n\r\n\t/**\r\n\t * A type to use for the background element for zoom control.\r\n\t */\r\n\tpublic _background: RoundedRectangle;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.className = \"ZoomControl\";\r\n\r\n\t\tthis.align = \"right\";\r\n\t\tthis.valign = \"bottom\";\r\n\r\n\t\tthis.layout = \"vertical\";\r\n\t\tthis.padding(5, 5, 5, 5);\r\n\r\n\t\tlet interfaceColors = new InterfaceColorSet();\r\n\r\n\t\tlet plusButton: Button = this.createChild(Button);\r\n\t\tplusButton.shouldClone = false;\r\n\t\tplusButton.label.text = \"+\";\r\n\t\t//plusButton.fontFamily = \"Verdana\";\r\n\t\tthis.plusButton = plusButton;\r\n\r\n\t\tlet slider: Container = this.createChild(Container);\r\n\t\tslider.shouldClone = false;\r\n\t\tslider.background.fill = interfaceColors.getFor(\"alternativeBackground\");\r\n\t\tslider.background.fillOpacity = 0.05;\r\n\t\tslider.background.events.on(\"hit\", this.handleBackgroundClick, this, false);\r\n\t\tslider.events.on(\"sizechanged\", this.updateThumbSize, this, false);\r\n\t\tthis.slider = slider;\r\n\r\n\t\tlet thumb: Button = slider.createChild(Button);\r\n\t\tthumb.shouldClone = false;\r\n\t\tthumb.padding(0, 0, 0, 0);\r\n\t\tthumb.draggable = true;\r\n\t\tthumb.events.on(\"drag\", this.handleThumbDrag, this, false);\r\n\t\tthis.thumb = thumb;\r\n\r\n\t\tlet minusButton: Button = this.createChild(Button);\r\n\t\tminusButton.shouldClone = false;\r\n\t\tminusButton.label.text = \"-\";\r\n\t\t//minusButton.fontFamily = \"Verdana\";\r\n\t\tthis.minusButton = minusButton;\r\n\r\n\t\t// Set roles\r\n\t\tthis.thumb.role = \"slider\";\r\n\t\tthis.thumb.readerLive = \"polite\";\r\n\r\n\t\t// Set reader text\r\n\t\tthis.thumb.readerTitle = this.language.translate(\"Use arrow keys to zoom in and out\");\r\n\t\tthis.minusButton.readerTitle = this.language.translate(\"Press ENTER to zoom in\");\r\n\t\tthis.plusButton.readerTitle = this.language.translate(\"Press ENTER to zoom out\");\r\n\r\n\t\tthis.applyTheme();\r\n\r\n\t\tthis.events.on(\"propertychanged\", (event) => {\r\n\t\t\tif (event.property == \"layout\") {\r\n\t\t\t\tthis.fixLayout();\r\n\t\t\t}\r\n\t\t}, undefined, false);\r\n\r\n\t\tthis._disposers.push(this._chart);\r\n\r\n\t\tthis.fixLayout();\r\n\t}\r\n\r\n\tprotected fixLayout() {\r\n\r\n\t\tlet plusButton = this.plusButton;\r\n\t\tlet minusButton = this.minusButton;\r\n\r\n\t\tlet thumb = this.thumb;\r\n\t\tlet slider = this.slider;\r\n\r\n\t\tplusButton.x = undefined;\r\n\t\tplusButton.y = undefined;\r\n\r\n\t\tminusButton.x = undefined;\r\n\t\tminusButton.y = undefined;\r\n\t\t\r\n\t\tthumb.x = undefined;\r\n\t\tthumb.y = undefined;\r\n\r\n\t\tslider.x = undefined;\r\n\t\tslider.y = undefined;\r\n\r\n\t\tplusButton.padding(6, 10, 6, 10);\r\n\t\tminusButton.padding(6, 10, 6, 10);\r\n\r\n\t\tminusButton.label.align = \"center\";\r\n\t\tminusButton.label.valign = \"middle\";\t\t\r\n\r\n\t\tplusButton.label.align = \"center\";\r\n\t\tplusButton.label.valign = \"middle\";\t\t\r\n\r\n\t\tif (this.layout == \"vertical\") {\r\n\t\t\tthis.width = 40;\r\n\t\t\tthis.height = undefined;\r\n\r\n\t\t\tminusButton.width = percent(100);\r\n\t\t\tminusButton.height = undefined;\r\n\r\n\t\t\tthumb.width = percent(100);\r\n\t\t\tthumb.height = undefined;\r\n\r\n\t\t\tplusButton.width = percent(100);\r\n\t\t\tplusButton.height = undefined;\r\n\r\n\t\t\tslider.width = percent(100);\r\n\t\t\tminusButton.marginTop = 1;\r\n\t\t\tplusButton.marginBottom = 2;\r\n\r\n\t\t\tslider.height = 0;\r\n\r\n\t\t\tminusButton.toFront();\r\n\t\t\tplusButton.toBack();\r\n\r\n\t\t\tthumb.minX = 0;\r\n\t\t\tthumb.maxX = 0;\r\n\t\t\tthumb.minY = 0;\r\n\r\n\r\n\t\t}\r\n\t\telse if (this.layout == \"horizontal\") {\r\n\t\t\tthis.height = 40;\r\n\t\t\tthis.width = undefined;\r\n\r\n\t\t\tminusButton.height = percent(100);\r\n\t\t\tminusButton.width = undefined;\r\n\r\n\t\t\tplusButton.height = percent(100);\r\n\t\t\tplusButton.width = undefined;\r\n\r\n\t\t\tthumb.height = percent(100);\r\n\t\t\tthumb.width = undefined;\r\n\r\n\t\t\tthumb.minX = 0;\r\n\t\t\tthumb.minY = 0;\r\n\t\t\tthumb.maxY = 0;\r\n\r\n\t\t\tslider.height = percent(100);\r\n\t\t\tslider.width = 0;\r\n\r\n\t\t\tminusButton.toBack();\r\n\t\t\tplusButton.toFront();\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Handles zoom operation after clicking on the slider background.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param event  Event\r\n\t */\r\n\tpublic handleBackgroundClick(event: AMEvent<Sprite, ISpriteEvents>[\"hit\"]): void {\r\n\t\tlet sprite: Sprite = event.target;\r\n\t\tlet y: number = event.spritePoint.y;\r\n\t\tlet chart: MapChart = this.chart;\r\n\r\n\t\tlet maxPower: number = Math.log(chart.maxZoomLevel) / Math.LN2;\r\n\t\tlet minPower: number = Math.log(chart.minZoomLevel) / Math.LN2;\r\n\r\n\t\tlet power: number = (sprite.pixelHeight - y) / sprite.pixelHeight * (minPower + (maxPower - minPower));\r\n\t\tlet zoomLevel: number = Math.pow(2, power);\r\n\t\tchart.zoomToGeoPoint(chart.zoomGeoPoint, zoomLevel);\r\n\t}\r\n\r\n\t/**\r\n\t * A main chart/map that this zoom control is for.\r\n\t *\r\n\t * @param chart  Map/chart\r\n\t */\r\n\tpublic set chart(chart: MapChart) {\r\n\t\tthis._chart.set(chart, new MultiDisposer([\r\n\t\t\tchart.events.on(\"maxsizechanged\", this.updateThumbSize, this, false),\r\n\t\t\tchart.events.on(\"zoomlevelchanged\", this.updateThumb, this, false),\r\n\r\n\t\t\tthis.minusButton.events.on(\"hit\", () => { chart.zoomOut(chart.zoomGeoPoint) }, chart, false),\r\n\r\n\t\t\tgetInteraction().body.events.on(\"keyup\", (ev) => {\r\n\t\t\t\tif (this.topParent.hasFocused) {\r\n\t\t\t\t\tif (keyboard.isKey(ev.event, \"enter\")) {\r\n\t\t\t\t\t\tif (this.minusButton.isFocused) {\r\n\t\t\t\t\t\t\tchart.zoomOut()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (this.plusButton.isFocused) {\r\n\t\t\t\t\t\t\tchart.zoomIn()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (keyboard.isKey(ev.event, \"plus\")) {\r\n\t\t\t\t\t\tchart.zoomIn();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (keyboard.isKey(ev.event, \"minus\")) {\r\n\t\t\t\t\t\tchart.zoomOut();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, chart),\r\n\t\t\tthis.plusButton.events.on(\"hit\", () => { chart.zoomIn(chart.zoomGeoPoint) }, chart, false)\r\n\t\t]));\r\n\t}\r\n\r\n\t/**\r\n\t * @return Map/chart\r\n\t */\r\n\tpublic get chart(): MapChart {\r\n\t\treturn this._chart.get();\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the slider's thumb size based on the available zoom space.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic updateThumbSize(): void {\r\n\t\tlet chart = this.chart;\r\n\t\tif (chart) {\r\n\t\t\tlet slider: Container = this.slider;\r\n\t\t\tlet thumb: Button = this.thumb;\r\n\t\t\tif (this.layout == \"vertical\") {\r\n\t\t\t\tthumb.minHeight = Math.min(this.slider.pixelHeight, 20);\r\n\r\n\t\t\t\tthumb.height = slider.pixelHeight / this.stepCount;\r\n\t\t\t\tthumb.maxY = slider.pixelHeight - thumb.pixelHeight;\r\n\r\n\t\t\t\tif (thumb.pixelHeight <= 1) {\r\n\t\t\t\t\tthumb.visible = false;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthumb.visible = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthumb.minWidth = Math.min(this.slider.pixelWidth, 20);\r\n\t\t\t\tthumb.width = slider.pixelWidth / this.stepCount;\r\n\t\t\t\tthumb.maxX = slider.pixelWidth - thumb.pixelWidth;\r\n\r\n\t\t\t\tif (thumb.pixelWidth <= 1) {\r\n\t\t\t\t\tthumb.visible = false;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthumb.visible = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Updates thumb according to current zoom position from map.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic updateThumb(): void {\r\n\t\tlet slider: Container = this.slider;\r\n\t\tlet chart: MapChart = this.chart;\r\n\t\tlet thumb: Button = this.thumb;\r\n\r\n\t\tif (!thumb.isDown) {\r\n\t\t\tlet step: number = (Math.log(chart.zoomLevel) - Math.log(this.chart.minZoomLevel)) / Math.LN2;\r\n\r\n\t\t\tif (this.layout == \"vertical\") {\r\n\t\t\t\tthumb.y = slider.pixelHeight - (slider.pixelHeight - thumb.pixelHeight) * step / this.stepCount - thumb.pixelHeight;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthumb.x = slider.pixelWidth * step / this.stepCount;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Zooms the actual map when slider position changes.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic handleThumbDrag(): void {\r\n\t\tlet slider: Container = this.slider;\r\n\t\tlet chart: MapChart = this.chart;\r\n\t\tlet thumb: Button = this.thumb;\r\n\t\tlet step: number;\r\n\r\n\t\tlet minStep = Math.log(this.chart.minZoomLevel) / Math.LN2;\r\n\r\n\t\tif (this.layout == \"vertical\") {\r\n\t\t\tstep = this.stepCount * (slider.pixelHeight - thumb.pixelY - thumb.pixelHeight) / (slider.pixelHeight - thumb.pixelHeight);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tstep = this.stepCount * thumb.pixelX / slider.pixelWidth;\r\n\t\t}\r\n\t\tstep = minStep + step;\r\n\r\n\t\tlet zoomLevel: number = Math.pow(2, step);\r\n\t\tchart.zoomToGeoPoint(undefined, zoomLevel, false, 0);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the step countfor the slider grid according to map's min and max\r\n\t * zoom level settings.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Step count\r\n\t */\r\n\tpublic get stepCount(): number {\r\n\t\treturn Math.log(this.chart.maxZoomLevel) / Math.LN2 - Math.log(this.chart.minZoomLevel) / Math.LN2;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a background element for slider control.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Background\r\n\t */\r\n\tpublic createBackground(): this[\"_background\"] {\r\n\t\treturn new RoundedRectangle();\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"ZoomControl\"] = ZoomControl;\r\n\n\n\n// WEBPACK FOOTER //\n// ../../../../../src/.internal/charts/map/ZoomControl.ts","/**\r\n * Map object module\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Container, IContainerProperties, IContainerAdapters, IContainerEvents } from \"../../core/Container\";\r\nimport { SpriteEventDispatcher, AMEvent } from \"../../core/Sprite\";\r\nimport { MapSeries, MapSeriesDataItem } from \"./MapSeries\";\r\nimport { registry } from \"../../core/Registry\";\r\nimport { IGeoPoint } from \"../../core/defs/IGeoPoint\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines propeties for [[MapObject]].\r\n */\r\nexport interface IMapObjectProperties extends IContainerProperties {\r\n\r\n\t/**\r\n\t * A custom zoom level to use when `zoomToMapObject()` is called on this\r\n\t * map object.\r\n\t */\r\n\tzoomLevel?: number;\r\n\r\n\t/**\r\n\t * A custom point to use when `zoomToMapObject()` is called on this map\r\n\t * object.\r\n\t */\r\n\tzoomGeoPoint?: IGeoPoint;\r\n\r\n}\r\n\r\n/**\r\n * Defines events for [[MapObject]].\r\n */\r\nexport interface IMapObjectEvents extends IContainerEvents { }\r\n\r\n/**\r\n * Defines adapters for [[MapObject]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface IMapObjectAdapters extends IContainerAdapters, IMapObjectProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * A base class for all map objects: lines, images, etc.\r\n *\r\n * @see {@link IMapObjectEvents} for a list of available events\r\n * @see {@link IMapObjectAdapters} for a list of available Adapters\r\n */\r\nexport class MapObject extends Container {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IMapObjectProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IMapObjectAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IMapObjectEvents;\r\n\r\n\t/**\r\n\t * A map series this object belongs to.\r\n\t */\r\n\tpublic series: MapSeries;\r\n\r\n\tpublic _dataItem: MapSeriesDataItem;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\r\n\t\t// Init\r\n\t\tsuper();\r\n\t\tthis.className = \"MapObject\";\r\n\r\n\t\t// Set defaults\r\n\t\tthis.isMeasured = false;\r\n\t\tthis.layout = \"none\";\r\n\t\tthis.clickable = true;\r\n\r\n\t\t// Apply theme\r\n\t\tthis.applyTheme();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * (Re)validates this object, forcing it to redraw.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validate(): void {\r\n\t\tif (this.series) {\r\n\t\t\tthis.readerTitle = this.series.itemReaderText;\r\n\t\t}\r\n\t\tsuper.validate();\r\n\t}\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"MapObject\"] = MapObject;\r\n\n\n\n// WEBPACK FOOTER //\n// ../../../../../src/.internal/charts/map/MapObject.ts","/**\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { MapObject, IMapObjectProperties, IMapObjectAdapters, IMapObjectEvents } from \"./MapObject\";\r\nimport { SpriteEventDispatcher, AMEvent } from \"../../core/Sprite\";\r\nimport { MapImageSeriesDataItem, MapImageSeries } from \"./MapImageSeries\";\r\nimport { registry } from \"../../core/Registry\";\r\nimport * as $type from \"../../core/utils/Type\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines properties for [[MapImage]].\r\n */\r\nexport interface IMapImageProperties extends IMapObjectProperties {\r\n\r\n\t/**\r\n\t * Latitude of the image location.\r\n\t */\r\n\tlatitude?: number;\r\n\r\n\t/**\r\n\t * Longitude of the mage location.\r\n\t */\r\n\tlongitude?: number;\r\n\r\n}\r\n\r\n/**\r\n * Defines events for [[MapImage]].\r\n */\r\nexport interface IMapImageEvents extends IMapObjectEvents { }\r\n\r\n/**\r\n * Defines adapters for [[MapImage]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface IMapImageAdapters extends IMapObjectAdapters, IMapImageProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Used to place an image on the map.\r\n *\r\n * @see {@link IMapImageEvents} for a list of available events\r\n * @see {@link IMapImageAdapters} for a list of available Adapters\r\n */\r\nexport class MapImage extends MapObject {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IMapImageProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IMapImageAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IMapImageEvents;\r\n\r\n\t/**\r\n\t * A related data item.\r\n\t */\r\n\tpublic _dataItem: MapImageSeriesDataItem;\r\n\r\n\t/**\r\n\t * A map series this object belongs to.\r\n\t */\r\n\tpublic series: MapImageSeries;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.className = \"MapImage\";\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * Latitude image is placed at.\r\n\t *\r\n\t * @param value  Latitude\r\n\t */\r\n\tpublic set latitude(value: number) {\r\n\t\tthis.setPropertyValue(\"latitude\", value, false, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Latitude\r\n\t */\r\n\tpublic get latitude(): number {\r\n\t\treturn this.getPropertyValue(\"latitude\");\r\n\t}\r\n\r\n\t/**\r\n\t * Longitude image is placed on.\r\n\t *\r\n\t * @param value  Longitude\r\n\t */\r\n\tpublic set longitude(value: number) {\r\n\t\tthis.setPropertyValue(\"longitude\", value, false, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Longitude\r\n\t */\r\n\tpublic get longitude(): number {\r\n\t\treturn this.getPropertyValue(\"longitude\");\r\n\t}\r\n\r\n\t/**\r\n\t * Repositions the image to it's current position.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validatePosition(): void {\r\n\t\tif ($type.isNumber(this.latitude) && $type.isNumber(this.longitude)) {\r\n\t\t\tthis.moveTo(this.series.chart.projection.convert({ latitude: this.latitude, longitude: this.longitude }));\r\n\t\t}\r\n\t\tsuper.validatePosition();\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"MapImage\"] = MapImage;\r\n\n\n\n// WEBPACK FOOTER //\n// ../../../../../src/.internal/charts/map/MapImage.ts","/**\r\n * Map polygon module\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { MapObject, IMapObjectProperties, IMapObjectAdapters, IMapObjectEvents } from \"./MapObject\";\r\nimport { SpriteEventDispatcher, AMEvent } from \"../../core/Sprite\";\r\nimport { MapPolygonSeriesDataItem, MapPolygonSeries } from \"./MapPolygonSeries\";\r\nimport { IGeoPoint } from \"../../core/defs/IGeoPoint\";\r\nimport { Polygon } from \"../../core/elements/Polygon\";\r\nimport { registry } from \"../../core/Registry\";\r\nimport { InterfaceColorSet } from \"../../core/utils/InterfaceColorSet\";\r\n\r\n\r\n/**\r\n * ============================f================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines properties for [[MapPolygon]].\r\n */\r\nexport interface IMapPolygonProperties extends IMapObjectProperties {\r\n\r\n\t/**\r\n\t * Set of coordinates for the polygon.\r\n\t */\r\n\tmultiGeoPolygon?: IGeoPoint[][][];\r\n\r\n}\r\n\r\n/**\r\n * Defines events for [[MapPolygon]].\r\n */\r\nexport interface IMapPolygonEvents extends IMapObjectEvents { }\r\n\r\n/**\r\n * Defines adapters for [[MapPolygon]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface IMapPolygonAdapters extends IMapObjectAdapters, IMapPolygonProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Used to draw a polygon on the map.\r\n *\r\n * @see {@link IMapPolygonEvents} for a list of available events\r\n * @see {@link IMapPolygonAdapters} for a list of available Adapters\r\n */\r\nexport class MapPolygon extends MapObject {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IMapPolygonProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IMapPolygonAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IMapPolygonEvents;\r\n\r\n\t/**\r\n\t * A visual polygon element.\r\n\t */\r\n\tpublic polygon: Polygon;\r\n\r\n\t/**\r\n\t * A related data item.\r\n\t */\r\n\tpublic _dataItem: MapPolygonSeriesDataItem;\r\n\r\n\r\n\t/**\r\n\t * A map series this object belongs to.\r\n\t */\r\n\tpublic series: MapPolygonSeries;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.className = \"MapPolygon\";\r\n\r\n\t\tthis.polygon = this.createChild(Polygon);\r\n\t\tthis.polygon.shouldClone = false;\r\n\r\n\t\tlet interfaceColors = new InterfaceColorSet();\r\n\r\n\t\tthis.fill = interfaceColors.getFor(\"secondaryButton\");\r\n\t\tthis.stroke = interfaceColors.getFor(\"secondaryButtonStroke\");\r\n\t\tthis.strokeOpacity = 1;\r\n\r\n\t\tthis.tooltipPosition = \"pointer\";\r\n\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * Set of coordinates for the polygon.\r\n\t *\r\n\t * @param multiGeoPolygon  Polygon coordinates\r\n\t */\r\n\tpublic set multiGeoPolygon(multiGeoPolygon: IGeoPoint[][][]) {\r\n\t\tthis.setPropertyValue(\"multiGeoPolygon\", multiGeoPolygon, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Polygon coordinates\r\n\t */\r\n\tpublic get multiGeoPolygon(): IGeoPoint[][][] {\r\n\t\treturn this.getPropertyValue(\"multiGeoPolygon\");\r\n\t}\r\n\r\n\t/**\r\n\t * (Re)validates the polygon, effectively redrawing it.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validate(): void {\r\n\t\tif (this.series) {\r\n\t\t\tthis.polygon.points = this.series.chart.projection.projectGeoArea(this.multiGeoPolygon);\r\n\t\t}\r\n\r\n\t\tsuper.validate();\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic measureElement(): void {\r\n\t\t// Overriding, just to avoid extra measure\r\n\t}\r\n\r\n\t/**\r\n\t * Calculated polygon center latitude.\r\n\t *\r\n\t * @readonly\r\n\t * @return Center latitude\r\n\t */\r\n\tpublic get latitude(): number {\r\n\t\tlet dataItem = this.dataItem;\r\n\t\treturn dataItem.north + (dataItem.south - dataItem.north) / 2;\r\n\t}\r\n\r\n\t/**\r\n\t * Calculated polygon center longitude.\r\n\t *\r\n\t * @readonly\r\n\t * @return Center longitude\r\n\t */\r\n\tpublic get longitude(): number {\r\n\t\tlet dataItem = this.dataItem;\r\n\t\treturn dataItem.east + (dataItem.west - dataItem.east) / 2;\r\n\t}\r\n\r\n\t/**\r\n\t * Not 100% sure about this, as if we add something to MapPolygon this\r\n\t * won't be true, but otherwise we will get all 0 and the tooltip won't\r\n\t * be positioned properly\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Element's width in pixels.\r\n\t *\r\n\t * @readonly\r\n\t * @return Width (px)\r\n\t */\r\n\tpublic get pixelWidth(): number {\r\n\t\treturn this.polygon.pixelWidth;\r\n\t}\r\n\r\n\t/**\r\n\t * Element's height in pixels.\r\n\t *\r\n\t * @readonly\r\n\t * @return Width (px)\r\n\t */\r\n\tpublic get pixelHeight(): number {\r\n\t\treturn this.polygon.pixelHeight;\r\n\t}\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"MapPolygon\"] = MapPolygon;\r\n\n\n\n// WEBPACK FOOTER //\n// ../../../../../src/.internal/charts/map/MapPolygon.ts","/**\r\n * A collection of GeoJSON format-related utility functions.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { IGeoPoint } from \"../../core/defs/IGeoPoint\";\r\nimport { IPoint } from \"../../core/defs/IPoint\";\r\nimport * as $math from \"../../core/utils/Math\";\r\n\r\n\r\n/**\r\n * Normalizes a geo-point.\r\n *\r\n * @ignore Exclude from docs\r\n * @param geoPoint  Source geo-point\r\n * @return Normalized geo-point\r\n */\r\nexport function normalizePoint(geoPoint: IGeoPoint): IGeoPoint {\r\n\tlet longitude = wrapAngleTo180(geoPoint.longitude);\r\n\tlet latitude = Math.asin(Math.sin((geoPoint.latitude * $math.RADIANS))) * $math.DEGREES;\r\n\r\n\tlet latitude180 = wrapAngleTo180(geoPoint.latitude);\r\n\r\n\tif (Math.abs(latitude180) > 90) {\r\n\t\tlongitude = wrapAngleTo180(longitude + 180);\r\n\t}\r\n\r\n\tgeoPoint.longitude = longitude;\r\n\tgeoPoint.latitude = latitude;\r\n\r\n\treturn geoPoint;\r\n}\r\n\r\n/**\r\n * Normalizes all points of a geo-line.\r\n *\r\n * @ignore Exclude from docs\r\n * @param multiline  Source geo-line\r\n * @return Normalized geo-line\r\n */\r\nexport function normalizeMultiline(multiline: IGeoPoint[][]): IGeoPoint[][] {\r\n\tfor (let segment of multiline) {\r\n\t\tfor (let point of segment) {\r\n\t\t\tpoint = normalizePoint(point);\r\n\t\t}\r\n\t}\r\n\treturn multiline;\r\n}\r\n\r\n/**\r\n * [wrapAngleTo180 description]\r\n *\r\n * @todo Description\r\n * @ignore Exclude from docs\r\n * @param angle  Angle\r\n * @return Angle\r\n */\r\nexport function wrapAngleTo180(angle: number): number {\r\n\tangle = angle % 360;\r\n\r\n\tif (angle > 180) {\r\n\t\tangle -= 360;\r\n\t}\r\n\tif (angle < -180) {\r\n\t\tangle += 360;\r\n\t}\r\n\r\n\treturn angle;\r\n}\r\n\r\n/**\r\n * Converts a geo point to a regular point object.\r\n *\r\n * @ignore Exclude from docs\r\n * @param geoPoint  Source geo point\r\n * @return Point\r\n */\r\nexport function geoToPoint(geoPoint: IGeoPoint): IPoint {\r\n\treturn { x: geoPoint.longitude, y: geoPoint.latitude };\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ../../../../../src/.internal/charts/map/Geo.ts","/**\r\n * This module contains funcitonality related to geographical projections\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { IGeoPoint } from \"../../../core/defs/IGeoPoint\";\r\nimport { IGeoRectangle } from \"../../../core/defs/IGeoRectangle\";\r\nimport { IPoint } from \"../../../core/defs/IPoint\";\r\nimport { registry } from \"../../../core/Registry\";\r\nimport * as $math from \"../../../core/utils/Math\";\r\nimport * as $geo from \"../Geo\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * This is a base class for a geographical projection.\r\n */\r\nexport class Projection {\r\n\r\n\tpublic deltaLongitude: number = 0;\r\n\r\n\tpublic deltaLatitude: number = 0;\r\n\r\n\tpublic deltaGama: number = 0;\r\n\r\n\tpublic centerPoint: IPoint = { x: 0, y: 0 };\r\n\r\n\tpublic scale: number = 1;\r\n\r\n\tpublic projectGeoArea(geoArea: IGeoPoint[][][]): IPoint[][][] {\r\n\r\n\t\tlet clippedGeoArea: IGeoPoint[][][] = this.clipGeoArea(geoArea);\r\n\t\tlet convertedPoints: IPoint[][][] = this.convertGeoArea(clippedGeoArea);\r\n\r\n\t\treturn convertedPoints;\r\n\t}\r\n\r\n\tpublic projectGeoLine(geoLine: IGeoPoint[][]): IPoint[][] {\r\n\t\treturn this.convertGeoLine(this.clipGeoLine(geoLine));\r\n\t}\r\n\r\n\tpublic getClipRectangle1(): IGeoPoint[] {\r\n\t\tlet longitude = $geo.wrapAngleTo180(180 - this.deltaLongitude);\r\n\t\tlet latitude = $geo.wrapAngleTo180(this.deltaLatitude);\r\n\r\n\t\tlet smallNum = 0.00001;\r\n\t\treturn [{ longitude: -180, latitude: latitude - 90 }, { longitude: longitude - smallNum, latitude: latitude - 90 }, { longitude: longitude - smallNum, latitude: latitude + 90 }, { longitude: -180, latitude: latitude + 90 }];\r\n\t}\r\n\r\n\tpublic getClipRectangle2(): IGeoPoint[] {\r\n\t\tlet longitude = $geo.wrapAngleTo180(180 - this.deltaLongitude);\r\n\t\t//let latitude = $geo.wrapAngleTo180(this.deltaLatitude);\r\n\r\n\t\tlet smallNum = 0.00001;\r\n\t\treturn [{ longitude: longitude + smallNum, latitude: -90 }, { longitude: 180, latitude: -90 }, { longitude: 180, latitude: 90 }, { longitude: longitude + smallNum, latitude: 90 }];\r\n\t}\r\n\r\n\tpublic getRect1(): IGeoRectangle {\r\n\t\tlet longitude = $geo.wrapAngleTo180(180 - this.deltaLongitude);\r\n\t\tlet latitude = $geo.wrapAngleTo180(this.deltaLatitude);\r\n\r\n\t\treturn { north: latitude + 90, south: latitude - 90, west: longitude - 180, east: longitude };\r\n\t}\r\n\r\n\tpublic getRect2(): IGeoRectangle {\r\n\t\tlet longitude = $geo.wrapAngleTo180(180 - this.deltaLongitude);\r\n\t\tlet latitude = $geo.wrapAngleTo180(this.deltaLatitude);\r\n\r\n\t\treturn { north: latitude + 90, south: latitude - 90, west: longitude, east: (longitude + 180) };\r\n\t}\r\n\r\n\r\n\r\n\tprotected clipGeoLine(geoLine: IGeoPoint[][]): IGeoPoint[][] {\r\n\t\tif (!geoLine) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet clippedLine: IGeoPoint[][] = [];\r\n\r\n\t\tlet clipRectangle1 = this.getClipRectangle1();\r\n\t\tlet clipRectangle2 = this.getClipRectangle2();\r\n\r\n\t\tfor (let i = 0, len = geoLine.length; i < len; i++) {\r\n\t\t\tlet segment: IGeoPoint[] = geoLine[i];\r\n\r\n\t\t\tif (segment) {\r\n\t\t\t\tlet clippedSegments: IGeoPoint[][] = this.clipLine(segment, clipRectangle1);\r\n\t\t\t\tclippedLine = clippedLine.concat(clippedSegments);\r\n\r\n\t\t\t\tif (this.deltaLongitude != 0) {\r\n\t\t\t\t\tlet clippedSegments2: IGeoPoint[][] = this.clipLine(segment, clipRectangle2);\r\n\t\t\t\t\tclippedLine = clippedLine.concat(clippedSegments2);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn clippedLine;\r\n\t}\r\n\r\n\r\n\tprotected clipGeoArea(geoArea: IGeoPoint[][][]): IGeoPoint[][][] {\r\n\r\n\t\tif (!geoArea) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet clippedArea: IGeoPoint[][][] = [];\r\n\r\n\t\tlet clipRectangle1 = this.getClipRectangle1();\r\n\t\tlet clipRectangle2 = this.getClipRectangle2();\r\n\r\n\t\tlet rect1 = this.getRect1();\r\n\t\tlet rect2 = this.getRect2();\r\n\r\n\t\tfor (let i = 0, len = geoArea.length; i < len; i++) {\r\n\r\n\t\t\tlet surface: IGeoPoint[] = geoArea[i][0];\r\n\t\t\tlet hole: IGeoPoint[] = geoArea[i][1];\r\n\r\n\t\t\tlet clippedAreas: IGeoPoint[][][] = [];\r\n\r\n\t\t\tif (surface) {\r\n\r\n\t\t\t\tlet surfaceRect = this.getExtremes(surface);\r\n\r\n\t\t\t\tif (!this.isInside(surfaceRect, rect1) && !this.isOutside(surfaceRect, rect1)) {\r\n\t\t\t\t\tlet clippedSurface1: IGeoPoint[] = this.clip(surface, clipRectangle1);\r\n\t\t\t\t\tlet clippedHole1: IGeoPoint[] = this.clip(hole, clipRectangle1);\r\n\t\t\t\t\tclippedAreas.push([clippedSurface1, clippedHole1]);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tclippedAreas.push([surface, hole]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!this.isInside(surfaceRect, rect2) && !this.isOutside(surfaceRect, rect2)) {\r\n\t\t\t\t\tlet clippedSurface2: IGeoPoint[] = this.clip(surface, clipRectangle2);\r\n\t\t\t\t\tlet clippedHole2: IGeoPoint[] = this.clip(hole, clipRectangle2);\r\n\t\t\t\t\tclippedAreas.push([clippedSurface2, clippedHole2]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (let area of clippedAreas) {\r\n\t\t\t\tclippedArea.push(area);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn clippedArea;\r\n\t}\r\n\r\n\tprotected convertGeoArea(geoArea: IGeoPoint[][][]): IPoint[][][] {\r\n\r\n\t\tif (!geoArea) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet convertedPoints: IPoint[][][] = [];\r\n\r\n\t\tfor (let i = 0, len = geoArea.length; i < len; i++) {\r\n\r\n\t\t\tlet surface: IGeoPoint[] = geoArea[i][0];\r\n\t\t\tlet hole: IGeoPoint[] = geoArea[i][1];\r\n\r\n\t\t\tlet convertedAreaPoints: IPoint[][] = [];\r\n\r\n\t\t\tif (surface) {\r\n\t\t\t\tlet convertedSurface: IPoint[] = [];\r\n\r\n\t\t\t\tfor (let s = 0, slen = surface.length; s < slen; s++) {\r\n\t\t\t\t\tlet point: IPoint = this.convert(surface[s]);\r\n\r\n\t\t\t\t\tconvertedSurface.push(point);\r\n\t\t\t\t}\r\n\t\t\t\tconvertedAreaPoints.push(convertedSurface);\r\n\t\t\t}\r\n\r\n\t\t\tif (hole) {\r\n\t\t\t\tlet convertedHole: IPoint[] = [];\r\n\t\t\t\tfor (let s = 0, hlen = hole.length; s < hlen; s++) {\r\n\t\t\t\t\tlet point: IPoint = this.convert(hole[s]);\r\n\r\n\t\t\t\t\tconvertedHole.push(point);\r\n\t\t\t\t}\r\n\t\t\t\tconvertedAreaPoints.push(convertedHole);\r\n\t\t\t}\r\n\t\t\tconvertedPoints.push(convertedAreaPoints);\r\n\t\t}\r\n\t\treturn convertedPoints;\r\n\t}\r\n\r\n\tprotected convertGeoLine(geoLine: IGeoPoint[][]): IPoint[][] {\r\n\t\tif (!geoLine) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet convertedPoints: IPoint[][] = [];\r\n\r\n\t\tfor (let i = 0, len = geoLine.length; i < len; i++) {\r\n\r\n\t\t\tlet segment: IGeoPoint[] = geoLine[i];\r\n\r\n\t\t\tlet convertedSegmentPoints: IPoint[] = [];\r\n\r\n\t\t\tfor (let s = 0, slen = segment.length; s < slen; s++) {\r\n\t\t\t\tlet geoPoint: IGeoPoint = segment[s];\r\n\r\n\t\t\t\tlet point: IPoint = this.convert(geoPoint);\r\n\t\t\t\tconvertedSegmentPoints.push(point);\r\n\t\t\t}\r\n\r\n\t\t\tconvertedPoints.push(convertedSegmentPoints);\r\n\t\t}\r\n\t\treturn convertedPoints;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Converts a geographical point (lat/long) to a screen point (x/y)\r\n\t * @param geoPoint Geo point (lat/long)\r\n\t * @return Screen point (x/y)\r\n\t */\r\n\tpublic convert(geoPoint: IGeoPoint): IPoint {\r\n\t\tgeoPoint = $geo.normalizePoint(geoPoint);\r\n\t\tgeoPoint = this.rotate(geoPoint, this.deltaLongitude, this.deltaLatitude, this.deltaGama);\r\n\t\tlet pointInRadians: IPoint = this.project(geoPoint.longitude * $math.RADIANS, geoPoint.latitude * $math.RADIANS);\r\n\t\treturn {\r\n\t\t\tx: $math.round(pointInRadians.x * $math.DEGREES - this.centerPoint.x, 4) * this.scale,\r\n\t\t\ty: $math.round(-pointInRadians.y * $math.DEGREES - this.centerPoint.y, 4) * this.scale\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Converts a screen point (x/y) to a geographical point (lat/long)\r\n\t * @param point Screen point (x/y)\r\n\t * @return Geo point (lat/long)\r\n\t */\r\n\tpublic invert(point: IPoint): IGeoPoint {\r\n\t\tlet pointInRadians: IGeoPoint = this.unproject((point.x / this.scale + this.centerPoint.x) * $math.RADIANS, (-point.y / this.scale - this.centerPoint.y) * $math.RADIANS);\r\n\r\n\t\tlet geoPoint = { longitude: pointInRadians.longitude * $math.DEGREES, latitude: pointInRadians.latitude * $math.DEGREES };\r\n\r\n\t\tgeoPoint = this.unrotate(geoPoint, this.deltaLongitude, this.deltaLatitude, this.deltaGama);\r\n\r\n\t\treturn geoPoint;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns X/Y coordinates.\r\n\t * Individual projections will override this method to apply their own\r\n\t * projection logic.\r\n\t * @param lambda [description]\r\n\t * @param phi    [description]\r\n\t * @return X/Y coordinates\r\n\t * @todo Needs description\r\n\t */\r\n\tpublic project(lambda: number, phi: number): IPoint {\r\n\t\treturn { x: lambda, y: phi };\r\n\t}\r\n\r\n\t/**\r\n\t * Returns geographical coordinates (lat/long).\r\n\t * Individual projections will override this method to apply their own\r\n\t * projection logic.\r\n\t * @param x X coordinate\r\n\t * @param y Y coordinate\r\n\t * @return Geographical point\r\n\t * @todo Needs description\r\n\t */\r\n\tpublic unproject(x: number, y: number): IGeoPoint {\r\n\t\treturn { longitude: x, latitude: y };\r\n\t}\r\n\r\n\r\n\trotate(geoPoint: IGeoPoint, deltaLongitude: number, deltaLatitude: number, deltaGamma?: number): IGeoPoint {\r\n\r\n\t\tlet deltaLambda = deltaLongitude * $math.RADIANS;\r\n\t\tlet deltaPhi = deltaLatitude * $math.RADIANS;\r\n\t\tdeltaGamma = deltaGamma * $math.RADIANS;\r\n\r\n\t\tlet lambda = geoPoint.longitude * $math.RADIANS + deltaLambda;\r\n\t\tlet phi = geoPoint.latitude * $math.RADIANS;\r\n\r\n\t\tlet cosDeltaPhi = Math.cos(deltaPhi);\r\n\t\tlet sinDeltaPhi = Math.sin(deltaPhi);\r\n\t\tlet cosDeltaGamma = Math.cos(deltaGamma);\r\n\t\tlet sinDeltaGamma = Math.sin(deltaGamma);\r\n\r\n\t\tlet cosPhi = Math.cos(phi);\r\n\r\n\t\tlet x = Math.cos(lambda) * cosPhi;\r\n\t\tlet y = Math.sin(lambda) * cosPhi;\r\n\t\tlet z = Math.sin(phi);\r\n\t\tlet k = z * cosDeltaPhi + x * sinDeltaPhi;\r\n\r\n\t\treturn { longitude: $math.DEGREES * Math.atan2(y * cosDeltaGamma - k * sinDeltaGamma, x * cosDeltaPhi - z * sinDeltaPhi), latitude: $math.DEGREES * Math.asin(k * cosDeltaGamma + y * sinDeltaGamma) };\r\n\t}\r\n\r\n\tunrotate(geoPoint: IGeoPoint, deltaLongitude: number, deltaLatitude: number, deltaGamma?: number): IGeoPoint {\r\n\r\n\t\tlet deltaLambda = deltaLongitude * $math.RADIANS;\r\n\t\tlet deltaPhi = deltaLatitude * $math.RADIANS;\r\n\t\tdeltaGamma = deltaGamma * $math.RADIANS;\r\n\r\n\t\tlet lambda = geoPoint.longitude * $math.RADIANS - deltaLambda;\r\n\t\tlet phi = geoPoint.latitude * $math.RADIANS;\r\n\r\n\t\tlet cosDeltaPhi = Math.cos(deltaPhi);\r\n\t\tlet sinDeltaPhi = Math.sin(deltaPhi);\r\n\t\tlet cosDeltaGamma = Math.cos(deltaGamma);\r\n\t\tlet sinDeltaGamma = Math.sin(deltaGamma);\r\n\r\n\t\tlet cosPhi = Math.cos(phi);\r\n\r\n\t\tlet x = Math.cos(lambda) * cosPhi;\r\n\t\tlet y = Math.sin(lambda) * cosPhi;\r\n\t\tlet z = Math.sin(phi);\r\n\t\tlet k = z * cosDeltaGamma - y * sinDeltaGamma;\r\n\r\n\t\treturn { longitude: $math.DEGREES * Math.atan2(y * cosDeltaGamma + z * sinDeltaGamma, x * cosDeltaPhi + k * sinDeltaPhi), latitude: $math.DEGREES * Math.asin(k * cosDeltaPhi - x * sinDeltaPhi) };\r\n\t}\r\n\r\n\r\n\r\n\tclipLine(subjectPolyline: IGeoPoint[], clipPolygon: IGeoPoint[]): IGeoPoint[][] {\r\n\r\n\t\tif (!subjectPolyline || subjectPolyline.length == 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet cp1: IGeoPoint;\r\n\t\tlet cp2: IGeoPoint;\r\n\r\n\t\tvar inside = function(p: IGeoPoint) {\r\n\t\t\treturn (cp2.longitude - cp1.longitude) * (p.latitude - cp1.latitude) > (cp2.latitude - cp1.latitude) * (p.longitude - cp1.longitude);\r\n\t\t};\r\n\r\n\t\tlet s: IGeoPoint;\r\n\t\tlet e: IGeoPoint;\r\n\r\n\t\t//@todo: make a separate function\r\n\t\tvar intersection = function() {\r\n\t\t\tlet dc = { longitude: cp1.longitude - cp2.longitude, latitude: cp1.latitude - cp2.latitude };\r\n\t\t\tlet dp = { longitude: s.longitude - e.longitude, latitude: s.latitude - e.latitude };\r\n\t\t\tlet n1 = cp1.longitude * cp2.latitude - cp1.latitude * cp2.longitude;\r\n\t\t\tlet n2 = s.longitude * e.latitude - s.latitude * e.longitude;\r\n\t\t\tlet n3 = 1.0 / (dc.longitude * dp.latitude - dc.latitude * dp.longitude);\r\n\r\n\t\t\treturn { longitude: (n1 * dp.longitude - n2 * dc.longitude) * n3, latitude: (n1 * dp.latitude - n2 * dc.latitude) * n3 };\r\n\t\t};\r\n\r\n\t\tvar segment: IGeoPoint[] = subjectPolyline;\r\n\r\n\t\tcp1 = clipPolygon[clipPolygon.length - 1];\r\n\r\n\t\tfor (let j = 0; j < clipPolygon.length; ++j) {\r\n\t\t\tcp2 = clipPolygon[j];\r\n\t\t\tlet inputList = segment;\r\n\t\t\tsegment = [];\r\n\t\t\ts = inputList[0];\r\n\t\t\tfor (let i = 0, len = inputList.length; i < len; i++) {\r\n\t\t\t\te = inputList[i];\r\n\r\n\t\t\t\tif (inside(e)) {\r\n\t\t\t\t\tif (!inside(s)) {\r\n\t\t\t\t\t\tsegment.push(intersection());\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsegment.push(e);\r\n\t\t\t\t}\r\n\t\t\t\telse if (inside(s)) {\r\n\t\t\t\t\tsegment.push(intersection());\r\n\t\t\t\t}\r\n\r\n\t\t\t\ts = e;\r\n\t\t\t}\r\n\t\t\tcp1 = cp2;\r\n\t\t}\r\n\r\n\t\treturn [segment];\r\n\t}\r\n\r\n\r\n\r\n\r\n\t//@todo add credits to roseta code\r\n\t//@todo: someday make it better\r\n\tclip(subjectPolygon: IGeoPoint[], clipPolygon: IGeoPoint[]) {\r\n\r\n\t\tif (!subjectPolygon || subjectPolygon.length == 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet cp1: IGeoPoint;\r\n\t\tlet cp2: IGeoPoint;\r\n\r\n\t\tvar inside = function(p: IGeoPoint) {\r\n\t\t\treturn (cp2.longitude - cp1.longitude) * (p.latitude - cp1.latitude) > (cp2.latitude - cp1.latitude) * (p.longitude - cp1.longitude);\r\n\t\t};\r\n\r\n\t\tlet s: IGeoPoint;\r\n\t\tlet e: IGeoPoint;\r\n\t\t//@todo: make a separate function\r\n\t\tvar intersection = function() {\r\n\t\t\tlet dc = { longitude: cp1.longitude - cp2.longitude, latitude: cp1.latitude - cp2.latitude };\r\n\t\t\tlet dp = { longitude: s.longitude - e.longitude, latitude: s.latitude - e.latitude };\r\n\t\t\tlet n1 = cp1.longitude * cp2.latitude - cp1.latitude * cp2.longitude;\r\n\t\t\tlet n2 = s.longitude * e.latitude - s.latitude * e.longitude;\r\n\t\t\tlet n3 = 1.0 / (dc.longitude * dp.latitude - dc.latitude * dp.longitude);\r\n\r\n\t\t\treturn { longitude: (n1 * dp.longitude - n2 * dc.longitude) * n3, latitude: (n1 * dp.latitude - n2 * dc.latitude) * n3 };\r\n\t\t};\r\n\r\n\t\tvar outputList = subjectPolygon;\r\n\r\n\t\tcp1 = clipPolygon[clipPolygon.length - 1];\r\n\r\n\t\tfor (let j = 0; j < clipPolygon.length; ++j) {\r\n\t\t\tcp2 = clipPolygon[j];\r\n\t\t\tlet inputList = outputList;\r\n\t\t\toutputList = [];\r\n\t\t\ts = inputList[inputList.length - 1]; //last on the input list\r\n\r\n\t\t\tfor (let i = 0, len = inputList.length; i < len; ++i) {\r\n\t\t\t\te = inputList[i];\r\n\r\n\t\t\t\tif (inside(e)) {\r\n\t\t\t\t\tif (!inside(s)) {\r\n\t\t\t\t\t\toutputList.push(intersection());\r\n\t\t\t\t\t}\r\n\t\t\t\t\toutputList.push(e);\r\n\t\t\t\t}\r\n\t\t\t\telse if (inside(s)) {\r\n\t\t\t\t\toutputList.push(intersection());\r\n\t\t\t\t}\r\n\t\t\t\ts = e;\r\n\t\t\t}\r\n\r\n\t\t\tcp1 = cp2;\r\n\t\t}\r\n\t\treturn outputList;\r\n\t}\r\n\r\n\t//@todo: move to some utils?\r\n\tpublic getExtremes(geoPoints: IGeoPoint[]): IGeoRectangle {\r\n\r\n\t\tlet west: number = geoPoints[0].longitude;\r\n\t\tlet east: number = geoPoints[0].longitude;\r\n\t\tlet north: number = geoPoints[0].latitude;\r\n\t\tlet south: number = geoPoints[0].latitude;\r\n\r\n\t\tfor (let s: number = 0; s < geoPoints.length; s++) {\r\n\t\t\tlet longitude: number = geoPoints[s].longitude;\r\n\t\t\tlet latitude: number = geoPoints[s].latitude;\r\n\r\n\t\t\tif ((west > longitude)) {\r\n\t\t\t\twest = longitude;\r\n\t\t\t}\r\n\t\t\tif ((east < longitude)) {\r\n\t\t\t\teast = longitude;\r\n\t\t\t}\r\n\r\n\t\t\tif ((north < latitude)) {\r\n\t\t\t\tnorth = latitude;\r\n\t\t\t}\r\n\t\t\tif ((south > latitude)) {\r\n\t\t\t\tsouth = latitude;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn { north: north, east: east, south: south, west: west };\r\n\t}\r\n\r\n\t//@todo: move to some utils?\r\n\tpublic isInside(r1: IGeoRectangle, r2: IGeoRectangle) {\r\n\t\tif (r1.north < r2.north && r1.south > r2.south && r1.west > r2.west && r1.east < r2.east) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t//@todo: move to some utils?\r\n\tpublic isOutside(r1: IGeoRectangle, r2: IGeoRectangle) {\r\n\t\tif (r1.south > r2.north || r1.north < r2.south || r1.west > r2.east || r1.east < r2.west) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\r\n\t//@todo: move to some utils?\r\n\t//@todo: add credits to: https://www.movable-type.co.uk/scripts/latlong.html\r\n\tpublic intermediatePoint(pointA: IGeoPoint, pointB: IGeoPoint, position: number) {\r\n\t\tvar phi1 = pointA.latitude * $math.RADIANS;\r\n\t\tlet lambda1 = pointA.longitude * $math.RADIANS;\r\n\r\n\t\tlet phi2 = pointB.latitude * $math.RADIANS;\r\n\t\tlet lambda2 = pointB.longitude * $math.RADIANS;\r\n\r\n\t\tvar sinPhi1 = Math.sin(phi1);\r\n\t\tlet cosPhi1 = Math.cos(phi1);\r\n\t\tlet sinLambda1 = Math.sin(lambda1);\r\n\t\tlet cosLambda1 = Math.cos(lambda1);\r\n\t\tvar sinPhi2 = Math.sin(phi2);\r\n\t\tlet cosPhi2 = Math.cos(phi2);\r\n\t\tlet sinLambda2 = Math.sin(lambda2);\r\n\t\tlet cosLambda2 = Math.cos(lambda2);\r\n\r\n\t\t// distance between points\r\n\t\tvar deltaPhi = phi2 - phi1;\r\n\t\tvar deltaLambda = lambda2 - lambda1;\r\n\t\tvar a = Math.sin(deltaPhi / 2) * Math.sin(deltaPhi / 2) + Math.cos(phi1) * Math.cos(phi2) * Math.sin(deltaLambda / 2) * Math.sin(deltaLambda / 2);\r\n\t\tvar delta = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n\r\n\t\tvar A = Math.sin((1 - position) * delta) / Math.sin(delta);\r\n\t\tvar B = Math.sin(position * delta) / Math.sin(delta);\r\n\r\n\t\tvar x = A * cosPhi1 * cosLambda1 + B * cosPhi2 * cosLambda2;\r\n\t\tvar y = A * cosPhi1 * sinLambda1 + B * cosPhi2 * sinLambda2;\r\n\t\tvar z = A * sinPhi1 + B * sinPhi2;\r\n\r\n\t\tvar phi3 = Math.atan2(z, Math.sqrt(x * x + y * y));\r\n\t\tvar lambda3 = Math.atan2(y, x);\r\n\r\n\t\treturn { latitude: phi3 * $math.DEGREES, longitude: lambda3 * $math.DEGREES };\r\n\t};\r\n}\r\n\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"Projection\"] = Projection;\r\n\n\n\n// WEBPACK FOOTER //\n// ../../../../../../src/.internal/charts/map/projections/Projection.ts","/**\r\n * Map module.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { SerialChart, ISerialChartProperties, ISerialChartDataFields, ISerialChartAdapters, ISerialChartEvents, SerialChartDataItem } from \"./SerialChart\";\r\nimport { Sprite, ISpriteEvents, SpriteEventDispatcher, AMEvent } from \"../../core/Sprite\";\r\nimport { IDisposer, MultiDisposer, MutableValueDisposer } from \"../../core/utils/Disposer\";\r\nimport { Container } from \"../../core/Container\";\r\nimport { ListTemplate } from \"../../core/utils/List\";\r\nimport { Legend } from \"../Legend\";\r\nimport { MapSeries } from \"../map/MapSeries\";\r\nimport { MapObject } from \"../map/MapObject\";\r\nimport { MapImage } from \"../map/MapImage\";\r\nimport { MapPolygon } from \"../map/MapPolygon\";\r\nimport { IPoint } from \"../../core/defs/IPoint\";\r\nimport { IGeoPoint } from \"../../core/defs/IGeoPoint\";\r\nimport { DataSource } from \"../../core/data/DataSource\";\r\nimport { Projection } from \"../map/projections/Projection\";\r\nimport { ZoomControl } from \"../map/ZoomControl\";\r\nimport { Ordering } from \"../../core/utils/Order\";\r\nimport { SmallMap } from \"../map/SmallMap\";\r\nimport { Animation } from \"../../core/utils/Animation\";\r\nimport { keyboard } from \"../../core/utils/Keyboard\";\r\nimport { getInteraction } from \"../../core/interaction/Interaction\";\r\nimport { registry } from \"../../core/Registry\";\r\nimport * as $math from \"../../core/utils/Math\";\r\nimport * as $utils from \"../../core/utils/Utils\";\r\nimport * as $ease from \"../../core/utils/Ease\";\r\nimport * as $iter from \"../../core/utils/Iterator\";\r\nimport * as $type from \"../../core/utils/Type\";\r\nimport * as $geo from \"../map/Geo\";\r\nimport { Paper } from \"../../core/rendering/Paper\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * DATA ITEM\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines a [[DataItem]] for [[MapChart]].\r\n *\r\n * @see {@link DataItem}\r\n */\r\nexport class MapChartDataItem extends SerialChartDataItem {\r\n\r\n\t/**\r\n\t * Defines a type of [[Component]] this data item is used for.\r\n\t */\r\n\tpublic _component!: MapChart;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"MapChartDataItem\";\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines interface for a map polygon object.\r\n */\r\nexport interface IMapPolygonDataObject {\r\n\r\n\t/**\r\n\t * A unique id of the object.\r\n\t */\r\n\tid?: string;\r\n\r\n\t/**\r\n\t * Numeric value for heat-map scenarios.\r\n\t */\r\n\tvalue?: number;\r\n\r\n\t/**\r\n\t * Single polygon information in X/Y coordinates.\r\n\t */\r\n\tpolygon?: number[][][];\r\n\r\n\t/**\r\n\t * Multi-part polygon information in X/Y coordinates.\r\n\t */\r\n\tmultiPolygon?: number[][][][];\r\n\r\n\t/**\r\n\t * Single polygon information in lat/long geo-coordinates.\r\n\t */\r\n\tgeoPolygon?: IGeoPoint[][];\r\n\r\n\t/**\r\n\t * Multi-part polygon information in lat/long geo-coordinates.\r\n\t */\r\n\tmultiGeoPolygon?: IGeoPoint[][][];\r\n\r\n}\r\n\r\n/**\r\n * Defines types of map line.\r\n */\r\nexport type MapLineType = \"line\" | \"arc\" | \"spline\" | \"realTrajectory\";\r\n\r\n/**\r\n * Defines interface for the map line object.\r\n */\r\nexport interface IMapLineDataObject {\r\n\r\n\t/**\r\n\t * A unique id of the object.\r\n\t */\r\n\tid?: string;\r\n\r\n\t/**\r\n\t * Numeric value for heat-map scenarios.\r\n\t */\r\n\tvalue?: number;\r\n\r\n\t/**\r\n\t * Single line information in X/Y coordinates.\r\n\t */\r\n\tline?: number[][];\r\n\r\n\t/**\r\n\t * Multi-part line information in X/Y coordinates.\r\n\t */\r\n\tmultiLine?: number[][][];\r\n\r\n\t/**\r\n\t * Single line information in lat/long geo-coordinates.\r\n\t */\r\n\tgeoLine?: IGeoPoint[];\r\n\r\n\t/**\r\n\t * Multi-part line information in lat/long geo-coordinates.\r\n\t */\r\n\tmultiGeoLine?: IGeoPoint[][];\r\n\r\n}\r\n\r\n/**\r\n * Defines interface for a map image (market) object.\r\n */\r\nexport interface IMapImageDataObject {\r\n\r\n\t/**\r\n\t * A unique id of the object.\r\n\t */\r\n\tid?: string;\r\n\r\n\t/**\r\n\t * Numeric value for heat-map scenarios.\r\n\t */\r\n\tvalue?: number;\r\n\r\n\t/**\r\n\t * Image position information in X/Y coordinates.\r\n\t */\r\n\tpoint?: number[];\r\n\r\n\t/**\r\n\t * Multi-image position information in X/Y coordinates.\r\n\t */\r\n\tmultiPoint?: number[][];\r\n\r\n\t/**\r\n\t * Image position information in lat/long geo-coordinates.\r\n\t */\r\n\tgeoPoint?: IGeoPoint;\r\n\r\n\t/**\r\n\t * Multi-image position information in lat/long geo-coordinates.\r\n\t */\r\n\tmultiGeoPoint?: IGeoPoint[];\r\n\r\n}\r\n\r\n/**\r\n * Defines type suitable for all map objects.\r\n */\r\nexport type IMapDataObject = IMapPolygonDataObject | IMapLineDataObject;\r\n\r\n/**\r\n * Defines data fields for [[MapChart]].\r\n */\r\nexport interface IMapChartDataFields extends ISerialChartDataFields { }\r\n\r\n/**\r\n * Defines properties for [[MapChart]].\r\n */\r\nexport interface IMapChartProperties extends ISerialChartProperties {\r\n\r\n\t/**\r\n\t * Projection to be used when drawing the map.\r\n\t */\r\n\tprojection?: Projection;\r\n\r\n\t/**\r\n\t * Degrees to shift map center by.\r\n\t *\r\n\t * E.g. if set to -160, the longitude 20 will become a new center, creating\r\n\t * a Pacific-centered map.\r\n\t */\r\n\tdeltaLongitude?: number;\r\n\r\n\t/**\r\n\t * Maximum portion of the map's width/height to allow panning \"off screen\".\r\n\t *\r\n\t * A value of 0 (zero) will prevent any portion of the the map to be panned\r\n\t * outside the viewport.\r\n\t *\r\n\t * 0.5 will allow half of the map to be outside viewable area.\r\n\t *\r\n\t * @default 0.7\r\n\t */\r\n\tmaxPanOut?: number;\r\n\r\n\t/**\r\n\t * A map will start centered on this geographical point.\r\n\t */\r\n\thomeGeoPoint?: IGeoPoint;\r\n\r\n\t/**\r\n\t * A map will start zoomed to this level.\r\n\t */\r\n\thomeZoomLevel?: number;\r\n\r\n\t/**\r\n\t * When user zooms in or out current zoom level is multiplied or divided\r\n\t * by value of this setting.\r\n\t *\r\n\t * @default 2\r\n\t */\r\n\tzoomStep?: number;\r\n\r\n\t/**\r\n\t * Specifies what should chart do if when mouse wheel is rotated.\r\n\t */\r\n\tmouseWheelBehavior?: \"zoom\" | \"none\";\r\n}\r\n\r\n/**\r\n * Defines events for [[MapChart]].\r\n */\r\nexport interface IMapChartEvents extends ISerialChartEvents {\r\n\r\n\t/**\r\n\t * Invoked when map is zoomed in or out.\r\n\t */\r\n\tzoomlevelchanged: {};\r\n\r\n\t/**\r\n\t * Invoked when map is panned. (moved)\r\n\t */\r\n\tmappositionchanged: {};\r\n\r\n\t/**\r\n\t * Invoked when scale ratio is changed, e.g when the whole map area is\r\n\t * resized and the map needs to be resized to fit it, without changing\r\n\t * zoom level.\r\n\t */\r\n\tscaleratiochanged: {};\r\n\r\n}\r\n\r\n/**\r\n * Defines adapters for [[MapChart]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface IMapChartAdapters extends ISerialChartAdapters, IMapChartProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Creates a map.\r\n *\r\n * @see {@link IMapChartEvents} for a list of available Events\r\n * @see {@link IMapChartAdapters} for a list of available Adapters\r\n * @see {@link https://www.amcharts.com/docs/v4/chart-types/map/} for documentation\r\n */\r\nexport class MapChart extends SerialChart {\r\n\r\n\t/**\r\n\t * Available data fields.\r\n\t */\r\n\tpublic _dataFields: IMapChartDataFields;\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IMapChartProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IMapChartAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IMapChartEvents;\r\n\r\n\t/**\r\n\t * The East-most longitude point of the map.\r\n\t */\r\n\tpublic east: number;\r\n\r\n\t/**\r\n\t * The West-most longitude point of the map.\r\n\t */\r\n\tpublic west: number;\r\n\r\n\t/**\r\n\t * The South-most latitude point of the map.\r\n\t */\r\n\tpublic south: number;\r\n\r\n\t/**\r\n\t * The North-most latitude point of the map.\r\n\t */\r\n\tpublic north: number;\r\n\r\n\t/**\r\n\t * A ratio to be used when scaling the map shapes.\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tpublic scaleRatio: number = 1;\r\n\r\n\t/**\r\n\t * A screen point of the map's center.\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tpublic centerPoint: IPoint;\r\n\r\n\t/**\r\n\t * A screen point of the map's left.\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tpublic westPoint: IPoint;\r\n\r\n\t/**\r\n\t * A screen point of the map's right.\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tpublic eastPoint: IPoint;\r\n\r\n\t/**\r\n\t * A screen point of the map's top.\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tpublic northPoint: IPoint;\r\n\r\n\t/**\r\n\t * A screen point of the map's bottom.\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tpublic southPoint: IPoint;\r\n\r\n\t/**\r\n\t * Width of the actual map objects (px).\r\n\t */\r\n\tpublic seriesWidth: number;\r\n\r\n\t/**\r\n\t * Height of the actual map objects (px).\r\n\t */\r\n\tpublic seriesHeight: number;\r\n\r\n\t/**\r\n\t * Map data in GeoJSON format.\r\n\t *\r\n\t * @see {@link http://geojson.org/} GeoJSON official specification\r\n\t */\r\n\tprotected _geodata: Object;\r\n\r\n\t/**\r\n\t * A reference to a [[ZoomControl]] instance.\r\n\t */\r\n\tprotected _zoomControl: ZoomControl;\r\n\r\n\t/**\r\n\t * A reference to a [[SmallMap]] control instance.\r\n\t */\r\n\tprotected _smallMap: SmallMap;\r\n\r\n\t/**\r\n\t * [_zoomGeoPoint description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprotected _zoomGeoPoint: IGeoPoint;\r\n\r\n\t/**\r\n\t * Default duration of zoom animations (ms).\r\n\t */\r\n\tpublic zoomDuration: number = 1000;\r\n\r\n\t/**\r\n\t * Default zooming animation easing function.\r\n\t */\r\n\tpublic zoomEasing: (value: number) => number = $ease.cubicOut;\r\n\r\n\t/**\r\n\t * Smallest available zoom level. The map will not allow to zoom out past\r\n\t * this setting.\r\n\t *\r\n\t * NOTE: Should be power of 2.\r\n\t *\r\n\t * @default 1\r\n\t */\r\n\tpublic minZoomLevel: number = 1;\r\n\r\n\t/**\r\n\t * Biggest available zoom level. The map will not allow to zoom in past\r\n\t * this setting.\r\n\t *\r\n\t * NOTE: Should be power of 2.\r\n\t *\r\n\t * @default 32\r\n\t */\r\n\tpublic maxZoomLevel: number = 32;\r\n\r\n\t/**\r\n\t * [_prevZoomLevel description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprotected _prevZoomLevel: number;\r\n\r\n\t/**\r\n\t * [_prevZoomGeoPoint description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprotected _prevZoomGeoPoint: IGeoPoint = { latitude: 0, longitude: 0 };\r\n\r\n\t/**\r\n\t * Defines a type of series that this chart uses.\r\n\t */\r\n\tpublic _seriesType: MapSeries;\r\n\r\n\t/**\r\n\t * A reference to currently playing animation, e.g. zooming.\r\n\t */\r\n\tprotected _mapAnimation: Animation;\r\n\r\n\tprotected _mouseWheelDisposer: IDisposer;\r\n\r\n\tprotected _zoomGeoPointReal: IGeoPoint;\r\n\r\n\tprotected _centerGeoPoint: IGeoPoint;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\r\n\t\t// Init\r\n\t\tsuper();\r\n\t\tthis.className = \"MapChart\";\r\n\r\n\t\t// Set default projection\r\n\t\tthis.projection = new Projection();\r\n\r\n\t\tthis.deltaLongitude = 0;\r\n\t\tthis.maxPanOut = 0.7;\r\n\t\tthis.homeZoomLevel = 1;\r\n\t\tthis.zoomStep = 2;\r\n\r\n\t\t// Set padding\r\n\t\tthis.padding(0, 0, 0, 0);\r\n\r\n\t\t// so that the map would render in a hidden div too\r\n\t\tthis.minWidth = 10;\r\n\t\tthis.minHeight = 10;\r\n\r\n\t\tthis.events.once(\"inited\", this.handleAllInited, this, false);\r\n\r\n\t\t// Create a container for map series\r\n\t\tlet seriesContainer = this.seriesContainer;\r\n\t\tseriesContainer.draggable = true;\r\n\t\tseriesContainer.visible = false;\r\n\t\tseriesContainer.inert = true;\r\n\t\tseriesContainer.resizable = true;\r\n\t\tseriesContainer.events.on(\"transformed\", this.handleMapTransform, this, false);\r\n\t\tseriesContainer.events.on(\"doublehit\", this.handleDoubleHit, this, false);\r\n\t\tseriesContainer.events.on(\"drag\", this.handleDrag, this, false);\r\n\t\tseriesContainer.zIndex = 0;\r\n\t\tseriesContainer.background.fillOpacity = 0;\r\n\r\n\t\t// Set up events\r\n\t\t//this.events.on(\"validated\", this.updateExtremes, this);\r\n\t\tthis.events.on(\"datavalidated\", this.updateExtremes, this, false);\r\n\r\n\t\t// Set up main chart container, e.g. set backgrounds and events to monitor\r\n\t\t// size changes, etc.\r\n\t\tlet chartContainer = this.chartContainer;\r\n\t\tchartContainer.parent = this;\r\n\t\tchartContainer.isMeasured = false;\r\n\t\tchartContainer.zIndex = -1;\r\n\r\n\t\tthis._disposers.push(seriesContainer.events.on(\"maxsizechanged\", () => {\r\n\t\t\tif (this.inited) {\r\n\t\t\t\tif (this._mapAnimation) {\r\n\t\t\t\t\tthis._mapAnimation.stop();\r\n\t\t\t\t}\r\n\t\t\t\tthis.updateScaleRatio();\r\n\t\t\t\tthis.zoomToGeoPoint(this._zoomGeoPointReal, this.zoomLevel, true, 0);\r\n\r\n\t\t\t\tthis.series.each((series) => {\r\n\t\t\t\t\tseries.updateTooltipBounds();\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}, undefined, false));\r\n\r\n\t\tlet chartContainerBg = chartContainer.background;\r\n\t\tchartContainerBg.fillOpacity = 0;\r\n\t\tchartContainerBg.events.on(\"down\", (e) => { this.seriesContainer.dragStart(e.target.interactions.downPointers.getIndex(0)); }, this);\r\n\t\tchartContainerBg.events.on(\"up\", (e) => { this.seriesContainer.dragStop() }, this);\r\n\t\tchartContainerBg.events.on(\"doublehit\", this.handleDoubleHit, this);\r\n\t\tchartContainerBg.focusable = true;\r\n\r\n\t\tchartContainer.events.on(\"down\", this.handleMapDown, this, false);\r\n\r\n\t\t// Add description to background\r\n\t\tthis.background.fillOpacity = 0;\r\n\t\tthis.background.readerTitle = this.language.translate(\"Use plus and minus keys on your keyboard to zoom in and out\");\r\n\r\n\t\t// Add keyboard events for panning\r\n\t\tthis._disposers.push(getInteraction().body.events.on(\"keyup\", (ev) => {\r\n\t\t\tif (this.topParent.hasFocused && (!this._zoomControl || !this._zoomControl.thumb.isFocused)) {\r\n\t\t\t\tswitch (keyboard.getEventKey(ev.event)) {\r\n\t\t\t\t\tcase \"up\":\r\n\t\t\t\t\t\tthis.pan({ x: 0, y: 0.1 });\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"down\":\r\n\t\t\t\t\t\tthis.pan({ x: 0, y: -0.1 });\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"left\":\r\n\t\t\t\t\t\tthis.pan({ x: 0.1, y: 0 });\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"right\":\r\n\t\t\t\t\t\tthis.pan({ x: -0.1, y: 0 });\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, this));\r\n\r\n\t\tthis.mouseWheelBehavior = \"zoom\";\r\n\r\n\t\t// Apply theme\r\n\t\tthis.applyTheme();\r\n\r\n\t}\r\n\r\n\r\n\tprotected handleAllInited() {\r\n\t\tlet inited = true;\r\n\t\tthis.seriesContainer.visible = true;\r\n\t\tthis.series.each((series) => {\r\n\t\t\tif (!series.inited) {\r\n\t\t\t\tinited = false;\r\n\t\t\t}\r\n\t\t})\r\n\t\tif (inited) {\r\n\t\t\tthis.updateExtremes();\r\n\t\t\tthis.goHome(0);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tregistry.events.once(\"exitframe\", this.handleAllInited, this, false);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Prevents map to be dragged out of the container area\r\n\t * @ignore\r\n\t */\r\n\tprotected handleDrag() {\r\n\t\t// not good doing it with adapters.\r\n\t\tlet ww = this.seriesWidth * this.zoomLevel * this.scaleRatio;\r\n\t\tlet hh = this.seriesHeight * this.zoomLevel * this.scaleRatio;\r\n\t\tlet x = this.seriesContainer.pixelX;\r\n\t\tlet y = this.seriesContainer.pixelY;\r\n\r\n\t\tlet maxPanOut = this.maxPanOut;\r\n\r\n\t\tlet minX = Math.min(this.maxWidth * (1 - maxPanOut) - ww / 2, -ww * (maxPanOut - 0.5));\r\n\t\tif (x < minX) {\r\n\t\t\tx = minX;\r\n\t\t}\r\n\r\n\t\tlet maxX = Math.max(this.maxWidth * maxPanOut + ww / 2, this.maxWidth + ww * (maxPanOut - 0.5));\r\n\t\tif (x > maxX) {\r\n\t\t\tx = maxX;\r\n\t\t}\r\n\r\n\r\n\t\tlet minY = Math.min(this.maxHeight * (1 - maxPanOut) - hh / 2, -hh * (maxPanOut - 0.5));\r\n\t\tif (y < minY) {\r\n\t\t\ty = minY;\r\n\t\t}\r\n\r\n\t\tlet maxY = Math.max(this.maxHeight * maxPanOut + hh / 2, this.maxHeight + hh * (maxPanOut - 0.5));\r\n\t\tif (y > maxY) {\r\n\t\t\ty = maxY;\r\n\t\t}\r\n\r\n\t\tthis.seriesContainer.moveTo({ x: x, y: y }, undefined, undefined, true);\r\n\r\n\t\tthis._zoomGeoPointReal = this.zoomGeoPoint;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets defaults that instantiate some objects that rely on parent, so they\r\n\t * cannot be set in constructor.\r\n\t */\r\n\tprotected applyInternalDefaults(): void {\r\n\r\n\t\tsuper.applyInternalDefaults();\r\n\r\n\t\t// Add a default screen reader title for accessibility\r\n\t\t// This will be overridden in screen reader if there are any `titles` set\r\n\t\tif (!$type.hasValue(this.readerTitle)) {\r\n\t\t\tthis.readerTitle = this.language.translate(\"Map\");\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Handles event when a pointer presses down on the map, e.g. user presses\r\n\t * down mouse or touches the map on a screen.\r\n\t *\r\n\t * Stops all animations currently going on.\r\n\t */\r\n\tprotected handleMapDown(): void {\r\n\t\tif (this._mapAnimation) {\r\n\t\t\tthis._mapAnimation.stop();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Handles the event when user doubleclicks or dooubletaps the map: zooms\r\n\t * in on the reference point.\r\n\t *\r\n\t * @param event  Original event\r\n\t */\r\n\tprotected handleDoubleHit(event: AMEvent<Sprite, ISpriteEvents>[\"doublehit\"]) {\r\n\t\tlet svgPoint: IPoint = $utils.documentPointToSvg(event.point, this.htmlContainer, this.svgContainer.cssScale);\r\n\t\tlet geoPoint: IGeoPoint = this.svgPointToGeo(svgPoint);\r\n\t\tthis.zoomIn(geoPoint);\r\n\t}\r\n\r\n\t/**\r\n\t * Handles mouse wheel event, e.g. user rotates mouse wheel while over the\r\n\t * map: zooms in or out depending on the direction of the wheel turn.\r\n\t *\r\n\t * @param event  Original event\r\n\t */\r\n\tprotected handleWheel(event: AMEvent<Sprite, ISpriteEvents>[\"wheel\"]) {\r\n\r\n\t\tlet svgPoint: IPoint = $utils.documentPointToSvg(event.point, this.htmlContainer, this.svgContainer.cssScale);\r\n\t\tlet geoPoint: IGeoPoint = this.svgPointToGeo(svgPoint);\r\n\r\n\t\tif (event.shift.y < 0) {\r\n\t\t\tthis.zoomIn(geoPoint);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.zoomOut(geoPoint);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Specifies what should chart do if when mouse wheel is rotated.\r\n\t *\r\n\t * @param mouse wheel behavior\r\n\t * @default zoomX\r\n\t */\r\n\tpublic set mouseWheelBehavior(value: \"zoom\" | \"none\") {\r\n\r\n\t\tif (this.setPropertyValue(\"mouseWheelBehavior\", value)) {\r\n\t\t\tif (value != \"none\") {\r\n\t\t\t\tthis._mouseWheelDisposer = this.chartContainer.events.on(\"wheel\", this.handleWheel, this, false);\r\n\t\t\t\tthis._disposers.push(this._mouseWheelDisposer);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (this._mouseWheelDisposer) {\r\n\t\t\t\t\tthis._mouseWheelDisposer.dispose();\r\n\t\t\t\t}\r\n\t\t\t\tthis.chartContainer.wheelable = false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return mouse wheel behavior\r\n\t */\r\n\tpublic get mouseWheelBehavior(): \"zoom\" | \"none\" {\r\n\t\treturn this.getPropertyValue(\"mouseWheelBehavior\");\r\n\t}\r\n\r\n\t/**\r\n\t * Projection to use for the map.\r\n\t *\r\n\t * Available projections:\r\n\t * * Eckert6\r\n\t * * Mercator\r\n\t * * Miller\r\n\t * * Orthographic\r\n\t *\r\n\t * ```TypeScript\r\n\t * map.projection = new am4maps.projections.Mercator();\r\n\t * ```\r\n\t * ```JavaScript\r\n\t * map.projection = new am4maps.projections.Mercator();\r\n\t * ```\r\n\t * ```JSON\r\n\t * {\r\n\t *   // ...\r\n\t *   \"projection\": \"Mercator\"\r\n\t *   // ...\r\n\t * }\r\n\t * ```\r\n\t *\r\n\t * @param projection  Projection\r\n\t */\r\n\tpublic set projection(projection: Projection) {\r\n\t\tprojection.deltaLongitude = this.deltaLongitude;\r\n\t\tif (this.setPropertyValue(\"projection\", projection)) {\r\n\t\t\tthis.invalidateProjection();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Projection\r\n\t */\r\n\tpublic get projection(): Projection {\r\n\t\treturn this.getPropertyValue(\"projection\");\r\n\t}\r\n\r\n\t/**\r\n\t * Calculates the longitudes and latitudes of the most distant points from\r\n\t * the center in all four directions: West, East, North, and South.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic updateExtremes(): void {\r\n\r\n\t\tlet pWest = this.west;\r\n\t\tlet pEast = this.east;\r\n\t\tlet pNorth = this.north;\r\n\t\tlet pSouth = this.south;\r\n\r\n\t\tthis.west = null;\r\n\t\tthis.east = null;\r\n\t\tthis.north = null;\r\n\t\tthis.south = null;\r\n\r\n\t\tlet chartContainer: Container = this.chartContainer;\r\n\r\n\r\n\t\t$iter.each(this.series.iterator(), (series) => {\r\n\t\t\tif ((this.west > series.west) || !$type.isNumber(this.west)) {\r\n\t\t\t\tthis.west = series.west;\r\n\t\t\t}\r\n\t\t\tif ((this.east < series.east) || !$type.isNumber(this.east)) {\r\n\t\t\t\tthis.east = series.east;\r\n\t\t\t}\r\n\r\n\t\t\tif ((this.north < series.north) || !$type.isNumber(this.north)) {\r\n\t\t\t\tthis.north = series.north;\r\n\t\t\t}\r\n\t\t\tif ((this.south > series.south) || !$type.isNumber(this.south)) {\r\n\t\t\t\tthis.south = series.south;\r\n\t\t\t}\r\n\t\t});\r\n\t\tif ($type.isNumber(this.east) && $type.isNumber(this.north)) {\r\n\t\t\t// must reset\r\n\t\t\tthis.projection.centerPoint = { x: 0, y: 0 };\r\n\t\t\tthis.projection.scale = 1;\r\n\r\n\t\t\t// temporary setting deltaLongitude to 0 in order to measure w/h correctly\r\n\t\t\tlet deltaLongitude = this.projection.deltaLongitude;\r\n\t\t\tthis.projection.deltaLongitude = 0;\r\n\r\n\t\t\tlet northPoint: IPoint = this.projection.convert({ longitude: (this.east - this.west) / 2, latitude: this.north });\r\n\t\t\tlet southPoint: IPoint = this.projection.convert({ longitude: (this.east - this.west) / 2, latitude: this.south });\r\n\r\n\t\t\tlet westPoint: IPoint = this.projection.convert({ longitude: this.west, latitude: 0 });\r\n\t\t\tlet eastPoint: IPoint = this.projection.convert({ longitude: this.east, latitude: 0 });\r\n\r\n\t\t\tthis.projection.deltaLongitude = deltaLongitude;\r\n\r\n\t\t\tthis.projection.centerPoint = { x: westPoint.x + (eastPoint.x - westPoint.x) / 2, y: northPoint.y + (southPoint.y - northPoint.y) / 2 };\r\n\r\n\t\t\tlet scaleRatio: number;\r\n\r\n\t\t\tlet seriesWidth = eastPoint.x - westPoint.x;\r\n\t\t\tlet seriesHeight = southPoint.y - northPoint.y;\r\n\r\n\t\t\tlet vScale: number = chartContainer.innerWidth / seriesWidth;\r\n\t\t\tlet hScale: number = chartContainer.innerHeight / seriesHeight;\r\n\r\n\t\t\tif (vScale > hScale) {\r\n\t\t\t\tscaleRatio = hScale;\r\n\t\t\t} else {\r\n\t\t\t\tscaleRatio = vScale;\r\n\t\t\t}\r\n\t\t\tif ($type.isNaN(scaleRatio) || scaleRatio == Infinity) {\r\n\t\t\t\tscaleRatio = 1;\r\n\t\t\t}\r\n\r\n\t\t\tlet projectionScaleChanged = false;\r\n\t\t\tif (this.projection.scale != scaleRatio) {\r\n\t\t\t\tthis.projection.scale = scaleRatio;\r\n\t\t\t\tprojectionScaleChanged = true;\r\n\t\t\t}\r\n\r\n\t\t\tthis.seriesWidth = seriesWidth * scaleRatio;\r\n\t\t\tthis.seriesHeight = seriesHeight * scaleRatio;\r\n\r\n\t\t\tlet northPoint2: IPoint = this.projection.convert({ longitude: (this.east - this.west) / 2, latitude: this.north });\r\n\t\t\tlet westPoint2: IPoint = this.projection.convert({ longitude: this.west - this.deltaLongitude, latitude: 0 });\r\n\r\n\t\t\tthis._centerGeoPoint = this.projection.invert({ x: westPoint2.x + this.seriesWidth / 2, y: northPoint2.y + this.seriesHeight / 2 });\r\n\r\n\t\t\t//this.seriesContainer.width = this.seriesWidth; // not good, doesn't resize\r\n\t\t\t//this.seriesContainer.height = this.seriesHeight; // not good, doesn't resize\r\n\t\t\tthis.seriesContainer.definedBBox = { x: westPoint2.x, y: northPoint2.y, width: this.seriesWidth, height: this.seriesHeight };\r\n\r\n\t\t\tthis.updateScaleRatio();\r\n\r\n\t\t\tlet seriesContainer: Container = this.seriesContainer;\r\n\r\n\t\t\tseriesContainer.x = chartContainer.pixelWidth / 2;\r\n\t\t\tseriesContainer.y = chartContainer.pixelHeight / 2;\r\n\r\n\t\t\tif (projectionScaleChanged || pWest != this.west || pEast != this.east || pNorth != this.north || pSouth != this.south) {\r\n\t\t\t\t$iter.each(this.series.iterator(), (series) => {\r\n\t\t\t\t\tseries.invalidate();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * (Re)calculates a ratio which should be used to scale the actual map so\r\n\t * that it fits perfectly into available space. Helps to avoid redrawing of all the map if container size changes\r\n\t * @ignore\r\n\t */\r\n\tprotected updateScaleRatio(): void {\r\n\t\tlet scaleRatio: number;\r\n\r\n\t\tlet vScale: number = this.chartContainer.innerWidth / this.seriesWidth;\r\n\t\tlet hScale: number = this.chartContainer.innerHeight / this.seriesHeight;\r\n\r\n\t\tif (vScale > hScale) {\r\n\t\t\tscaleRatio = hScale;\r\n\t\t} else {\r\n\t\t\tscaleRatio = vScale;\r\n\t\t}\r\n\r\n\t\tif ($type.isNaN(scaleRatio) || scaleRatio == Infinity) {\r\n\t\t\tscaleRatio = 1;\r\n\t\t}\r\n\r\n\t\tif (scaleRatio != this.scaleRatio) {\r\n\t\t\tthis.scaleRatio = scaleRatio;\r\n\r\n\t\t\t$iter.each(this.series.iterator(), (series) => {\r\n\t\t\t\tseries.scale = scaleRatio;\r\n\t\t\t\tseries.updateTooltipBounds();\r\n\t\t\t});\r\n\r\n\t\t\tthis.dispatch(\"scaleratiochanged\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Converts a point within map container to geographical (lat/long)\r\n\t * coordinates.\r\n\t *\r\n\t * @param point  Source point\r\n\t * @return Geo-point\r\n\t */\r\n\tpublic svgPointToGeo(point: IPoint): IGeoPoint {\r\n\t\tlet series: MapSeries = <MapSeries>this.series.getIndex(0);\r\n\t\tif (series) {\r\n\t\t\tlet seriesPoint: IPoint = $utils.svgPointToSprite(point, series);\r\n\t\t\treturn this.seriesPointToGeo(seriesPoint);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Converts geographical (lat/long) coordinates to an X/Y point within map's\r\n\t * container.\r\n\t *\r\n\t * @param point  Source geo-point\r\n\t * @return Point\r\n\t */\r\n\tpublic geoPointToSVG(point: IGeoPoint): IPoint {\r\n\t\tlet series: MapSeries = <MapSeries>this.series.getIndex(0);\r\n\t\tif (series) {\r\n\t\t\tlet seriesPoint: IPoint = this.geoPointToSeries(point);\r\n\t\t\treturn $utils.spritePointToSvg(seriesPoint, series);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Converts a point (X/Y) within actual objects of the map to geographical\r\n\t * (lat/long) coordinates.\r\n\t *\r\n\t * @param point  Source point\r\n\t * @return Geo-point\r\n\t */\r\n\tpublic seriesPointToGeo(point: IPoint): IGeoPoint {\r\n\t\treturn this.projection.invert(point);\r\n\t}\r\n\r\n\t/**\r\n\t * Converts geographical (lat/long) coordinates to an X/Y point within\r\n\t * actual elements/objects of the maps.\r\n\t *\r\n\t * @param point  Source geo-point\r\n\t * @return Point\r\n\t */\r\n\tpublic geoPointToSeries(point: IGeoPoint): IPoint {\r\n\t\treturn this.projection.convert(point);\r\n\t}\r\n\r\n\t/**\r\n\t * Map data in GeoJSON format.\r\n\t *\r\n\t * The Map supports the following GeoJSON objects: `Point`, `LineString`,\r\n\t * `Polygon`, `MultiPoint`, `MultiLineString`, and `MultiPolygon`.\r\n\t *\r\n\t * @see {@link http://geojson.org/} Official GeoJSON format specification\r\n\t * @param geoJSON GeoJSON data\r\n\t */\r\n\tpublic set geodata(geodata: Object) {\r\n\t\tif (geodata != this._geodata) {\r\n\t\t\tthis._geodata = geodata;\r\n\t\t\tthis.invalidateData();\r\n\r\n\t\t\t$iter.each(this._dataUsers.iterator(), (x) => {\r\n\t\t\t\tx.invalidateData();\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return GeoJSON data\r\n\t */\r\n\tpublic get geodata(): Object {\r\n\t\treturn this._geodata;\r\n\t}\r\n\r\n\t/**\r\n\t * Zooms the map to particular zoom level and centers on a latitude/longitude\r\n\t * coordinate.\r\n\t *\r\n\t * @param point      Center coordinate\r\n\t * @param zoomLevel  Zoom level\r\n\t * @param center     Center on the given coordinate?\r\n\t * @param duration   Duration for zoom animation (ms)\r\n\t * @return Zoom animation\r\n\t */\r\n\tpublic zoomToGeoPoint(point: IGeoPoint, zoomLevel: number, center?: boolean, duration?: number): Animation {\r\n\r\n\t\tif (!point) {\r\n\t\t\tpoint = this.zoomGeoPoint;\r\n\t\t}\r\n\r\n\t\tif (!point) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._zoomGeoPointReal = point;\r\n\r\n\t\tzoomLevel = $math.fitToRange(zoomLevel, this.minZoomLevel, this.maxZoomLevel);\r\n\r\n\t\tlet seriesPoint: IPoint = this.projection.convert(point);\r\n\r\n\t\tlet svgPoint: IPoint = this.geoPointToSVG(point);\r\n\t\tlet mapPoint = $utils.svgPointToSprite(svgPoint, this);\r\n\r\n\t\tif (center) {\r\n\t\t\tmapPoint = {\r\n\t\t\t\tx: this.maxWidth / 2,\r\n\t\t\t\ty: this.maxHeight / 2\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (!$type.isNumber(duration)) {\r\n\t\t\tduration = this.zoomDuration;\r\n\t\t}\r\n\r\n\t\tthis._mapAnimation = this.seriesContainer.animate(\r\n\t\t\t[{\r\n\t\t\t\tproperty: \"scale\",\r\n\t\t\t\tto: zoomLevel\r\n\t\t\t}, {\r\n\t\t\t\tproperty: \"x\",\r\n\t\t\t\tto: mapPoint.x - seriesPoint.x * zoomLevel * this.scaleRatio - this.pixelPaddingLeft\r\n\t\t\t}, {\r\n\t\t\t\tproperty: \"y\",\r\n\t\t\t\tto: mapPoint.y - seriesPoint.y * zoomLevel * this.scaleRatio - this.pixelPaddingTop\r\n\t\t\t}], duration, this.zoomEasing);\r\n\r\n\t\tthis._disposers.push(this._mapAnimation.events.on(\"animationended\", () => {\r\n\t\t\tthis._zoomGeoPointReal = this.zoomGeoPoint;\r\n\t\t}))\r\n\r\n\t\tthis.seriesContainer.validatePosition();\r\n\r\n\t\treturn this._mapAnimation;\r\n\t}\r\n\r\n\t/**\r\n\t * Zooms the map to a particular map object.\r\n\t *\r\n\t * @param mapObject  Target map object\r\n\t * @param zoomLevel  Zoom level\r\n\t * @param center     Center on the given coordinate?\r\n\t * @param duration   Duration for zoom animation (ms)\r\n\t * @return Zoom animation\r\n\t */\r\n\tpublic zoomToMapObject(mapObject: MapObject, zoomLevel?: number, center?: boolean, duration?: number): Animation {\r\n\r\n\t\tif (center == undefined) {\r\n\t\t\tcenter = true;\r\n\t\t}\r\n\r\n\t\tif (mapObject instanceof MapImage) {\r\n\t\t\tif ($type.isNaN(zoomLevel)) {\r\n\t\t\t\tzoomLevel = 5;\r\n\t\t\t}\r\n\t\t\treturn this.zoomToGeoPoint({ latitude: mapObject.latitude, longitude: mapObject.longitude }, zoomLevel, center, duration);\r\n\t\t}\r\n\r\n\t\tlet dataItem = mapObject.dataItem;\r\n\r\n\t\tif (dataItem && $type.isNumber(dataItem.zoomLevel)) {\r\n\t\t\tzoomLevel = dataItem.zoomLevel;\r\n\t\t}\r\n\r\n\t\tif (mapObject instanceof MapPolygon) {\r\n\t\t\tlet dataItem = mapObject.dataItem;\r\n\t\t\tlet bbox = mapObject.polygon.bbox;\r\n\r\n\t\t\tif (!$type.isNumber(zoomLevel)) {\r\n\t\t\t\tzoomLevel = Math.min(this.seriesWidth / bbox.width, this.seriesHeight / bbox.height);\r\n\t\t\t}\r\n\r\n\t\t\tlet geoPoint: IGeoPoint;\r\n\r\n\t\t\tif (dataItem && $type.hasValue(dataItem.zoomGeoPoint)) {\r\n\t\t\t\tgeoPoint = dataItem.zoomGeoPoint;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// this is more accurate\r\n\t\t\t\tlet polygonPoint = { x: bbox.x + bbox.width / 2, y: bbox.y + bbox.height / 2 };\r\n\t\t\t\tlet seriesPoint = $utils.spritePointToSprite(polygonPoint, mapObject.polygon, mapObject.series);\r\n\r\n\t\t\t\tgeoPoint = this.seriesPointToGeo(seriesPoint);\r\n\t\t\t}\r\n\t\t\treturn this.zoomToGeoPoint(geoPoint, zoomLevel, true, duration);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Zooms the map to a particular viewport.\r\n\t *\r\n\t * The `north`, `east`, `south`, and `west` define boundaries of the\r\n\t * imaginary viewort we want to zoom the map to.\r\n\t *\r\n\t * `level` is not actual zoom level. The map will determine the zoom level\r\n\t * required to accommodated such zoom, and will adjust it by `level` if set.\r\n\t *\r\n\t * @param north     Latitude of the North-most boundary\r\n\t * @param east      Longitude of the East-most boundary\r\n\t * @param south     Latitude of the South-most boundary\r\n\t * @param west      Longitude of the West-most boundary\r\n\t * @param level     Adjust zoom level\r\n\t * @param center    Center on the given coordinate?\r\n\t * @param duration  Duration for zoom animation (ms)\r\n\t * @return Zoom animation\r\n\t */\r\n\tpublic zoomToRectangle(north: number, east: number, south: number, west: number, level?: number, center?: boolean, duration?: number): Animation {\r\n\t\tif ($type.isNaN(level)) {\r\n\t\t\tlevel = 1;\r\n\t\t}\r\n\t\tlet zoomLevel = level * Math.min((this.south - this.north) / (south - north), (this.west - this.east) / (west - east));\r\n\r\n\t\treturn this.zoomToGeoPoint({ latitude: north + (south - north) / 2, longitude: west + (east - west) / 2 }, zoomLevel, center, duration);\r\n\t}\r\n\r\n\t/**\r\n\t * Zooms in the map, optionally centering on particular latitude/longitude\r\n\t * point.\r\n\t *\r\n\t * @param geoPoint  Optional center point\r\n\t * @param duration  Duration for zoom animation (ms)\r\n\t * @return Zoom animation\r\n\t */\r\n\tpublic zoomIn(geoPoint?: IGeoPoint, duration?: number): Animation {\r\n\t\treturn this.zoomToGeoPoint(geoPoint, this.zoomLevel * this.zoomStep, false, duration);\r\n\t}\r\n\r\n\t/**\r\n\t * Zooms out the map, optionally centering on particular latitude/longitude\r\n\t * point.\r\n\t *\r\n\t * @param geoPoint  Optional center point\r\n\t * @param duration  Duration for zoom animation (ms)\r\n\t * @return Zoom animation\r\n\t */\r\n\tpublic zoomOut(geoPoint?: IGeoPoint, duration?: number): Animation {\r\n\t\treturn this.zoomToGeoPoint(geoPoint, this.zoomLevel / this.zoomStep, false, duration);\r\n\t}\r\n\r\n\t/**\r\n\t * Pans the maps using relative coordinates. E.g.:\r\n\t *\r\n\t * ```JSON\r\n\t * {\r\n\t *   x: 0.1,\r\n\t *   y: -0.1\r\n\t * }\r\n\t * ```\r\n\t *\r\n\t * The above will move the map by 10% to the right, and by 10% upwards.\r\n\t *\r\n\t * @param shift     Vertical and horizontal shift\r\n\t * @param duration  Pan animation duration (ms)\r\n\t */\r\n\tpublic pan(shift: IPoint, duration?: number): void {\r\n\t\tlet point = this.geoPointToSVG(this.zoomGeoPoint);\r\n\t\tpoint.x += this.pixelWidth * shift.x;\r\n\t\tpoint.y += this.pixelHeight * shift.y;\r\n\t\tthis.zoomToGeoPoint(this.svgPointToGeo(point), this.zoomLevel, true, duration);\r\n\t}\r\n\r\n\t/**\r\n\t * Current lat/long coordinates for the center of the viewport. (default\r\n\t * zoom reference point)\r\n\t *\r\n\t * @readonly\r\n\t * @return Coordinates\r\n\t */\r\n\tpublic get zoomGeoPoint(): IGeoPoint {\r\n\t\tvar point = $utils.spritePointToSvg({ x: this.pixelWidth / 2, y: this.pixelHeight / 2 }, this);\r\n\t\treturn this.svgPointToGeo(point);\r\n\t}\r\n\r\n\t/**\r\n\t * Current zoom level.\r\n\t *\r\n\t * @readonly\r\n\t * @return Zoom level\r\n\t */\r\n\tpublic get zoomLevel(): number {\r\n\t\treturn this.seriesContainer.scale;\r\n\t}\r\n\r\n\tpublic set zoomLevel(value: number) {\r\n\t\tthis.seriesContainer.scale = value;\r\n\t}\r\n\r\n\t/**\r\n\t * Dispatches events after some map transformation, like pan or zoom.\r\n\t */\r\n\tprotected handleMapTransform(): void {\r\n\t\tif (this.zoomLevel != this._prevZoomLevel) {\r\n\t\t\tthis.dispatch(\"zoomlevelchanged\");\r\n\t\t\tthis._prevZoomLevel = this.zoomLevel;\r\n\t\t}\r\n\r\n\t\tif (this.zoomGeoPoint && (this._prevZoomGeoPoint.latitude != this.zoomGeoPoint.latitude || this._prevZoomGeoPoint.longitude != this.zoomGeoPoint.longitude)) {\r\n\t\t\tthis.dispatch(\"mappositionchanged\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * A [[SmallMap]] to be used on the map.\r\n\t *\r\n\t * Please note, that accessing this property will NOT create a small map\r\n\t * if it has not yet been created. (except in JSON)\r\n\t *\r\n\t * ```TypeScript\r\n\t * // Create a small map\r\n\t * map.smallMap = new am4maps.SmallMap();\r\n\t * ```\r\n\t * ```JavaScript\r\n\t * // Create a small map\r\n\t * map.smallMap = new am4maps.SmallMap();\r\n\t * ```\r\n\t * ```JSON\r\n\t * {\r\n\t *   // ...\r\n\t *   \"smallMap\": {}\r\n\t *   // ...\r\n\t * }\r\n\t * ```\r\n\t *\r\n\t * @param smallMap  Small map\r\n\t */\r\n\tpublic set smallMap(smallMap: SmallMap) {\r\n\t\tif (this._smallMap) {\r\n\t\t\tthis.removeDispose(this._smallMap);\r\n\t\t}\r\n\t\tthis._smallMap = smallMap;\r\n\t\tthis._smallMap.chart = this;\r\n\t\tsmallMap.parent = this.chartContainer;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Small map\r\n\t */\r\n\tpublic get smallMap(): SmallMap {\r\n\t\tif (!this._smallMap) {\r\n\t\t\tlet smallMap: SmallMap = new SmallMap();\r\n\t\t\tthis.smallMap = smallMap;\r\n\t\t}\r\n\t\treturn this._smallMap;\r\n\t}\r\n\r\n\t/**\r\n\t * A [[ZoomControl]] to be used on the map.\r\n\t *\r\n\t * Please note, that accessing this property will NOT create a zoom control\r\n\t * if it has not yet been created. (except in JSON)\r\n\t *\r\n\t * ```TypeScript\r\n\t * // Create a zoom control\r\n\t * map.zoomControl = new am4maps.ZoomControl();\r\n\t * ```\r\n\t * ```JavaScript\r\n\t * // Create a zoom control\r\n\t * map.zoomControl = new am4maps.ZoomControl();\r\n\t * ```\r\n\t * ```JSON\r\n\t * {\r\n\t *   // ...\r\n\t *   \"zoomControl\": {}\r\n\t *   // ...\r\n\t * }\r\n\t * ```\r\n\t *\r\n\t * @param zoomControl  Zoom control\r\n\t */\r\n\tpublic set zoomControl(zoomControl: ZoomControl) {\r\n\t\tif (this._zoomControl) {\r\n\t\t\tthis.removeDispose(this._zoomControl);\r\n\t\t}\r\n\t\tthis._zoomControl = zoomControl;\r\n\t\tzoomControl.chart = this;\r\n\t\tzoomControl.parent = this.chartContainer;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Zoom control\r\n\t */\r\n\tpublic get zoomControl(): ZoomControl {\r\n\t\treturn this._zoomControl;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates and returns a map series of appropriate type.\r\n\t *\r\n\t * @return Map series\r\n\t */\r\n\tprotected createSeries(): this[\"_seriesType\"] {\r\n\t\treturn new MapSeries();\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Degrees to shift map center by.\r\n\t *\r\n\t * E.g. if set to -160, the longitude 20 will become a new center, creating\r\n\t * a Pacific-centered map.\r\n\t *\r\n\t * @param value  Map center shift\r\n\t */\r\n\tpublic set deltaLongitude(value: number) {\r\n\t\tif (this.setPropertyValue(\"deltaLongitude\", $geo.wrapAngleTo180(value))) {\r\n\t\t\tthis.invalidateProjection();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Map center shift\r\n\t */\r\n\tpublic get deltaLongitude(): number {\r\n\t\treturn this.getPropertyValue(\"deltaLongitude\");\r\n\t}\r\n\r\n\t/**\r\n\t * Maximum portion of the map's width/height to allow panning \"off screen\".\r\n\t *\r\n\t * A value of 0 (zero) will prevent any portion of the the map to be panned\r\n\t * outside the viewport.\r\n\t *\r\n\t * 0.5 will allow half of the map to be outside viewable area.\r\n\t *\r\n\t * @default 0.7\r\n\t * @param value  Max pan out\r\n\t */\r\n\tpublic set maxPanOut(value: number) {\r\n\t\tthis.setPropertyValue(\"maxPanOut\", value);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Max pan out\r\n\t */\r\n\tpublic get maxPanOut(): number {\r\n\t\treturn this.getPropertyValue(\"maxPanOut\");\r\n\t}\r\n\r\n\t/**\r\n\t * The geographical point to center map on when it is first loaded.\r\n\t *\r\n\t * The map will also be centered to this point when you call `goHome()`\r\n\t * method.\r\n\t *\r\n\t * @param value  Home geo point\r\n\t */\r\n\tpublic set homeGeoPoint(value: IGeoPoint) {\r\n\t\tthis.setPropertyValue(\"homeGeoPoint\", value);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Home geo point\r\n\t */\r\n\tpublic get homeGeoPoint(): IGeoPoint {\r\n\t\treturn this.getPropertyValue(\"homeGeoPoint\");\r\n\t}\r\n\r\n\t/**\r\n\t * The zoom level to put the map in when it is first loaded.\r\n\t *\r\n\t * The map will also be set to this zoom level when you call `goHome()`\r\n\t * method.\r\n\t *\r\n\t * @param value  Home zoom level\r\n\t */\r\n\tpublic set homeZoomLevel(value: number) {\r\n\t\tthis.setPropertyValue(\"homeZoomLevel\", value);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Home zoom level\r\n\t */\r\n\tpublic get homeZoomLevel(): number {\r\n\t\treturn this.getPropertyValue(\"homeZoomLevel\");\r\n\t}\r\n\r\n\t/**\r\n\t * When user zooms in or out current zoom level is multiplied or divided\r\n\t * by value of this setting.\r\n\t *\r\n\t * @default 2\r\n\t * @param value  Zoom factor\r\n\t */\r\n\tpublic set zoomStep(value: number) {\r\n\t\tthis.setPropertyValue(\"zoomStep\", value);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Zoom factor\r\n\t */\r\n\tpublic get zoomStep(): number {\r\n\t\treturn this.getPropertyValue(\"zoomStep\");\r\n\t}\r\n\r\n\t/**\r\n\t * Invalidates projection, causing all series to be redrawn.\r\n\t */\r\n\tprotected invalidateProjection() {\r\n\t\tthis.updateExtremes();\r\n\t\t//\t\tthis.projection.deltaLatitude = this.deltaLatitude;\r\n\t\tthis.projection.deltaLongitude = this.deltaLongitude;\r\n\r\n\t\t$iter.each(this.series.iterator(), (series) => {\r\n\t\t\tseries.invalidate();\r\n\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a [[DataSource]] to be used for loading Component's data.\r\n\t *\r\n\t * @param value Data source\r\n\t */\r\n\tpublic set geodataSource(value: DataSource) {\r\n\t\tif (this._dataSources[\"geodata\"]) {\r\n\t\t\tthis.removeDispose(this._dataSources[\"geodata\"]);\r\n\t\t}\r\n\t\tthis._dataSources[\"geodata\"] = value;\r\n\t\tthis._dataSources[\"geodata\"].component = this;\r\n\t\tthis.events.on(\"inited\", () => {\r\n\t\t\tthis.loadData(\"geodata\")\r\n\t\t}, this, false);\r\n\t\tthis.setDataSourceEvents(value, \"geodata\");\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a [[DataSource]] specifically for loading Component's data.\r\n\t *\r\n\t * @return Data source\r\n\t */\r\n\tpublic get geodataSource(): DataSource {\r\n\t\tif (!this._dataSources[\"geodata\"]) {\r\n\t\t\tthis.getDataSource(\"geodata\");\r\n\t\t}\r\n\t\treturn this._dataSources[\"geodata\"];\r\n\t}\r\n\r\n\t/**\r\n\t * Processes JSON-based config before it is applied to the object.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param config  Config\r\n\t */\r\n\tpublic processConfig(config?: { [index: string]: any }): void {\r\n\r\n\t\t// Instantiate projection\r\n\t\tif ($type.hasValue(config[\"projection\"]) && $type.isString(config[\"projection\"])) {\r\n\t\t\tconfig[\"projection\"] = this.createClassInstance(config[\"projection\"]);\r\n\t\t}\r\n\r\n\t\t// Set up small map\r\n\t\tif ($type.hasValue(config.smallMap) && !$type.hasValue(config.smallMap.type)) {\r\n\t\t\tconfig.smallMap.type = \"SmallMap\";\r\n\t\t}\r\n\r\n\t\t// Set up zoom control\r\n\t\tif ($type.hasValue(config.zoomControl) && !$type.hasValue(config.zoomControl.type)) {\r\n\t\t\tconfig.zoomControl.type = \"ZoomControl\";\r\n\t\t}\r\n\r\n\t\tsuper.processConfig(config);\r\n\r\n\t}\r\n\r\n\t/**\r\n * This function is used to sort element's JSON config properties, so that\r\n * some properties that absolutely need to be processed last, can be put at\r\n * the end.\r\n *\r\n * @ignore Exclude from docs\r\n * @param a  Element 1\r\n * @param b  Element 2\r\n * @return Sorting number\r\n */\r\n\tprotected configOrder(a: string, b: string): Ordering {\r\n\t\tif (a == b) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t\t// Must come last\r\n\t\telse if (a == \"smallMap\") {\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t\telse if (b == \"smallMap\") {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\telse if (a == \"series\") {\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t\telse if (b == \"series\") {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn super.configOrder(a, b);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Adds `projection` to \"as is\" fields.\r\n\t *\r\n\t * @param field  Field name\r\n\t * @return Assign as is?\r\n\t */\r\n\tprotected asIs(field: string): boolean {\r\n\t\treturn field == \"projection\" || super.asIs(field);\r\n\t}\r\n\r\n\t/**\r\n\t * Geo point of map center\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tpublic get centerGeoPoint(): IGeoPoint {\r\n\t\treturn this._centerGeoPoint;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Resets the map to its original position and zoom level.\r\n\t */\r\n\tpublic goHome(duration?: number) {\r\n\t\tlet homeGeoPoint = this.homeGeoPoint;\r\n\t\tif (!homeGeoPoint) {\r\n\t\t\thomeGeoPoint = this.centerGeoPoint;\r\n\t\t}\r\n\t\tif (homeGeoPoint) {\r\n\t\t\tthis.zoomToGeoPoint(homeGeoPoint, this.homeZoomLevel, true, duration);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Sets [[Paper]] instance to use to draw elements.\r\n\t * @ignore\r\n\t * @param paper Paper\r\n\t * @return true if paper was changed, false, if it's the same\r\n\t */\r\n\tpublic setPaper(paper: Paper): boolean {\r\n\t\tif (this.svgContainer) {\r\n\t\t\tthis.svgContainer.hideOverflow = true;\r\n\t\t}\r\n\r\n\t\treturn super.setPaper(paper);\r\n\t}\r\n\r\n\t/**\r\n\t * Prepares the legend instance for use in this chart.\r\n\t *\r\n\t * @param legend  Legend\r\n\t */\r\n\tprotected setLegend(legend: Legend) {\r\n\t\tsuper.setLegend(legend);\r\n\t\tif (legend) {\r\n\t\t\tlegend.parent = this.chartContainer;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"MapChart\"] = MapChart;\r\n\n\n\n// WEBPACK FOOTER //\n// ../../../../../src/.internal/charts/types/MapChart.ts","/**\r\n * Map line module\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Container, IContainerProperties, IContainerAdapters, IContainerEvents } from \"../../core/Container\";\r\nimport { SpriteEventDispatcher, AMEvent } from \"../../core/Sprite\";\r\nimport { MapLine } from \"./MapLine\";\r\nimport { IOrientationPoint } from \"../../core/defs/IPoint\";\r\nimport { registry } from \"../../core/Registry\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines properties for [[MapLineObject]].\r\n */\r\nexport interface IMapLineObjectProperties extends IContainerProperties {\r\n\r\n\t/**\r\n\t * Sets object's relative position (0-1) within the line.\r\n\t *\r\n\t * `0` will place the object at the beginning of the line. `1` - at the end.\r\n\t *\r\n\t * Any intermediate number will place the object at some point within the\r\n\t * line.\r\n\t */\r\n\tposition?: number;\r\n\r\n\t/**\r\n\t * If set to `true`, the object will be automatically rotated to face the\r\n\t * direction of the line at the specific position.\r\n\t *\r\n\t * This allows creating images that has its \"front\" always facing the logical\r\n\t * direction of the line.\r\n\t *\r\n\t * @default false\r\n\t */\r\n\tadjustRotation?: boolean;\r\n\r\n}\r\n\r\n/**\r\n * Defines events for [[MapLineObject]].\r\n */\r\nexport interface IMapLineObjectEvents extends IContainerEvents { }\r\n\r\n/**\r\n * Defines adapters for [[MapLineObject]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface IMapLineObjectAdapters extends IContainerAdapters, IMapLineObjectProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Draws a line on the map.\r\n *\r\n * @see {@link IMapLineObjectEvents} for a list of available events\r\n * @see {@link IMapLineObjectAdapters} for a list of available Adapters\r\n */\r\nexport class MapLineObject extends Container {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IMapLineObjectProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IMapLineObjectAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IMapLineObjectEvents;\r\n\r\n\t/**\r\n\t * A reference to the [[MapLine]] object this object is attached to.\r\n\t *\r\n\t * @todo Review if necessary (same as parent)\r\n\t */\r\n\tpublic mapLine: MapLine;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.adjustRotation = true;\r\n\t\tthis.className = \"MapLineObject\";\r\n\t\tthis.isMeasured = false;\r\n\t\tthis.layout = \"none\";\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * (Re)validates element's position.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validatePosition() {\r\n\t\tif (this.mapLine) {\r\n\t\t\tlet point: IOrientationPoint = this.mapLine.positionToPoint(this.position);\r\n\t\t\tthis.x = point.x;\r\n\t\t\tthis.y = point.y;\r\n\r\n\t\t\tif (this.adjustRotation) {\r\n\t\t\t\tthis.rotation = point.angle;\r\n\t\t\t}\r\n\r\n\t\t\tlet dataItem = this.mapLine.dataItem;\r\n\t\t\tif (dataItem) {\r\n\t\t\t\tlet series = this.mapLine.dataItem.component;\r\n\t\t\t\tthis.scale = 1 / series.scale;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsuper.validatePosition();\r\n\t}\r\n\r\n\t/**\r\n\t * Sets object's relative position (0-1) within the line.\r\n\t *\r\n\t * `0` will place the object at the beginning of the line. `1` - at the end.\r\n\t *\r\n\t * Any intermediate number will place the object at some point within the\r\n\t * line.\r\n\t *\r\n\t * @param value  Position within the line (0-1)\r\n\t */\r\n\tpublic set position(value: number) {\r\n\t\tthis.setPropertyValue(\"position\", value, false, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Position within the line\r\n\t */\r\n\tpublic get position(): number {\r\n\t\treturn this.getPropertyValue(\"position\");\r\n\t}\r\n\r\n\t/**\r\n\t * If set to `true`, the object will be automatically rotated to face the\r\n\t * direction of the line at the specific position.\r\n\t *\r\n\t * This allows creating images that has its \"front\" always facing the logical\r\n\t * direction of the line.\r\n\t *\r\n\t * @default false\r\n\t * @param value  Auto-rotate\r\n\t */\r\n\tpublic set adjustRotation(value: boolean) {\r\n\t\tthis.setPropertyValue(\"adjustRotation\", value, false, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Auto-rotate\r\n\t */\r\n\tpublic get adjustRotation(): boolean {\r\n\t\treturn this.getPropertyValue(\"adjustRotation\");\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"MapLineObject\"] = MapLineObject;\r\n\n\n\n// WEBPACK FOOTER //\n// ../../../../../src/.internal/charts/map/MapLineObject.ts","/**\r\n * Map line module\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { MapObject, IMapObjectProperties, IMapObjectAdapters, IMapObjectEvents } from \"./MapObject\";\r\nimport { SpriteEventDispatcher, AMEvent } from \"../../core/Sprite\";\r\nimport { MapLineObject } from \"./MapLineObject\";\r\nimport { MapLineSeriesDataItem, MapLineSeries } from \"./MapLineSeries\";\r\nimport { MapChart } from \"../types/MapChart\";\r\nimport { MapImage } from \"./MapImage\";\r\nimport { IOrientationPoint } from \"../../core/defs/IPoint\";\r\nimport { IGeoPoint } from \"../../core/defs/IGeoPoint\";\r\nimport { Triangle } from \"../../core/elements/Triangle\";\r\nimport { ListTemplate, IListEvents, ListDisposer } from \"../../core/utils/List\";\r\nimport { Polyline } from \"../../core/elements/Polyline\";\r\nimport { registry } from \"../../core/Registry\";\r\nimport { color } from \"../../core/utils/Color\";\r\nimport { InterfaceColorSet } from \"../../core/utils/InterfaceColorSet\";\r\nimport { percent } from \"../../core/utils/Percent\";\r\nimport * as $type from \"../../core/utils/Type\";\r\nimport * as $iter from \"../../core/utils/Iterator\";\r\nimport * as $geo from \"./Geo\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines properties for [[MapLine]].\r\n */\r\nexport interface IMapLineProperties extends IMapObjectProperties {\r\n\r\n\t/**\r\n\t * Lat/long coordinates of all line ends and intermediate elbows.\r\n\t */\r\n\tmultiGeoLine?: IGeoPoint[][];\r\n\r\n\t/**\r\n\t * If `true` it line will be arched in the way to simulate shortest path\r\n\t * over curvature of Earth's surface, based on currently used on projection.\r\n\t */\r\n\tshortestDistance?: boolean;\r\n\r\n\t/**\r\n\t * Instead of setting longitudes/latitudes you can set an array of images which will be connected by the line\r\n\t */\r\n\timagesToConnect?: MapImage[];\r\n}\r\n\r\n/**\r\n * Defines events for [[MapLine]].\r\n */\r\nexport interface IMapLineEvents extends IMapObjectEvents { }\r\n\r\n/**\r\n * Defines adapters for [[MapLine]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface IMapLineAdapters extends IMapObjectAdapters, IMapLineProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Used to draw a line on the map.\r\n *\r\n * @see {@link IMapLineEvents} for a list of available events\r\n * @see {@link IMapLineAdapters} for a list of available Adapters\r\n */\r\nexport class MapLine extends MapObject {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IMapLineProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IMapLineAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IMapLineEvents;\r\n\r\n\t/**\r\n\t * A line visual element.\r\n\t */\r\n\tpublic line: Polyline;\r\n\r\n\t/**\r\n\t * [_lineObjects description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprotected _lineObjects: ListTemplate<MapLineObject>;\r\n\r\n\t/**\r\n\t * [_arrow description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprotected _arrow: MapLineObject;\r\n\r\n\t/**\r\n\t * [_distance description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprotected _distance: number;\r\n\r\n\t/**\r\n\t * Related data item.\r\n\t */\r\n\tpublic _dataItem: MapLineSeriesDataItem;\r\n\r\n\t/**\r\n\t * A map series this object belongs to.\r\n\t */\r\n\tpublic series: MapLineSeries;\r\n\r\n\t/**\r\n\t * Instead of setting longitudes/latitudes you can set an array of images which will be connected by the line\r\n\t * @ignore\r\n\t */\r\n\tprotected _imagesToConnect: MapImage[];\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\r\n\t\t// Init\r\n\t\tsuper();\r\n\t\tthis.className = \"MapLine\";\r\n\r\n\t\tthis.createLine();\r\n\t\tthis.line.stroke = color();\r\n\t\tthis.line.parent = this;\r\n\t\tthis.strokeOpacity = 1;\r\n\r\n\r\n\t\tlet interfaceColors = new InterfaceColorSet();\r\n\r\n\t\tthis.stroke = interfaceColors.getFor(\"grid\");\r\n\t\tthis.shortestDistance = true;\r\n\r\n\t\t// Apply theme\r\n\t\tthis.applyTheme();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tprotected createLine(){\r\n\t\tthis.line = new Polyline();\r\n\t}\r\n\r\n\t/**\r\n\t * Converts a position within the line (0-1) to a physical point\r\n\t * coordinates.\r\n\t *\r\n\t * 0 indicates start of the line, 0.5 - middle, while 1 indicates the end.\r\n\t *\r\n\t * @param position  Position (0-1)\r\n\t * @return Coordinates\r\n\t */\r\n\tpublic positionToPoint(position: number): IOrientationPoint {\r\n\t\tif (this.line) {\r\n\t\t\treturn this.line.positionToPoint(position);\r\n\t\t}\r\n\t\treturn { x: 0, y: 0, angle: 0 };\r\n\t}\r\n\r\n\t/**\r\n\t * [multiGeoLine description]\r\n\t *\r\n\t * @todo Description\r\n\t * @param multiGeoLine [description]\r\n\t */\r\n\tpublic set multiGeoLine(multiGeoLine: IGeoPoint[][]) {\r\n\t\tthis.setPropertyValue(\"multiGeoLine\", $geo.normalizeMultiline(multiGeoLine), true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return [description]\r\n\t */\r\n\tpublic get multiGeoLine(): IGeoPoint[][] {\r\n\t\treturn this.getPropertyValue(\"multiGeoLine\");\r\n\t}\r\n\r\n\t/**\r\n\t * Instead of setting longitudes/latitudes you can set an array of images\r\n\t * which will be connected by the line.\r\n\t *\r\n\t * Parameter is an array that can hold string `id`'s to of the images, or\r\n\t * references to actual [[MapImage]] objects.\r\n\t *\r\n\t * @param images  Images\r\n\t */\r\n\tpublic set imagesToConnect(images: MapImage[] | string[]) {\r\n\t\t//@todo dispose listeners if previous imagesToConnect exists\r\n\t\tfor (let i = 0, len = images.length; i < len; i++) {\r\n\t\t\tlet image = images[i];\r\n\t\t\tif ($type.isString(image)) {\r\n\t\t\t\tif (this.map.hasKey(image)) {\r\n\t\t\t\t\timage = <MapImage>this.map.getKey(image);\r\n\t\t\t\t\timages[i] = image;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\timage.events.on(\"propertychanged\", (event) => {\r\n\t\t\t\tif (event.property == \"longitude\" || event.property == \"latitude\") {\r\n\t\t\t\t\tthis.invalidate();\r\n\t\t\t\t}\r\n\t\t\t}, this, false);\r\n\t\t}\r\n\t\tthis.setPropertyValue(\"imagesToConnect\", images);\r\n\t}\r\n\r\n\t/**\r\n\t * @return {MapImages[]}\r\n\t */\r\n\tpublic get imagesToConnect(): MapImage[] | string[] {\r\n\t\treturn this.getPropertyValue(\"imagesToConnect\");\r\n\t}\r\n\r\n\t/**\r\n\t * (Re)validates the line, effectively forcing it to redraw.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validate(): void {\r\n\t\tlet chart: MapChart = this.series.chart;\r\n\t\t//let multiPoints: IPoint[][] = [];\r\n\t\tlet multiGeoLine: IGeoPoint[][] = this.multiGeoLine || [];\r\n\r\n\t\tif (this.imagesToConnect) {\r\n\t\t\tlet segment: IGeoPoint[] = [];\r\n\t\t\tmultiGeoLine = [segment];\r\n\r\n\t\t\tfor (let image of this.imagesToConnect) {\r\n\t\t\t\tsegment.push({ longitude: (<MapImage>image).longitude, latitude: (<MapImage>image).latitude });\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.shortestDistance) {\r\n\t\t\tlet newMultiGeoLine: IGeoPoint[][] = [];\r\n\r\n\t\t\tfor (let i = 0, len = multiGeoLine.length; i < len; i++) {\r\n\t\t\t\tlet geoLine: IGeoPoint[] = multiGeoLine[i];\r\n\t\t\t\tlet newGeoLine: IGeoPoint[] = [];\r\n\r\n\t\t\t\tfor (let p = 1, plen = geoLine.length; p < plen; p++) {\r\n\t\t\t\t\tlet geoPointA: IGeoPoint = geoLine[p - 1];\r\n\t\t\t\t\tlet geoPointB: IGeoPoint = geoLine[p];\r\n\r\n\t\t\t\t\tlet stepCount: number = Math.max(Math.abs(geoPointA.latitude - geoPointB.latitude), Math.abs(geoPointA.longitude - geoPointB.longitude)) * 4;\r\n\t\t\t\t\t//let latitudeStep: number = (geoPointB.latitude - geoPointA.latitude) / stepCount;\r\n\t\t\t\t\t//let longitudeStep: number = (geoPointB.longitude - geoPointA.longitude) / stepCount;\r\n\r\n\t\t\t\t\tfor (let d = 0; d < stepCount; d++) {\r\n\t\t\t\t\t\tlet intermediatePoint = chart.projection.intermediatePoint(geoPointA, geoPointB, d / stepCount);\r\n\r\n\t\t\t\t\t\tif (newGeoLine.length > 0) {\r\n\t\t\t\t\t\t\tlet previousPoint = newGeoLine[newGeoLine.length - 1];\r\n\t\t\t\t\t\t\tif (Math.abs(previousPoint.longitude - intermediatePoint.longitude) > 359) {\r\n\t\t\t\t\t\t\t\tnewMultiGeoLine.push(newGeoLine);\r\n\t\t\t\t\t\t\t\tnewGeoLine = [];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tnewGeoLine.push(intermediatePoint);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// add last point to avoid gap\r\n\t\t\t\t\tnewGeoLine.push(geoPointB);\r\n\t\t\t\t}\r\n\t\t\t\tnewMultiGeoLine.push(newGeoLine);\r\n\t\t\t}\r\n\t\t\tmultiGeoLine = newMultiGeoLine;\r\n\t\t}\r\n\r\n\t\tthis.line.segments = chart.projection.projectGeoLine(multiGeoLine);\r\n\r\n\t\tif (this._arrow) {\r\n\t\t\tthis._arrow.validatePosition();\r\n\t\t}\r\n\r\n\t\t$iter.each(this.lineObjects.iterator(), (x) => {\r\n\t\t\tx.validatePosition();\r\n\t\t});\r\n\r\n\t\tthis.handleGlobalScale();\r\n\r\n\t\tsuper.validate();\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic measureElement(): void {\r\n\t\t// Overriding, just to avoid extra measure\r\n\t}\r\n\r\n\t/**\r\n\t * The line should take the shortest path over the globe.\r\n\t *\r\n\t * Enabling this will make the line look differently in different\r\n\t * projections. Only `MapLine` supports this setting, `MapArc` and\r\n\t * `MapSplice` don't.\r\n\t *\r\n\t * @default false\r\n\t * @param value  Real path?\r\n\t */\r\n\tpublic set shortestDistance(value: boolean) {\r\n\t\tthis.setPropertyValue(\"shortestDistance\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Real path?\r\n\t */\r\n\tpublic get shortestDistance(): boolean {\r\n\t\treturn this.getPropertyValue(\"shortestDistance\");\r\n\t}\r\n\r\n\t/**\r\n\t * List of separate line objects, the line consists of.\r\n\t *\r\n\t * @todo Description (review)\r\n\t * @readonly\r\n\t * @return List of line objects\r\n\t */\r\n\tpublic get lineObjects(): ListTemplate<MapLineObject> {\r\n\t\tif (!this._lineObjects) {\r\n\t\t\tthis._lineObjects = new ListTemplate<MapLineObject>(new MapLineObject());\r\n\t\t\tthis._lineObjects.events.on(\"inserted\", this.handleLineObjectAdded, this, false);\r\n\t\t\tthis._disposers.push(new ListDisposer(this._lineObjects));\r\n\t\t\tthis._disposers.push(this._lineObjects.template);\r\n\t\t}\r\n\r\n\t\treturn this._lineObjects;\r\n\t}\r\n\r\n\t/**\r\n\t * Decorate a [[LineObject]] when it is added to the line.\r\n\t *\r\n\t * @param event  Event\r\n\t */\r\n\tprotected handleLineObjectAdded(event: IListEvents<MapLineObject>[\"inserted\"]) {\r\n\t\tlet mapLineObject: MapLineObject = event.newValue;\r\n\t\tmapLineObject.mapLine = this;\r\n\t\tmapLineObject.shouldClone = false;\r\n\t\tmapLineObject.parent = this;\r\n\t}\r\n\r\n\t/**\r\n\t * A [[MapLineObject]] to use as an option arrowhead on the line.\r\n\t *\r\n\t * Just accessing this property will create a default arrowhead on the line\r\n\t * automatically.\r\n\t *\r\n\t * @param arrow  Arrow element\r\n\t */\r\n\tpublic set arrow(arrow: MapLineObject) {\r\n\t\tthis._arrow = arrow;\r\n\t\tarrow.mapLine = this;\r\n\t\tarrow.parent = this;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Arrow element\r\n\t */\r\n\tpublic get arrow(): MapLineObject {\r\n\t\tif (!this._arrow) {\r\n\t\t\tlet arrow: MapLineObject = this.createChild(MapLineObject);\r\n\t\t\tarrow.shouldClone = false;\r\n\t\t\tarrow.width = 8;\r\n\t\t\tarrow.height = 10;\r\n\t\t\tarrow.mapLine = this;\r\n\t\t\tarrow.position = 0.5;\r\n\r\n\t\t\tlet triangle = arrow.createChild(Triangle);\r\n\t\t\t//triangle.shouldClone = false;\r\n\t\t\ttriangle.fillOpacity = 1;\r\n\t\t\ttriangle.width = percent(100);\r\n\t\t\ttriangle.height = percent(100);\r\n\t\t\ttriangle.rotation = 90;\r\n\t\t\ttriangle.horizontalCenter = \"middle\";\r\n\t\t\ttriangle.verticalCenter = \"middle\";\r\n\t\t\tthis._arrow = arrow;\r\n\t\t}\r\n\t\treturn this._arrow;\r\n\t}\r\n\r\n\t/**\r\n\t * Copies line properties and other attributes, like arrow, from another\r\n\t * instance of [[MapLine]].\r\n\t *\r\n\t * @param source  Source map line\r\n\t */\r\n\tpublic copyFrom(source: this): void {\r\n\t\tsuper.copyFrom(source);\r\n\t\tthis.line.copyFrom(source.line);\r\n\t\tthis.lineObjects.copyFrom(source.lineObjects);\r\n\t\tif (source._arrow) {\r\n\t\t\tthis.arrow = <MapLineObject>source.arrow.clone();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Latitude of the line center.\r\n\t *\r\n\t * @readonly\r\n\t * @return Latitude\r\n\t */\r\n\tpublic get latitude(): number {\r\n\t\tlet dataItem = this.dataItem;\r\n\t\treturn dataItem.north + (dataItem.south - dataItem.north) / 2;\r\n\t}\r\n\r\n\t/**\r\n\t * Longitude of the line center.\r\n\t *\r\n\t * @readonly\r\n\t * @return Latitude\r\n\t */\r\n\tpublic get longitude(): number {\r\n\t\tlet dataItem = this.dataItem;\r\n\t\treturn dataItem.east + (dataItem.west - dataItem.east) / 2;\r\n\t}\r\n\r\n\t/**\r\n\t * X coordinate for the slice tooltip.\r\n\t *\r\n\t * @return X\r\n\t */\r\n\tprotected getTooltipX(): number {\r\n\t\treturn this.line.positionToPoint(0.5).x;\r\n\t}\r\n\r\n\t/**\r\n\t * Y coordinate for the slice tooltip.\r\n\t *\r\n\t * @return Y\r\n\t */\r\n\tprotected getTooltipY(): number {\r\n\t\treturn this.line.positionToPoint(0.5).y;\r\n\t}\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"MapLine\"] = MapLine;\r\n\n\n\n// WEBPACK FOOTER //\n// ../../../../../src/.internal/charts/map/MapLine.ts","/**\r\n * Map spline module\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { MapLine, IMapLineProperties, IMapLineAdapters, IMapLineEvents } from \"./MapLine\";\r\nimport { SpriteEventDispatcher, AMEvent } from \"../../core/Sprite\";\r\nimport { Polyspline } from \"../../core/elements/Polyspline\";\r\nimport { MapSplineSeriesDataItem, MapSplineSeries } from \"./MapSplineSeries\";\r\nimport { registry } from \"../../core/Registry\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines properties for [[MapSpline]].\r\n */\r\nexport interface IMapSplineProperties extends IMapLineProperties { }\r\n\r\n/**\r\n * Defines events for [[MapSpline]].\r\n */\r\nexport interface IMapSplineEvents extends IMapLineEvents { }\r\n\r\n/**\r\n * Defines adapters for [[MapSpline]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface IMapSplineAdapters extends IMapLineAdapters, IMapSplineProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Used to draw a spline on the map.\r\n *\r\n * @see {@link IMapSplineEvents} for a list of available events\r\n * @see {@link IMapSplineAdapters} for a list of available Adapters\r\n */\r\nexport class MapSpline extends MapLine {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IMapSplineProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IMapSplineAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IMapSplineEvents;\r\n\r\n\t/**\r\n\t * A visual element for the spline.\r\n\t */\r\n\tpublic line: Polyspline;\r\n\r\n\t/**\r\n\t * A related data item.\r\n\t */\r\n\tpublic _dataItem: MapSplineSeriesDataItem;\r\n\r\n\t/**\r\n\t * A map series this object belongs to.\r\n\t */\r\n\tpublic series: MapSplineSeries;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\r\n\t\t// Init\r\n\t\tsuper();\r\n\t\tthis.className = \"MapSpline\";\r\n\r\n\t\t// Apply theme\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tprotected createLine(){\r\n\t\tthis.line = new Polyspline();\r\n\t\tthis.line.tensionX = 0.8;\r\n\t\tthis.line.tensionY = 0.8;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ShortestDistance = true is not supported by MapSpline, only MapLine does support it\r\n\t * @default false\r\n\t * @param value\r\n\t * @todo: review description\r\n\t */\r\n\tpublic get shortestDistance(): boolean {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tpublic set shortestDistance(value: boolean) {\r\n\r\n\t}\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"MapSpline\"] = MapSpline;\r\n\n\n\n// WEBPACK FOOTER //\n// ../../../../../src/.internal/charts/map/MapSpline.ts","/**\r\n * Map arched line module\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { MapLine, IMapLineProperties, IMapLineAdapters, IMapLineEvents } from \"./MapLine\";\r\nimport { SpriteEventDispatcher, AMEvent } from \"../../core/Sprite\";\r\nimport { Polyarc } from \"../../core/elements/Polyarc\";\r\nimport { registry } from \"../../core/Registry\";\r\nimport { MapArcSeries } from \"./MapArcSeries\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines properties for [[MapArc]].\r\n */\r\nexport interface IMapArcProperties extends IMapLineProperties { }\r\n\r\n/**\r\n * Defines events for [[MapArc]].\r\n */\r\nexport interface IMapArcEvents extends IMapLineEvents { }\r\n\r\n/**\r\n * Defines adapters for [[MapArc]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface IMapArcAdapters extends IMapLineAdapters, IMapArcProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Used to draw an arched line on the map.\r\n *\r\n * @see {@link IMapArcEvents} for a list of available events\r\n * @see {@link IMapArcAdapters} for a list of available Adapters\r\n */\r\nexport class MapArc extends MapLine {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IMapArcProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IMapArcAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IMapArcEvents;\r\n\r\n\t/**\r\n\t * A visual element.\r\n\t */\r\n\tpublic line: Polyarc;\r\n\r\n\t/**\r\n\t * A map series this object belongs to.\r\n\t */\r\n\tpublic series: MapArcSeries;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\r\n\t\t// Init\r\n\t\tsuper();\r\n\t\tthis.className = \"MapArc\";\r\n\r\n\t\t// Apply theme\r\n\t\tthis.applyTheme();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tprotected createLine(){\r\n\t\tthis.line = new Polyarc();\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * `shortestDistance = true` is not supported by `MapArc`.\r\n\t * \r\n\t * Only [[MapLine]] supports it.\r\n\t * \r\n\t * @default false\r\n\t * @param value\r\n\t */\r\n\tpublic set shortestDistance(value: boolean) {\r\n\r\n\t}\r\n\t\r\n\tpublic get shortestDistance(): boolean {\r\n\t\treturn false;\r\n\t}\r\n\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"MapArc\"] = MapArc;\r\n\n\n\n// WEBPACK FOOTER //\n// ../../../../../src/.internal/charts/map/MapArc.ts","/**\r\n * A collection of Map-related utility functions.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { IGeoPoint } from \"../../core/defs/IGeoPoint\";\r\n\r\n/**\r\n * Converts a multi-part polygon in X/Y coordinates to a geo-multipolygon in\r\n * geo-points (lat/long).\r\n *\r\n * @param multiPolygon  Source multi-polygon\r\n * @return Geo-multipolygon\r\n */\r\n\r\nexport function multiPolygonToGeo(multiPolygon: number[][][][]): IGeoPoint[][][] {\r\n\tlet multiGeoArea: IGeoPoint[][][] = [];\r\n\r\n\tfor (let i = 0, len = multiPolygon.length; i < len; i++) {\r\n\r\n\t\tlet surface: number[][] = multiPolygon[i][0];\r\n\t\tlet hole: number[][] = multiPolygon[i][1];\r\n\r\n\t\t//let holePoints: IGeoPoint[] = [];\r\n\r\n\t\tmultiGeoArea[i] = [];\r\n\r\n\t\tif (surface) {\r\n\t\t\tmultiGeoArea[i].push(multiPointToGeo(surface));\r\n\t\t}\r\n\r\n\t\tif (hole) {\r\n\t\t\tmultiGeoArea[i].push(multiPointToGeo(hole));\r\n\t\t}\r\n\t}\r\n\treturn multiGeoArea;\r\n}\r\n\r\n/**\r\n * Converts a multiline in X/Y coordinates to a geo-multiline in geo-points\r\n * (lat/long).\r\n *\r\n * @param multiLine  Source multiline\r\n * @return Geo-multiline\r\n */\r\nexport function multiLineToGeo(multiLine: number[][][]): IGeoPoint[][] {\r\n\tlet multiGeoLine: IGeoPoint[][] = [];\r\n\r\n\tfor (let i = 0, len = multiLine.length; i < len; i++) {\r\n\t\tmultiGeoLine.push(multiPointToGeo(multiLine[i]));\r\n\t}\r\n\treturn multiGeoLine;\r\n}\r\n\r\n/**\r\n * Converts multiple X/Y points into a lat/long geo-points.\r\n *\r\n * @param points  Source points\r\n * @return Geo-points\r\n */\r\nexport function multiPointToGeo(points: number[][]): IGeoPoint[] {\r\n\tlet geoPoints: IGeoPoint[] = [];\r\n\tfor (let i = 0, len = points.length; i < len; i++) {\r\n\t\tgeoPoints.push(pointToGeo(points[i]));\r\n\t}\r\n\treturn geoPoints;\r\n}\r\n\r\n/**\r\n * Converts X/Y point into a lat/long geo-point.\r\n *\r\n * @param point  Source point\r\n * @return Geo-point\r\n */\r\nexport function pointToGeo(point: number[]): IGeoPoint {\r\n\treturn { longitude: point[0], latitude: point[1] }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ../../../../../src/.internal/charts/map/MapUtils.ts","/**\r\n * Map polygon series module\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { MapSeries, MapSeriesDataItem, GEOJSONGeometry, IMapSeriesProperties, IMapSeriesDataFields, IMapSeriesAdapters, IMapSeriesEvents } from \"./MapSeries\";\r\nimport { SpriteEventDispatcher, AMEvent } from \"../../core/Sprite\";\r\nimport { MapChart } from \"../types/MapChart\";\r\nimport { MapPolygon } from \"./MapPolygon\";\r\nimport { ListTemplate, ListDisposer } from \"../../core/utils/List\";\r\nimport { IMapPolygonDataObject } from \"../types/MapChart\";\r\nimport { IGeoPoint } from \"../../core/defs/IGeoPoint\";\r\nimport { registry } from \"../../core/Registry\";\r\nimport * as $mapUtils from \"./MapUtils\";\r\nimport * as $array from \"../../core/utils/Array\";\r\nimport * as $utils from \"../../core/utils/Utils\";\r\nimport * as $iter from \"../../core/utils/Iterator\";\r\nimport { IDisposer, Disposer, MultiDisposer } from \"../../core/utils/Disposer\";\r\n\r\n/**\r\n * ============================================================================\r\n * DATA ITEM\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines a [[DataItem]] for [[MapPolygonSeries]]\r\n * @see {@link DataItem}\r\n */\r\nexport class MapPolygonSeriesDataItem extends MapSeriesDataItem {\r\n\r\n\t/**\r\n\t * A [[MapPolygon]] element related to this data item.\r\n\t */\r\n\tprotected _mapPolygon: MapPolygon;\r\n\r\n\t/**\r\n\t * A collection of X/Y coordinates for a single polygon.\r\n\t */\r\n\tprotected _polygon: number[][][];\r\n\r\n\t/**\r\n\t * A collection of X/Y coordinates for a multi-part polygon.\r\n\t */\r\n\tprotected _multiPolygon: number[][][][];\r\n\r\n\t/**\r\n\t * A collection of lat/long coordinates for a single polygon.\r\n\t */\r\n\tprotected _geoPolygon: IGeoPoint[][];\r\n\r\n\t/**\r\n\t * A collection of lat/long coordinates for a multi-part polygon.\r\n\t */\r\n\tprotected _multiGeoPolygon: IGeoPoint[][][];\r\n\r\n\t/**\r\n\t * Defines a type of [[Component]] this data item is used for\r\n\t */\r\n\tpublic _component!: MapPolygonSeries;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"MapPolygonSeriesDataItem\";\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * A [[MapPolygon]] element related to this data item.\r\n\t *\r\n\t * @readonly\r\n\t * @return Element\r\n\t */\r\n\tpublic get mapPolygon(): MapPolygon {\r\n\t\tif (!this._mapPolygon) {\r\n\t\t\tlet mapPolygon = this.component.mapPolygons.create();\r\n\t\t\tthis._mapPolygon = mapPolygon;\r\n\t\t\tthis.addSprite(mapPolygon);\r\n\r\n\t\t\tthis._disposers.push(mapPolygon);\r\n\t\t\tthis._disposers.push(new Disposer(() => {\r\n\t\t\t\tif (this.component) {\r\n\t\t\t\t\tthis.component.mapPolygons.removeValue(mapPolygon);\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\t\t}\r\n\t\treturn this._mapPolygon;\r\n\t}\r\n\r\n\t/**\r\n\t * A collection of X/Y coordinates for a single polygon. E.g.:\r\n\t *\r\n\t * ```JSON\r\n\t * [\r\n\t *   [\r\n\t *     [ 100, 150 ],\r\n\t *     [ 120, 200 ],\r\n\t *     [ 150, 200 ],\r\n\t *     [ 170, 240 ],\r\n\t *     [ 100, 150 ]\r\n\t *   ]\r\n\t * ]\r\n\t * ```\r\n\t *\r\n\t * @param polygon  Coordinates\r\n\t */\r\n\tpublic set polygon(polygon: number[][][]) {\r\n\t\tthis._polygon = polygon;\r\n\t\tthis.multiGeoPolygon = $mapUtils.multiPolygonToGeo([polygon]);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Coordinates\r\n\t */\r\n\tpublic get polygon(): number[][][] {\r\n\t\treturn this._polygon;\r\n\t}\r\n\r\n\t/**\r\n\t * A collection of X/Y coordinates for a multi-part polygon. E.g.:\r\n\t *\r\n\t * ```JSON\r\n\t * [\r\n\t *   // Part 1\r\n\t *   [\r\n\t *     [\r\n\t *       [ 100, 150 ],\r\n\t *       [ 120, 200 ],\r\n\t *       [ 150, 220 ],\r\n\t *       [ 170, 240 ],\r\n\t *       [ 100, 150 ]\r\n\t *     ]\r\n\t *   ],\r\n\t *\r\n\t *   // Part 2\r\n\t *   [\r\n\t *     [\r\n\t *       [ 300, 350 ],\r\n\t *       [ 320, 400 ],\r\n\t *       [ 350, 420 ],\r\n\t *       [ 370, 440 ],\r\n\t *       [ 300, 350 ]\r\n\t *     ]\r\n\t *   ]\r\n\t * ]\r\n\t * ```\r\n\t *\r\n\t * @param multiPolygon  Coordinates\r\n\t */\r\n\tpublic set multiPolygon(multiPolygon: number[][][][]) {\r\n\t\tthis._multiPolygon = multiPolygon;\r\n\t\tthis.multiGeoPolygon = $mapUtils.multiPolygonToGeo(multiPolygon);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Coordinates\r\n\t */\r\n\tpublic get multiPolygon(): number[][][][] {\r\n\t\treturn this._multiPolygon;\r\n\t}\r\n\r\n\t/**\r\n\t * A collection of lat/long coordinates for a single polygon. E.g.:\r\n\t *\r\n\t * ```JSON\r\n\t * [\r\n\t *   [\r\n\t *     { latitude: -10.0, longitude: -10.0 },\r\n\t *     { latitude: 10.0, longitude: -10.0 },\r\n\t *     { latitude: 10.0, longitude: 10.0 },\r\n\t *     { latitude: -10.0, longitude: -10.0 }\r\n\t *   ]\r\n\t * ]\r\n\t * ```\r\n\t *\r\n\t * @see {@link https://tools.ietf.org/html/rfc7946#section-3.1.6} GeoJSON Polygon reference\r\n\t * @param geoPolygon  Coordinates\r\n\t */\r\n\tpublic set geoPolygon(geoPolygon: IGeoPoint[][]) {\r\n\t\tthis._geoPolygon = geoPolygon;\r\n\t\tthis.multiGeoPolygon = [geoPolygon];\r\n\t}\r\n\r\n\t/**\r\n\t * @return Coordinates\r\n\t */\r\n\tpublic get geoPolygon(): IGeoPoint[][] {\r\n\t\treturn this._geoPolygon;\r\n\t}\r\n\r\n\t/**\r\n\t * A collection of lat/long coordinates for a multi-part polygon. E.g.:\r\n\t *\r\n\t * ```JSON\r\n\t * [\r\n\t *   [\r\n\t *     [\r\n\t *       { longitude: 180.0, latitude: 40.0 },\r\n\t *       { longitude: 180.0, latitude: 50.0 },\r\n\t *       { longitude: 170.0, latitude: 50.0 },\r\n\t *       { longitude: 170.0, latitude: 40.0 },\r\n\t *       { longitude: 180.0, latitude: 40.0 }\r\n\t *     ]\r\n\t *   ],\r\n\t *   [\r\n\t *     [\r\n\t *       { longitude: -170.0, latitude: 40.0 },\r\n\t *       { longitude: -170.0, latitude: 50.0 },\r\n\t *       { longitude: -180.0, latitude: 50.0 },\r\n\t *       { longitude: -180.0, latitude: 40.0 },\r\n\t *       { longitude: -170.0, latitude: 40.0 }\r\n\t *     ]\r\n\t *   ]\r\n\t * ]\r\n\t * ```\r\n\t *\r\n\t * @see {@link https://tools.ietf.org/html/rfc7946#section-3.1.7} GeoJSON MultiPolygon reference\r\n\t * @param multiGeoPolygon  Coordinates\r\n\t */\r\n\tpublic set multiGeoPolygon(multiGeoPolygon: IGeoPoint[][][]) {\r\n\t\tthis._multiGeoPolygon = multiGeoPolygon;\r\n\t\tthis.updateAreaExtremes(multiGeoPolygon);\r\n\t\tthis.mapPolygon.multiGeoPolygon = this._multiGeoPolygon;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Coordinates\r\n\t */\r\n\tpublic get multiGeoPolygon(): IGeoPoint[][][] {\r\n\t\treturn this._multiGeoPolygon;\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the item's bounding coordinates: coordinates of the East, West,\r\n\t * North, and South-most points.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param geoPoints  Points of the element\r\n\t */\r\n\tpublic updateAreaExtremes(multiGeoPolygon: IGeoPoint[][][]): void {\r\n\t\tfor (let i = 0, len = multiGeoPolygon.length; i < len; i++) {\r\n\t\t\tlet geoPolygon: IGeoPoint[][] = multiGeoPolygon[i];\r\n\t\t\tlet surface: IGeoPoint[] = geoPolygon[0];\r\n\t\t\tthis.updateExtremes(surface);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines data fields for [[MapPolygonSeries]].\r\n */\r\nexport interface IMapPolygonSeriesDataFields extends IMapSeriesDataFields {\r\n\r\n\t/**\r\n\t * Field name that holds polygon pixels.\r\n\t */\r\n\tpolygon?: string;\r\n\r\n\t/**\r\n\t * Field name that holds multi-polygon pixels.\r\n\t */\r\n\tmultiPolygon?: string;\r\n\r\n\t/**\r\n\t * Field name that holds polygon data in Geo coordinates.\r\n\t */\r\n\tgeoPolygon?: string;\r\n\r\n\t/**\r\n\t * Field name that holds poly-polygon data in Geo coordinates.\r\n\t */\r\n\tmultiGeoPolygon?: string;\r\n\r\n}\r\n\r\n/**\r\n * Defines properties for [[MapPolygonSeries]].\r\n */\r\nexport interface IMapPolygonSeriesProperties extends IMapSeriesProperties { }\r\n\r\n/**\r\n * Defines events for [[MapPolygonSeries]].\r\n */\r\nexport interface IMapPolygonSeriesEvents extends IMapSeriesEvents { }\r\n\r\n/**\r\n * Defines adapters for [[MapPolygonSeries]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface IMapPolygonSeriesAdapters extends IMapSeriesAdapters, IMapPolygonSeriesProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * A series of map polygon elements.\r\n *\r\n * @see {@link IMapPolygonSeriesEvents} for a list of available Events\r\n * @see {@link IMapPolygonSeriesAdapters} for a list of available Adapters\r\n * @important\r\n */\r\nexport class MapPolygonSeries extends MapSeries {\r\n\r\n\t/**\r\n\t * Defines available data fields.\r\n\t */\r\n\tpublic _dataFields: IMapPolygonSeriesDataFields;\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IMapPolygonSeriesProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IMapPolygonSeriesAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IMapPolygonSeriesEvents;\r\n\r\n\t/**\r\n\t * Defines the type of data item.\r\n\t */\r\n\tpublic _dataItem: MapPolygonSeriesDataItem;\r\n\r\n\t/**\r\n\t * A related chart/map object, this element is drawn on.\r\n\t */\r\n\tpublic chart: MapChart;\r\n\r\n\t/**\r\n\t * A list of map polygons in the series.\r\n\t */\r\n\tprotected _mapPolygons: ListTemplate<MapPolygon>;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\r\n\t\t// Init\r\n\t\tsuper();\r\n\r\n\t\tthis.parsingStepDuration = 250; // to avoid some extra redrawing\r\n\r\n\t\tthis.className = \"MapPolygonSeries\";\r\n\r\n\t\t// Set data fields\r\n\t\tthis.dataFields.multiPolygon = \"multiPolygon\";\r\n\t\tthis.dataFields.polygon = \"polygon\";\r\n\r\n\t\tthis.dataFields.geoPolygon = \"geoPolygon\";\r\n\t\tthis.dataFields.multiGeoPolygon = \"multiGeoPolygon\";\r\n\r\n\t\t// Apply theme\r\n\t\tthis.applyTheme();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a new/empty DataItem of the type appropriate for this object.\r\n\t *\r\n\t * @see {@link DataItem}\r\n\t * @return Data Item\r\n\t */\r\n\tprotected createDataItem(): this[\"_dataItem\"] {\r\n\t\treturn new MapPolygonSeriesDataItem();\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tprotected processIncExc(){\r\n\t\tthis.mapPolygons.clear();\r\n\t\tsuper.processIncExc();\r\n\t}\r\n\r\n\t/**\r\n\t * (Re)validates series data, effectively causing the whole series to be\r\n\t * redrawn.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validateData(): void {\r\n\t\tif (this.data.length > 0 && this._parseDataFrom == 0) {\r\n\t\t\tthis.mapPolygons.clear();\r\n\t\t}\r\n\r\n\t\tthis.west = null;\r\n\t\tthis.east = null;\r\n\t\tthis.north = null;\r\n\t\tthis.south = null;\r\n\r\n\t\t// process geoJSON and created map objects\r\n\t\tif (this.useGeodata || this.geodata) {\r\n\t\t\tlet geoJSON: any = !this._dataSources[\"geodata\"] ? this.chart.geodata : undefined;\r\n\r\n\t\t\tif(this.geodata){\r\n\t\t\t\tgeoJSON = this.geodata;\r\n\t\t\t}\r\n\r\n\t\t\tif (geoJSON) {\r\n\r\n\t\t\t\tlet features: any[];\r\n\r\n\t\t\t\tif (geoJSON.type == \"FeatureCollection\") {\r\n\t\t\t\t\tfeatures = geoJSON.features;\r\n\t\t\t\t}\r\n\t\t\t\telse if (geoJSON.type == \"Feature\") {\r\n\t\t\t\t\tfeatures = [geoJSON];\r\n\t\t\t\t}\r\n\t\t\t\telse if ([\"Point\", \"LineString\", \"Polygon\", \"MultiPoint\", \"MultiLineString\", \"MultiPolygon\"].indexOf(geoJSON.type) != -1) {\r\n\t\t\t\t\tfeatures = [{ geometry: geoJSON }];\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tconsole.log(\"nothing found in geoJSON\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (features) {\r\n\t\t\t\t\tfor (let i = 0, len = features.length; i < len; i++) {\r\n\r\n\t\t\t\t\t\tlet feature: any = features[i];\r\n\t\t\t\t\t\tlet geometry: any = feature.geometry;\r\n\t\t\t\t\t\tif (geometry) {\r\n\t\t\t\t\t\t\tlet type: GEOJSONGeometry = <GEOJSONGeometry>geometry.type;\r\n\t\t\t\t\t\t\tlet id: string = feature.id;\r\n\r\n\t\t\t\t\t\t\tif (type == \"Polygon\" || type == \"MultiPolygon\") {\r\n\r\n\t\t\t\t\t\t\t\tif (!this.checkInclude(this.include, this.exclude, id)) {\r\n\t\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tlet coordinates: any[] = geometry.coordinates;\r\n\r\n\t\t\t\t\t\t\t\tif (coordinates) {\r\n\t\t\t\t\t\t\t\t\t// make the same as MultiPolygon\r\n\t\t\t\t\t\t\t\t\tif (type == \"Polygon\") {\r\n\t\t\t\t\t\t\t\t\t\tcoordinates = [coordinates];\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// find data object in user-provided data\r\n\t\t\t\t\t\t\t\tlet dataObject: IMapPolygonDataObject = $array.find(this.data, (value, i) => {\r\n\t\t\t\t\t\t\t\t\treturn value.id == id;\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\r\n\t\t\t\t\t\t\t\t// create one if not found\r\n\t\t\t\t\t\t\t\tif (!dataObject) {\r\n\t\t\t\t\t\t\t\t\tdataObject = { multiPolygon: coordinates, id: id };\r\n\t\t\t\t\t\t\t\t\tthis.data.push(dataObject);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t// in case found\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\t// if user-provided object doesn't have points data provided in any way:\r\n\t\t\t\t\t\t\t\t\tif (!dataObject.multiPolygon) {\r\n\t\t\t\t\t\t\t\t\t\tdataObject.multiPolygon = coordinates;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// copy properties data to datacontext\r\n\t\t\t\t\t\t\t\t$utils.softCopyProperties(feature.properties, dataObject);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsuper.validateData();\r\n\r\n\t\t// if data is parsed in chunks, polygon list is corrupted, fix it here\r\n\t\t// !important this should go after super!\r\n\t\t$iter.each(this.dataItems.iterator(), (dataItem) => {\r\n\t\t\tthis.mapPolygons.moveValue(dataItem.mapPolygon);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * (Re)validates the series\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validate() {\r\n\t\tsuper.validate();\r\n\t\t$iter.each(this.mapPolygons.iterator(), (mapPolygon) => {\r\n\t\t\tmapPolygon.validate();\r\n\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t * List of polygon elements in the series.\r\n\t *\r\n\t * @return Polygon list\r\n\t */\r\n\tpublic get mapPolygons(): ListTemplate<MapPolygon> {\r\n\r\n\t\tif (!this._mapPolygons) {\r\n\t\t\tlet polygonTemplate: MapPolygon = new MapPolygon();\r\n\r\n\t\t\tlet mapPolygons: ListTemplate<MapPolygon> = new ListTemplate<MapPolygon>(polygonTemplate);\r\n\t\t\tthis._disposers.push(new ListDisposer(mapPolygons));\r\n\t\t\tthis._disposers.push(mapPolygons.template);\r\n\t\t\tmapPolygons.template.focusable = true;\r\n\t\t\tmapPolygons.events.on(\"inserted\", this.handleObjectAdded, this, false);\r\n\t\t\tthis._mapPolygons = mapPolygons;\r\n\t\t}\r\n\r\n\t\treturn this._mapPolygons;\r\n\t}\r\n\r\n\t/**\r\n\t * returns MapPolygon by id in geoJSON file\r\n\t * @param polygon id\r\n\t * @return {MapPolygon}\r\n\t */\r\n\tpublic getPolygonById(id: string): MapPolygon {\r\n\t\treturn $iter.find(this.mapPolygons.iterator(), (mapPolygon) => {\r\n\t\t\tlet dataContext: any = mapPolygon.dataItem.dataContext;\r\n\t\t\treturn dataContext.id == id;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Copies all properties from another instance of [[Series]].\r\n\t *\r\n\t * @param source  Source series\r\n\t */\r\n\tpublic copyFrom(source: this) {\r\n\t\tthis.mapPolygons.template.copyFrom(source.mapPolygons.template);\r\n\t\tsuper.copyFrom(source);\r\n\t}\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"MapPolygonSeries\"] = MapPolygonSeries;\r\nregistry.registeredClasses[\"MapPolygonSeriesDataItem\"] = MapPolygonSeriesDataItem;\r\n\n\n\n// WEBPACK FOOTER //\n// ../../../../../src/.internal/charts/map/MapPolygonSeries.ts","/**\r\n * Map line series module\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { MapSeries, MapSeriesDataItem, GEOJSONGeometry, IMapSeriesProperties, IMapSeriesDataFields, IMapSeriesAdapters, IMapSeriesEvents } from \"./MapSeries\";\r\nimport { SpriteEventDispatcher, AMEvent } from \"../../core/Sprite\";\r\nimport { MapChart } from \"../types/MapChart\";\r\nimport { MapLine } from \"./MapLine\";\r\nimport { ListTemplate, ListDisposer } from \"../../core/utils/List\";\r\nimport { IMapLineDataObject } from \"../types/MapChart\";\r\nimport { IGeoPoint } from \"../../core/defs/IGeoPoint\";\r\nimport { registry } from \"../../core/Registry\";\r\nimport * as $mapUtils from \"./MapUtils\";\r\nimport * as $array from \"../../core/utils/Array\";\r\nimport * as $utils from \"../../core/utils/Utils\";\r\nimport * as $iter from \"../../core/utils/Iterator\";\r\nimport { IDisposer, Disposer, MultiDisposer } from \"../../core/utils/Disposer\";\r\n\r\n/**\r\n * ============================================================================\r\n * DATA ITEM\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines a [[DataItem]] for [[MapLineSeries]]\r\n * @see {@link DataItem}\r\n */\r\nexport class MapLineSeriesDataItem extends MapSeriesDataItem {\r\n\r\n\t/**\r\n\t * A [[MapLine]] element related to this data item.\r\n\t */\r\n\tpublic _mapLine: MapLine;\r\n\r\n\t/**\r\n\t * A collection of X/Y coordinates for a single-segment line.\r\n\t */\r\n\tprotected _line: number[][];\r\n\r\n\t/**\r\n\t * A collection of X/Y coordinates for a multi-segment line.\r\n\t */\r\n\tprotected _multiLine: number[][][];\r\n\r\n\t/**\r\n\t * A collection of lat/long coordinates for a single-segment line.\r\n\t */\r\n\tprotected _geoLine: IGeoPoint[];\r\n\r\n\t/**\r\n\t * A collection of lat/long coordinates for a multi-segment line.\r\n\t */\r\n\tprotected _multiGeoLine: IGeoPoint[][];\r\n\r\n\t/**\r\n\t * Defines a type of [[Component]] this data item is used for\r\n\t */\r\n\tpublic _component!: MapLineSeries;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"MapLineSeriesDataItem\";\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * A [[MapLine]] element related to this data item.\r\n\t *\r\n\t * @readonly\r\n\t * @return Element\r\n\t */\r\n\tpublic get mapLine(): this[\"_mapLine\"] {\r\n\t\tif (!this._mapLine) {\r\n\t\t\tlet mapLine = this.component.mapLines.create();\r\n\r\n\t\t\tthis._mapLine = mapLine;\r\n\t\t\tthis.addSprite(mapLine);\r\n\r\n\t\t\tthis._disposers.push(mapLine);\r\n\t\t\tthis._disposers.push(new Disposer(() => {\r\n\t\t\t\tif (this.component) {\r\n\t\t\t\t\tthis.component.mapLines.removeValue(mapLine);\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\t\t}\r\n\t\treturn this._mapLine;\r\n\t}\r\n\r\n\t/**\r\n\t * A collection of X/Y coordinates for a single-segment line. E.g.:\r\n\t *\r\n\t * ```JSON\r\n\t * [\r\n\t *   [ 100, 150 ],\r\n\t *   [ 120, 200 ]\r\n\t * ]\r\n\t * ```\r\n\t *\r\n\t * @param line  Coordinates\r\n\t */\r\n\tpublic set line(line: number[][]) {\r\n\t\tthis._line = line;\r\n\t\tthis.multiGeoLine = $mapUtils.multiLineToGeo([line]);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Coordinates\r\n\t */\r\n\tpublic get line(): number[][] {\r\n\t\treturn this._line;\r\n\t}\r\n\r\n\t/**\r\n\t * A collection of X/Y coordinates for a multi-segment line. E.g.:\r\n\t *\r\n\t * ```JSON\r\n\t * [\r\n\t *   // Segment 1\r\n\t *   [\r\n\t *     [ 100, 150 ],\r\n\t *     [ 120, 200 ]\r\n\t *   ],\r\n\t *\r\n\t *   // Segment 2\r\n\t *   [\r\n\t *     [ 120, 200 ],\r\n\t *     [ 150, 100 ]\r\n\t *   ]\r\n\t * ]\r\n\t * ```\r\n\t *\r\n\t * @param multiLine  Coordinates\r\n\t */\r\n\tpublic set multiLine(multiLine: number[][][]) {\r\n\t\tthis._multiLine = multiLine;\r\n\t\tthis.multiGeoLine = $mapUtils.multiLineToGeo(multiLine);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Coordinates\r\n\t */\r\n\tpublic get multiLine(): number[][][] {\r\n\t\treturn this._multiLine;\r\n\t}\r\n\r\n\t/**\r\n\t * A collection of lat/long coordinates for a single-segment line. E.g.:\r\n\t *\r\n\t * ```JSON\r\n\t * [\r\n\t *   { longitude: 3.121, latitude: 0.58 },\r\n\t *   { longitude: -5.199, latitude: 21.223 }\r\n\t * ]\r\n\t * ```\r\n\t *\r\n\t * @see {@link https://tools.ietf.org/html/rfc7946#section-3.1.4} GeoJSON LineString reference\r\n\t * @param geoLine  Coordinates\r\n\t */\r\n\tpublic set geoLine(geoLine: IGeoPoint[]) {\r\n\t\tthis._geoLine = geoLine;\r\n\t\tthis.multiGeoLine = [geoLine];\r\n\t}\r\n\r\n\t/**\r\n\t * @return Coordinates\r\n\t */\r\n\tpublic get geoLine(): IGeoPoint[] {\r\n\t\treturn this._geoLine;\r\n\t}\r\n\r\n\t/**\r\n\t * A collection of X/Y coordinates for a multi-segment line. E.g.:\r\n\t *\r\n\t * ```JSON\r\n\t * [\r\n\t *   // Segment 1\r\n\t *   [\r\n\t *     { longitude: 3.121, latitude: 0.58 },\r\n\t *     { longitude: -5.199, latitude: 21.223 }\r\n\t *   ],\r\n\t *\r\n\t *   // Segment 2\r\n\t *   [\r\n\t *     { longitude: -5.199, latitude: 21.223 },\r\n\t *     { longitude: -12.9, latitude: 25.85 }\r\n\t *   ]\r\n\t * ]\r\n\t * ```\r\n\t *\r\n\t * @see {@link https://tools.ietf.org/html/rfc7946#section-3.1.5} GeoJSON MultiLineString reference\r\n\t * @param multiGeoLine  Coordinates\r\n\t */\r\n\tpublic set multiGeoLine(multiGeoLine: IGeoPoint[][]) {\r\n\t\tthis._multiGeoLine = multiGeoLine;\r\n\t\tthis.updateLineExtremes(multiGeoLine);\r\n\t\tthis.mapLine.multiGeoLine = this._multiGeoLine;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Coordinates\r\n\t */\r\n\tpublic get multiGeoLine(): IGeoPoint[][] {\r\n\t\treturn this._multiGeoLine;\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the item's bounding coordinates: coordinates of the East, West,\r\n\t * North, and South-most points.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param geoPoints  Points of the element\r\n\t */\r\n\tpublic updateLineExtremes(multiGeoLine: IGeoPoint[][]): void {\r\n\t\tfor (let i = 0, len = multiGeoLine.length; i < len; i++) {\r\n\t\t\tlet geoLine: IGeoPoint[] = multiGeoLine[i];\r\n\t\t\tthis.updateExtremes(geoLine);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines data fields for [[MapLineSeries]].\r\n */\r\nexport interface IMapLineSeriesDataFields extends IMapSeriesDataFields {\r\n\r\n\t/**\r\n\t * Field name that holds line data in pixels.\r\n\t */\r\n\tline?: string;\r\n\r\n\t/**\r\n\t * Field name that holds multi-line data in pixels.\r\n\t */\r\n\tmultiLine?: string;\r\n\r\n\t/**\r\n\t * Field name that holds line data in Geo coordinates.\r\n\t */\r\n\tgeoLine?: string;\r\n\r\n\t/**\r\n\t * Field name that holds multi-line data in Geo coordinates.\r\n\t */\r\n\tmultiGeoLine?: string;\r\n\r\n}\r\n\r\n/**\r\n * Defines properties for [[MapLineSeries]].\r\n */\r\nexport interface IMapLineSeriesProperties extends IMapSeriesProperties { }\r\n\r\n/**\r\n * Defines events for [[MapLineSeries]].\r\n */\r\nexport interface IMapLineSeriesEvents extends IMapSeriesEvents { }\r\n\r\n/**\r\n * Defines adapters for [[MapLineSeries]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface IMapLineSeriesAdapters extends IMapSeriesAdapters, IMapLineSeriesProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * A series of map line series.\r\n *\r\n * @see {@link IMapLineSeriesEvents} for a list of available Events\r\n * @see {@link IMapLineSeriesAdapters} for a list of available Adapters\r\n * @important\r\n */\r\nexport class MapLineSeries extends MapSeries {\r\n\r\n\t/**\r\n\t * Defines available data fields.\r\n\t */\r\n\tpublic _dataFields: IMapLineSeriesDataFields;\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IMapLineSeriesProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IMapLineSeriesAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IMapLineSeriesEvents;\r\n\r\n\t/**\r\n\t * Defines the type of data item.\r\n\t */\r\n\tpublic _dataItem: MapLineSeriesDataItem;\r\n\r\n\r\n\t/**\r\n\t * A related chart/map object, this element is drawn on.\r\n\t */\r\n\tpublic chart: MapChart;\r\n\r\n\t/**\r\n\t * Defines the type of the line items in this series.\r\n\t */\r\n\tpublic _mapLine: MapLine;\r\n\r\n\t/**\r\n\t * A list of map lins in the series.\r\n\t */\r\n\tprotected _mapLines: ListTemplate<this[\"_mapLine\"]>;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\r\n\t\t// Init\r\n\t\tsuper();\r\n\t\tthis.className = \"MapLineSeries\";\r\n\r\n\t\t// Set data fields\r\n\t\tthis.dataFields.multiLine = \"multiLine\";\r\n\t\tthis.dataFields.line = \"line\";\r\n\r\n\t\tthis.dataFields.geoLine = \"geoLine\";\r\n\t\tthis.dataFields.multiGeoLine = \"multiGeoLine\";\r\n\r\n\t\t// Apply theme\r\n\t\tthis.applyTheme();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a new/empty DataItem of the type appropriate for this object.\r\n\t *\r\n\t * @see {@link DataItem}\r\n\t * @return Data Item\r\n\t */\r\n\tprotected createDataItem(): this[\"_dataItem\"] {\r\n\t\treturn new MapLineSeriesDataItem();\r\n\t}\r\n\r\n\t/**\r\n\t * (Re)validates series data, effectively causing the whole series to be\r\n\t * redrawn.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validateData(): void {\r\n\t\tif (this.data.length > 0 && this._parseDataFrom == 0) {\r\n\t\t\tthis.mapLines.clear();\r\n\t\t}\r\n\r\n\t\t// process geoJSON and created map objects\r\n\t\tif (this.useGeodata || this.geodata) {\r\n\t\t\tlet geoJSON: any = this.chart.geodata;\r\n\t\t\tif (geoJSON) {\r\n\r\n\t\t\t\tlet features: any[];\r\n\r\n\t\t\t\tif (geoJSON.type == \"FeatureCollection\") {\r\n\t\t\t\t\tfeatures = geoJSON.features;\r\n\t\t\t\t}\r\n\t\t\t\telse if (geoJSON.type == \"Feature\") {\r\n\t\t\t\t\tfeatures = [geoJSON];\r\n\t\t\t\t}\r\n\t\t\t\telse if ([\"Point\", \"LineString\", \"Polygon\", \"MultiPoint\", \"MultiLineString\", \"MultiPolygon\"].indexOf(geoJSON.type) != -1) {\r\n\t\t\t\t\tfeatures = [{ geometry: geoJSON }];\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tconsole.log(\"nothing found in geoJSON\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (features) {\r\n\t\t\t\t\tfor (let i = 0, len = features.length; i < len; i++) {\r\n\r\n\t\t\t\t\t\tlet feature: any = features[i];\r\n\t\t\t\t\t\tlet geometry: any = feature.geometry;\r\n\t\t\t\t\t\tif (geometry) {\r\n\t\t\t\t\t\t\tlet type: GEOJSONGeometry = <GEOJSONGeometry>geometry.type;\r\n\t\t\t\t\t\t\tlet id: string = feature.id;\r\n\t\t\t\t\t\t\tif (type == \"LineString\" || type == \"MultiLineString\") {\r\n\r\n\t\t\t\t\t\t\t\tif (!this.checkInclude(this.include, this.exclude, id)) {\r\n\t\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tlet coordinates: any[] = geometry.coordinates;\r\n\t\t\t\t\t\t\t\tlet dataObject: IMapLineDataObject = $array.find(this.data, (value, i) => {\r\n\t\t\t\t\t\t\t\t\treturn value.id == id;\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\tif (type == \"LineString\") {\r\n\t\t\t\t\t\t\t\t\tcoordinates = [coordinates];\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif (!dataObject) {\r\n\t\t\t\t\t\t\t\t\tdataObject = { multiLine: coordinates, id: id };\r\n\t\t\t\t\t\t\t\t\tthis.data.push(dataObject);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tif (!dataObject.multiLine) {\r\n\t\t\t\t\t\t\t\t\t\tdataObject.multiLine = coordinates;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t// copy properties data to datacontext\r\n\t\t\t\t\t\t\t\t$utils.softCopyProperties(feature.properties, dataObject);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsuper.validateData();\r\n\t\t// important! this should go after super\r\n\t\t// if data is parsed in chunks, lines list is corrupted, fix it here\r\n\t\t$iter.each(this.dataItems.iterator(), (dataItem) => {\r\n\t\t\tthis.mapLines.moveValue(dataItem.mapLine);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * A list of lines in the series.\r\n\t *\r\n\t * @return Lines\r\n\t */\r\n\tpublic get mapLines(): ListTemplate<this[\"_mapLine\"]> {\r\n\r\n\t\tif (!this._mapLines) {\r\n\t\t\tlet lineTemplate: MapLine = this.createLine();\r\n\t\t\tlet mapLines = new ListTemplate<MapLine>(lineTemplate);\r\n\t\t\tthis._disposers.push(new ListDisposer(mapLines));\r\n\t\t\tthis._disposers.push(mapLines.template);\r\n\t\t\tmapLines.events.on(\"inserted\", this.handleObjectAdded, this, false);\r\n\t\t\tthis._mapLines = mapLines;\r\n\t\t}\r\n\r\n\t\treturn this._mapLines;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a new line instance of suitable type.\r\n\t *\r\n\t * @return New line\r\n\t */\r\n\tprotected createLine(): this[\"_mapLine\"] {\r\n\t\treturn new MapLine();\r\n\t}\r\n\r\n\t/**\r\n\t * (Re)validates the series\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validate() {\r\n\t\tsuper.validate();\r\n\t\t$iter.each(this.mapLines.iterator(), (mapLine) => {\r\n\t\t\tmapLine.validate();\r\n\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t * Copies all properties from another instance of [[Series]].\r\n\t *\r\n\t * @param source  Source series\r\n\t */\r\n\tpublic copyFrom(source: this) {\r\n\t\tthis.mapLines.template.copyFrom(source.mapLines.template);\r\n\t\tsuper.copyFrom(source);\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"MapLineSeries\"] = MapLineSeries;\r\nregistry.registeredClasses[\"MapLineSeriesDataItem\"] = MapLineSeriesDataItem;\r\n\n\n\n// WEBPACK FOOTER //\n// ../../../../../src/.internal/charts/map/MapLineSeries.ts","/**\r\n * Map spline series module\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { MapLineSeries, MapLineSeriesDataItem, IMapLineSeriesProperties, IMapLineSeriesDataFields, IMapLineSeriesAdapters, IMapLineSeriesEvents } from \"./MapLineSeries\";\r\nimport { SpriteEventDispatcher, AMEvent } from \"../../core/Sprite\";\r\nimport { MapChart, MapLineType } from \"../types/MapChart\";\r\nimport { MapSpline } from \"./MapSpline\";\r\nimport { ListTemplate, IListEvents } from \"../../core/utils/List\";\r\nimport { IMapDataObject, IMapPolygonDataObject, IMapLineDataObject } from \"../types/MapChart\";\r\nimport { registry } from \"../../core/Registry\";\r\nimport { IDisposer, Disposer, MultiDisposer } from \"../../core/utils/Disposer\";\r\n\r\n/**\r\n * ============================================================================\r\n * DATA ITEM\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines a [[DataItem]] for [[MapSplineSeries]]\r\n * @see {@link DataItem}\r\n */\r\nexport class MapSplineSeriesDataItem extends MapLineSeriesDataItem {\r\n\r\n\t/**\r\n\t * A [[MapSpline]] element related to this data item.\r\n\t */\r\n\tpublic _mapLine: MapSpline;\r\n\r\n\t/**\r\n\t * Defines a type of [[Component]] this data item is used for\r\n\t */\r\n\tpublic _component!: MapSplineSeries;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"MapSplineSeriesDataItem\";\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines data fields for [[MapSplineSeries]].\r\n */\r\nexport interface IMapSplineSeriesDataFields extends IMapLineSeriesDataFields { }\r\n\r\n/**\r\n * Defines properties for [[MapSplineSeries]].\r\n */\r\nexport interface IMapSplineSeriesProperties extends IMapLineSeriesProperties { }\r\n\r\n/**\r\n * Defines events for [[MapSplineSeries]].\r\n */\r\nexport interface IMapSplineSeriesEvents extends IMapLineSeriesEvents { }\r\n\r\n/**\r\n * Defines adapters for [[MapSplineSeries]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface IMapSplineSeriesAdapters extends IMapLineSeriesAdapters, IMapSplineSeriesProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * A series of map spline elements.\r\n *\r\n * @see {@link IMapSplineSeriesEvents} for a list of available Events\r\n * @see {@link IMapSplineSeriesAdapters} for a list of available Adapters\r\n * @important\r\n */\r\nexport class MapSplineSeries extends MapLineSeries {\r\n\r\n\t/**\r\n\t * Defines available data fields.\r\n\t */\r\n\tpublic _dataFields: IMapSplineSeriesDataFields;\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IMapSplineSeriesProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IMapSplineSeriesAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IMapSplineSeriesEvents;\r\n\r\n\t/**\r\n\t * Defines the type of data item.\r\n\t */\r\n\tpublic _dataItem: MapSplineSeriesDataItem;\r\n\r\n\t/**\r\n\t * Defines the type of the line items in this series.\r\n\t */\r\n\tpublic _mapLine: MapSpline;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"MapSplineSeries\";\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a new/empty DataItem of the type appropriate for this object.\r\n\t *\r\n\t * @see {@link DataItem}\r\n\t * @return Data Item\r\n\t */\r\n\tprotected createDataItem(): this[\"_dataItem\"] {\r\n\t\treturn new MapSplineSeriesDataItem();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a new line instance of suitable type.\r\n\t *\r\n\t * @return New line\r\n\t */\r\n\tprotected createLine(): this[\"_mapLine\"] {\r\n\t\treturn new MapSpline();\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"MapSplineSeries\"] = MapSplineSeries;\r\nregistry.registeredClasses[\"MapSplineSeriesDataItem\"] = MapSplineSeriesDataItem;\r\n\n\n\n// WEBPACK FOOTER //\n// ../../../../../src/.internal/charts/map/MapSplineSeries.ts","/**\r\n * Map image series module\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { MapSeries, MapSeriesDataItem, GEOJSONGeometry, IMapSeriesProperties, IMapSeriesDataFields, IMapSeriesAdapters, IMapSeriesEvents } from \"./MapSeries\";\r\nimport { SpriteEventDispatcher, AMEvent } from \"../../core/Sprite\";\r\nimport { MapChart } from \"../types/MapChart\";\r\nimport { MapImage } from \"./MapImage\";\r\nimport { ListTemplate, ListDisposer } from \"../../core/utils/List\";\r\nimport { IMapImageDataObject } from \"../types/MapChart\";\r\nimport { IGeoPoint } from \"../../core/defs/IGeoPoint\";\r\nimport { registry } from \"../../core/Registry\";\r\nimport * as $array from \"../../core/utils/Array\";\r\nimport * as $mapUtils from \"./MapUtils\";\r\nimport * as $utils from \"../../core/utils/Utils\";\r\nimport * as $iter from \"../../core/utils/Iterator\";\r\nimport * as $type from \"../../core/utils/Type\";\r\nimport { IDisposer, Disposer, MultiDisposer } from \"../../core/utils/Disposer\";\r\n\r\n/**\r\n * ============================================================================\r\n * DATA ITEM\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines a [[DataItem]] for [[MapImageSeries]]\r\n * @see {@link DataItem}\r\n */\r\nexport class MapImageSeriesDataItem extends MapSeriesDataItem {\r\n\r\n\t/**\r\n\t * A [[MapImage]] element related to this data item.\r\n\t */\r\n\tprotected _mapImage: MapImage;\r\n\r\n\t/**\r\n\t * [_point description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprotected _point: number[];\r\n\r\n\t/**\r\n\t * Geographical coordinates image is placed at.\r\n\t */\r\n\tprotected _geoPoint: IGeoPoint;\r\n\r\n\t/**\r\n\t * Defines a type of [[Component]] this data item is used for\r\n\t */\r\n\tpublic _component!: MapImageSeries;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"MapImageSeriesDataItem\";\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * A [[MapImage]] element related to this data item.\r\n\t *\r\n\t * @return Element\r\n\t */\r\n\tpublic get mapImage(): MapImage {\r\n\t\tif (!this._mapImage) {\r\n\t\t\tlet mapImage = this.component.mapImages.create();\r\n\t\t\tthis.addSprite(mapImage);\r\n\t\t\tthis._mapImage = mapImage;\r\n\t\t\tthis._disposers.push(mapImage);\r\n\t\t\tthis._disposers.push(new Disposer(() => {\r\n\t\t\t\tif (this.component) {\r\n\t\t\t\t\tthis.component.mapImages.removeValue(mapImage);\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\t\t}\r\n\t\treturn this._mapImage;\r\n\t}\r\n\r\n\t/**\r\n\t * [point description]\r\n\t *\r\n\t * @todo Description\r\n\t * @param point [description]\r\n\t */\r\n\tpublic set point(point: number[]) {\r\n\t\tthis._point = point;\r\n\t\tthis.geoPoint = $mapUtils.pointToGeo(point);\r\n\t}\r\n\r\n\t/**\r\n\t * @return [description]\r\n\t */\r\n\tpublic get point(): number[] {\r\n\t\treturn this._point;\r\n\t}\r\n\r\n\t/**\r\n\t * Geographical coordinates (lat/long) image is placed at.\r\n\t *\r\n\t * @param geoPoint Image coordinates\r\n\t */\r\n\tpublic set geoPoint(geoPoint: IGeoPoint) {\r\n\t\tthis._geoPoint = geoPoint;\r\n\t\tthis.updateExtremes([this._geoPoint]);\r\n\r\n\t\tthis.mapImage.latitude = this._geoPoint.latitude;\r\n\t\tthis.mapImage.longitude = this._geoPoint.longitude;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Image coordinates\r\n\t */\r\n\tpublic get geoPoint(): IGeoPoint {\r\n\t\treturn this._geoPoint;\r\n\t}\r\n\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines data fields for [[MapImageSeries]].\r\n */\r\nexport interface IMapImageSeriesDataFields extends IMapSeriesDataFields {\r\n\r\n\t/**\r\n\t * Field name that holds image point data in pixels.\r\n\t */\r\n\tpoint?: string;\r\n\r\n\t/**\r\n\t * Field name that holds multi-image point data in pixels.\r\n\t */\r\n\tmultiPoint?: string;\r\n\r\n\t/**\r\n\t * Field name that holds image point data in Geo coordinates.\r\n\t */\r\n\tgeoPoint?: string;\r\n\r\n\t/**\r\n\t * Field name that holds multi-image point data in Geo coordinates.\r\n\t */\r\n\tmultiGeoPoint?: string;\r\n\r\n}\r\n\r\n/**\r\n * Defines properties for [[MapImageSeries]].\r\n */\r\nexport interface IMapImageSeriesProperties extends IMapSeriesProperties { }\r\n\r\n/**\r\n * Defines events for [[MapImageSeries]].\r\n */\r\nexport interface IMapImageSeriesEvents extends IMapSeriesEvents { }\r\n\r\n/**\r\n * Defines adapters for [[MapImageSeries]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface IMapImageSeriesAdapters extends IMapSeriesAdapters, IMapImageSeriesProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * A series of map image (marker) elements.\r\n *\r\n * @see {@link IMapImageSeriesEvents} for a list of available Events\r\n * @see {@link IMapImageSeriesAdapters} for a list of available Adapters\r\n * @important\r\n */\r\nexport class MapImageSeries extends MapSeries {\r\n\r\n\t/**\r\n\t * Defines available data fields.\r\n\t */\r\n\tpublic _dataFields: IMapImageSeriesDataFields;\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IMapImageSeriesProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IMapImageSeriesAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IMapImageSeriesEvents;\r\n\r\n\t/**\r\n\t * Defines the type of data item.\r\n\t */\r\n\tpublic _dataItem: MapImageSeriesDataItem;\r\n\r\n\t/**\r\n\t * A related chart/map object, this image is drawn on.\r\n\t */\r\n\tpublic chart: MapChart;\r\n\r\n\t/**\r\n\t * A list of map images in the series.\r\n\t */\r\n\tprotected _mapImages: ListTemplate<MapImage>;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\r\n\t\t// Init\r\n\t\tsuper();\r\n\t\tthis.className = \"MapImageSeries\";\r\n\r\n\t\t// Set data fields\r\n\t\tthis.dataFields.multiPoint = \"multiPoint\";\r\n\t\tthis.dataFields.point = \"point\";\r\n\r\n\t\tthis.dataFields.geoPoint = \"geoPoint\";\r\n\t\tthis.dataFields.multiGeoPoint = \"multiGeoPoint\";\r\n\r\n\t\t// Apply theme\r\n\t\tthis.applyTheme();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a new/empty DataItem of the type appropriate for this object.\r\n\t *\r\n\t * @see {@link DataItem}\r\n\t * @return Data Item\r\n\t */\r\n\tprotected createDataItem(): this[\"_dataItem\"] {\r\n\t\treturn new MapImageSeriesDataItem();\r\n\t}\r\n\r\n\t/**\r\n\t * (Re)validates the data of the sries, effectively forcing it to redraw\r\n\t * all of its elements.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validateData(): void {\r\n\t\tif (this.data.length > 0 && this._parseDataFrom == 0) {\r\n\t\t\tthis.mapImages.clear();\r\n\t\t}\r\n\r\n\t\t// process geoJSON and created map objects\r\n\t\tif (this.useGeodata) {\r\n\t\t\tif (this.useGeodata || this.geodata) {\r\n\t\t\t\tlet geoJSON: any = this.chart.geodata;\r\n\r\n\t\t\t\tlet features: any[];\r\n\r\n\t\t\t\tif (geoJSON.type == \"FeatureCollection\") {\r\n\t\t\t\t\tfeatures = geoJSON.features;\r\n\t\t\t\t}\r\n\t\t\t\telse if (geoJSON.type == \"Feature\") {\r\n\t\t\t\t\tfeatures = [geoJSON];\r\n\t\t\t\t}\r\n\t\t\t\telse if ([\"Point\", \"LineString\", \"Polygon\", \"MultiPoint\", \"MultiLineString\", \"MultiPolygon\"].indexOf(geoJSON.type) != -1) {\r\n\t\t\t\t\tfeatures = [{ geometry: geoJSON }];\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tconsole.log(\"nothing found in geoJSON\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (features) {\r\n\t\t\t\t\tfor (let i = 0, len = features.length; i < len; i++) {\r\n\r\n\t\t\t\t\t\tlet feature: any = features[i];\r\n\t\t\t\t\t\tlet geometry: any = feature.geometry;\r\n\t\t\t\t\t\tif (geometry) {\r\n\t\t\t\t\t\t\tlet type: GEOJSONGeometry = <GEOJSONGeometry>geometry.type;\r\n\t\t\t\t\t\t\tlet id: string = feature.id;\r\n\t\t\t\t\t\t\tif (type == \"Point\" || type == \"MultiPoint\") {  // todo: we don't support multipoints at the moment actually\r\n\r\n\t\t\t\t\t\t\t\tif (!this.checkInclude(this.include, this.exclude, id)) {\r\n\t\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tlet coordinates: any[] = geometry.coordinates;\r\n\r\n\t\t\t\t\t\t\t\t// make the same as MultiPoint\r\n\t\t\t\t\t\t\t\tif (type == \"Point\") {\r\n\t\t\t\t\t\t\t\t\tcoordinates = [coordinates];\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tlet dataObject: IMapImageDataObject = $array.find(this.data, (value, i) => {\r\n\t\t\t\t\t\t\t\t\treturn value.id == id;\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\tif (!dataObject) {\r\n\t\t\t\t\t\t\t\t\tdataObject = { multiPoint: coordinates, id: id };\r\n\t\t\t\t\t\t\t\t\tthis.data.push(dataObject);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tif (!dataObject.multiPoint) {\r\n\t\t\t\t\t\t\t\t\t\tdataObject.multiPoint = coordinates;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// copy properties data to datacontext\r\n\t\t\t\t\t\t\t\t$utils.softCopyProperties(feature.properties, dataObject);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsuper.validateData();\r\n\t\t// important! this should go after super.validateData\r\n\t\t// if data is parsed in chunks, images list is corrupted, fix it here\r\n\r\n\t\t$iter.each(this.dataItems.iterator(), (dataItem) => {\r\n\t\t\tlet mapImage = dataItem.mapImage;\r\n\t\t\tthis.mapImages.moveValue(mapImage);\r\n\t\t\tif ($type.isNumber(mapImage.latitude) && $type.isNumber(mapImage.latitude)) {\r\n\t\t\t\tdataItem.geoPoint = { latitude: mapImage.latitude, longitude: mapImage.longitude }\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * A list of map images in the series.\r\n\t *\r\n\t * @return Map images\r\n\t */\r\n\tpublic get mapImages(): ListTemplate<MapImage> {\r\n\r\n\t\tif (!this._mapImages) {\r\n\t\t\tlet template: MapImage = new MapImage();\r\n\t\t\tlet mapImages = new ListTemplate<MapImage>(template);\r\n\t\t\tthis._disposers.push(new ListDisposer(mapImages));\r\n\t\t\tthis._disposers.push(mapImages.template);\r\n\t\t\tmapImages.template.focusable = true;\r\n\t\t\tmapImages.events.on(\"inserted\", this.handleObjectAdded, this, false);\r\n\t\t\tthis._mapImages = mapImages;\r\n\t\t}\r\n\r\n\t\treturn this._mapImages;\r\n\t}\r\n\r\n\t/**\r\n\t * (Re)validates data element, effectively triggering its redrawal.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param dataItem  Data item\r\n\t */\r\n\tpublic validateDataElement(dataItem: this[\"_dataItem\"]) {\r\n\t\tsuper.validateDataElement(dataItem);\r\n\t\tdataItem.mapImage.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * (Re)validates the series\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validate() {\r\n\t\tsuper.validate();\r\n\t\t$iter.each(this.mapImages.iterator(), (mapImage) => {\r\n\t\t\tmapImage.validatePosition();\r\n\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t * Copies all properties from another instance of [[Series]].\r\n\t *\r\n\t * @param source  Source series\r\n\t */\r\n\tpublic copyFrom(source: this) {\r\n\t\tthis.mapImages.template.copyFrom(source.mapImages.template);\r\n\t\tsuper.copyFrom(source);\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"MapImageSeries\"] = MapImageSeries;\r\nregistry.registeredClasses[\"MapImageSeriesDataItem\"] = MapImageSeriesDataItem;\r\n\n\n\n// WEBPACK FOOTER //\n// ../../../../../src/.internal/charts/map/MapImageSeries.ts","/**\r\n * Map arc series module.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { MapLineSeries, MapLineSeriesDataItem, IMapLineSeriesProperties, IMapLineSeriesDataFields, IMapLineSeriesAdapters, IMapLineSeriesEvents } from \"./MapLineSeries\";\r\nimport { SpriteEventDispatcher, AMEvent } from \"../../core/Sprite\";\r\nimport { MapChart, MapLineType } from \"../types/MapChart\";\r\nimport { MapArc } from \"./MapArc\";\r\nimport { ListTemplate, IListEvents } from \"../../core/utils/List\";\r\nimport { IMapDataObject, IMapPolygonDataObject, IMapLineDataObject } from \"../types/MapChart\";\r\nimport { registry } from \"../../core/Registry\";\r\nimport { IDisposer, Disposer, MultiDisposer } from \"../../core/utils/Disposer\";\r\n\r\n/**\r\n * ============================================================================\r\n * DATA ITEM\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines a [[DataItem]] for [[MapArcSeries]].\r\n *\r\n * @see {@link DataItem}\r\n */\r\nexport class MapArcSeriesDataItem extends MapLineSeriesDataItem {\r\n\r\n\t/**\r\n\t * A [[MapArc]] element related to this data item.\r\n\t */\r\n\tpublic _mapLine: MapArc;\r\n\r\n\t/**\r\n\t * Defines a type of [[Component]] this data item is used for.\r\n\t */\r\n\tpublic _component!: MapArcSeries;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"MapArcSeriesDataItem\";\r\n\t\tthis.applyTheme();\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines data fields for [[MapArcSeries]].\r\n */\r\nexport interface IMapArcSeriesDataFields extends IMapLineSeriesDataFields { }\r\n\r\n/**\r\n * Defines properties for [[MapArcSeries]].\r\n */\r\nexport interface IMapArcSeriesProperties extends IMapLineSeriesProperties { }\r\n\r\n/**\r\n * Defines events for [[MapArcSeries]].\r\n */\r\nexport interface IMapArcSeriesEvents extends IMapLineSeriesEvents { }\r\n\r\n/**\r\n * Defines adapters for [[MapArcSeries]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface IMapArcSeriesAdapters extends IMapLineSeriesAdapters, IMapArcSeriesProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * A series of arc elements. (curved lines)\r\n *\r\n * @see {@link IMapArcSeriesEvents} for a list of available Events\r\n * @see {@link IMapArcSeriesAdapters} for a list of available Adapters\r\n * @important\r\n */\r\nexport class MapArcSeries extends MapLineSeries {\r\n\r\n\t/**\r\n\t * Defines available data fields.\r\n\t */\r\n\tpublic _dataFields: IMapArcSeriesDataFields;\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IMapArcSeriesProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IMapArcSeriesAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IMapArcSeriesEvents;\r\n\r\n\t/**\r\n\t * Defines the type of data item.\r\n\t */\r\n\tpublic _dataItem: MapArcSeriesDataItem;\r\n\r\n\t/**\r\n\t * Defines the type of the line items in this series.\r\n\t */\r\n\tpublic _mapLine: MapArc;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"MapArcSeries\";\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a new/empty DataItem of the type appropriate for this object.\r\n\t *\r\n\t * @see {@link DataItem}\r\n\t * @return Data Item\r\n\t */\r\n\tprotected createDataItem(): this[\"_dataItem\"] {\r\n\t\treturn new MapArcSeriesDataItem();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a new line instance of suitable type.\r\n\t *\r\n\t * @return New line\r\n\t */\r\n\tprotected createLine(): this[\"_mapLine\"] {\r\n\t\treturn new MapArc();\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"MapArcSeries\"] = MapArcSeries;\r\nregistry.registeredClasses[\"MapArcSeriesDataItem\"] = MapArcSeriesDataItem;\r\n\n\n\n// WEBPACK FOOTER //\n// ../../../../../src/.internal/charts/map/MapArcSeries.ts","/**\r\n * Functionality for Mercator projection\r\n *\r\n * The function(s) below are from D3.js library (https://d3js.org/)\r\n *\r\n * ```\r\n * Copyright 2017 Mike Bostock\r\n *\r\n * Redistribution and use in source and binary forms, with or without\r\n * modification, are permitted provided that the following conditions are met:\r\n *\r\n * 1. Redistributions of source code must retain the above copyright notice,\r\n *    this list of conditions and the following disclaimer.\r\n *\r\n * 2. Redistributions in binary form must reproduce the above copyright notice,\r\n *    this list of conditions and the following disclaimer in the documentation\r\n *    and/or other materials provided with the distribution.\r\n *\r\n * 3. Neither the name of the copyright holder nor the names of its\r\n *    contributors may be used to endorse or promote products derived from this\r\n *    software without specific prior written permission.\r\n *\r\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\r\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\r\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\r\n * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE\r\n * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\r\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\r\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\r\n * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\r\n * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n * POSSIBILITY OF SUCH DAMAGE.\r\n * ```\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Projection } from \"./Projection\";\r\nimport { IGeoPoint } from \"../../../core/defs/IGeoPoint\";\r\nimport { IPoint } from \"../../../core/defs/IPoint\";\r\nimport { registry } from \"../../../core/Registry\";\r\n\r\n/**\r\n * Mercator projection.\r\n */\r\nexport class Mercator extends Projection {\r\n\r\n\t/**\r\n\t * Converts screen coordinates to latitude/longitude in radians\r\n\t * @param x  X\r\n\t * @param y  Y\r\n\t * @return Geographical coordinates\r\n\t */\r\n\tpublic unproject(x: number, y: number): IGeoPoint {\r\n\t\treturn {\r\n\t\t\tlongitude: x,\r\n\t\t\tlatitude: 2 * Math.atan(Math.exp(y)) - Math.PI / 2\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Converts geographical coordinates to screen coordinates.\r\n\t *\r\n\t * @param lambda  Lambda parameter\r\n\t * @param phi     Phi parameter\r\n\t * @return Screen coordinates\r\n\t */\r\n\tpublic project(lambda: number, phi: number): IPoint {\r\n\t\treturn {\r\n\t\t\tx: lambda,\r\n\t\t\ty: Math.log(Math.tan((Math.PI / 2 + phi) / 2))\r\n\t\t};\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"Mercator\"] = Mercator;\r\n\n\n\n// WEBPACK FOOTER //\n// ../../../../../../src/.internal/charts/map/projections/Mercator.ts","/**\n * Functionality for Miller projection\n *\n * The function(s) below are from D3.js library (https://d3js.org/)\n *\n * ```\n * Copyright 2017 Mike Bostock\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice,\n *    this list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * 3. Neither the name of the copyright holder nor the names of its\n *    contributors may be used to endorse or promote products derived from this\n *    software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE\n * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\n * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\n * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n * POSSIBILITY OF SUCH DAMAGE.\n * ```\n */\n\n/**\n * ============================================================================\n * IMPORTS\n * ============================================================================\n * @hidden\n */\nimport { Projection } from \"./Projection\";\nimport { IGeoPoint } from \"../../../core/defs/IGeoPoint\";\nimport { IPoint } from \"../../../core/defs/IPoint\";\nimport { registry } from \"../../../core/Registry\";\n\n/**\n * Miller projection.\n */\nexport class Miller extends Projection {\n\n\t/**\n\t * Converts screen coordinates to latitude/longitude.\n\t *\n\t * @param x  X\n\t * @param y  Y\n\t * @return Geographical coordinates in radians\n\t */\n\tpublic unproject(x: number, y: number): IGeoPoint {\n\t\treturn {\n\t\t\tlongitude: x,\n\t\t\tlatitude: 2.5 * Math.atan(Math.exp(0.8 * y)) - 0.625 * Math.PI\n\t\t};\n\t}\n\n\t/**\n\t * Converts geographical coordinates to screen coordinates.\n\t *\n\t * @param lambda  Lambda parameter\n\t * @param phi     Phi parameter\n\t * @return Screen coordinates\n\t */\n\tpublic project(lambda: number, phi: number): IPoint {\n\t\treturn {\n\t\t\tx: lambda,\n\t\t\ty: 1.25 * Math.log(Math.tan(Math.PI / 4 + 0.4 * phi))\n\t\t};\n\t}\n\n}\n\n/**\n * Register class in system, so that it can be instantiated using its name from\n * anywhere.\n *\n * @ignore\n */\nregistry.registeredClasses[\"Miller\"] = Miller;\n\n\n\n// WEBPACK FOOTER //\n// ../../../../../../src/.internal/charts/map/projections/Miller.ts","/**\r\n * Functionality for Eckert6 projection\r\n *\r\n * The function(s) below are from D3.js library (https://d3js.org/)\r\n *\r\n * ```\r\n * Copyright 2017 Mike Bostock\r\n *\r\n * Redistribution and use in source and binary forms, with or without\r\n * modification, are permitted provided that the following conditions are met:\r\n *\r\n * 1. Redistributions of source code must retain the above copyright notice,\r\n *    this list of conditions and the following disclaimer.\r\n *\r\n * 2. Redistributions in binary form must reproduce the above copyright notice,\r\n *    this list of conditions and the following disclaimer in the documentation\r\n *    and/or other materials provided with the distribution.\r\n *\r\n * 3. Neither the name of the copyright holder nor the names of its\r\n *    contributors may be used to endorse or promote products derived from this\r\n *    software without specific prior written permission.\r\n *\r\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\r\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\r\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\r\n * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE\r\n * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\r\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\r\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\r\n * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\r\n * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n * POSSIBILITY OF SUCH DAMAGE.\r\n * ```\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Projection } from \"./Projection\";\r\nimport { IGeoPoint } from \"../../../core/defs/IGeoPoint\";\r\nimport { IPoint } from \"../../../core/defs/IPoint\";\r\nimport { registry } from \"../../../core/Registry\";\r\n\r\n/**\r\n * Eckert6 projection.\r\n */\r\nexport class Eckert6 extends Projection {\r\n\r\n\t/**\r\n\t * Converts screen coordinates to latitude/longitude.\r\n\t *\r\n\t * @param x  X\r\n\t * @param y  Y\r\n\t * @return Geographical coordinates in radians\r\n\t */\r\n\tpublic unproject(x: number, y: number): IGeoPoint {\r\n\t\tlet j = 1 + Math.PI / 2,\r\n\t\t\tk = Math.sqrt(j / 2);\r\n\t\treturn {\r\n\t\t\tlongitude: x * 2 * k / (1 + Math.cos(y *= k)),\r\n\t\t\tlatitude: Math.asin((y + Math.sin(y)) / j)\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Converts geographical coordinates to screen coordinates.\r\n\t *\r\n\t * @param lambda  Lambda parameter\r\n\t * @param phi     Phi parameter\r\n\t * @return Screen coordinates\r\n\t */\r\n\tpublic project(lambda: number, phi: number): IPoint {\r\n\t\tlet k = (1 + Math.PI / 2) * Math.sin(phi);\r\n\t\tfor (let i = 0, delta = Infinity; i < 10 && Math.abs(delta) > 0.00001; i++) {\r\n\t\t\tphi -= delta = (phi + Math.sin(phi) - k) / (1 + Math.cos(phi));\r\n\t\t}\r\n\t\tk = Math.sqrt(2 + Math.PI);\r\n\t\treturn {\r\n\t\t\tx: lambda * (1 + Math.cos(phi)) / k,\r\n\t\t\ty: 2 * phi / k\r\n\t\t};\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"Eckert6\"] = Eckert6;\r\n\n\n\n// WEBPACK FOOTER //\n// ../../../../../../src/.internal/charts/map/projections/Eckert6.ts","/**\r\n * Functionality for Mercator projection\r\n *\r\n * The function(s) below are from D3.js library (https://d3js.org/)\r\n *\r\n * ```\r\n * Copyright 2017 Mike Bostock\r\n *\r\n * Redistribution and use in source and binary forms, with or without\r\n * modification, are permitted provided that the following conditions are met:\r\n *\r\n * 1. Redistributions of source code must retain the above copyright notice,\r\n *    this list of conditions and the following disclaimer.\r\n *\r\n * 2. Redistributions in binary form must reproduce the above copyright notice,\r\n *    this list of conditions and the following disclaimer in the documentation\r\n *    and/or other materials provided with the distribution.\r\n *\r\n * 3. Neither the name of the copyright holder nor the names of its\r\n *    contributors may be used to endorse or promote products derived from this\r\n *    software without specific prior written permission.\r\n *\r\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\r\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\r\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\r\n * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE\r\n * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\r\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\r\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\r\n * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\r\n * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n * POSSIBILITY OF SUCH DAMAGE.\r\n * ```\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Projection } from \"./Projection\";\r\nimport { IGeoPoint } from \"../../../core/defs/IGeoPoint\";\r\nimport { IGeoRectangle } from \"../../../core/defs/IGeoRectangle\";\r\nimport { IPoint } from \"../../../core/defs/IPoint\";\r\nimport { registry } from \"../../../core/Registry\";\r\nimport * as $math from \"../../../core/utils/Math\";\r\n\r\n/**\r\n * Orthographic projection.\r\n */\r\nexport class Orthographic extends Projection {\r\n\r\n\t/**\r\n\t * Converts geographical coordinates to screen coordinates.\r\n\t *\r\n\t * @param lambda  Lambda parameter\r\n\t * @param phi     Phi parameter\r\n\t * @return Screen coordinates\r\n\t */\r\n\tpublic project(lambda: number, phi: number): IPoint {\r\n\t\treturn { x: Math.cos(phi) * Math.sin(lambda), y: Math.sin(phi) };\r\n\t}\r\n\r\n\r\n\tpublic getClipRectangle1(): IGeoPoint[] {\r\n\t\tlet longitude = 90 - this.deltaLongitude;\r\n\t\tlet latitude = -this.deltaLatitude;\r\n\r\n\t\tlet smallNum = 0.00001;\r\n\t\treturn [{ longitude: longitude - 180, latitude: latitude - 90 }, { longitude: longitude - smallNum, latitude: latitude - 90 }, { longitude: longitude - smallNum, latitude: latitude + 90 }, { longitude: longitude - 180, latitude: latitude + 90 }];\r\n\t}\r\n\r\n\r\n\tpublic getRect1(): IGeoRectangle {\r\n\t\tlet longitude = 90 - this.deltaLongitude;\r\n\t\tlet latitude = -this.deltaLatitude;\r\n\r\n\t\treturn { north: latitude + 90, south: latitude - 90, west: longitude - 180, east: longitude };\r\n\t}\r\n\r\n\tpublic getClipRectangle2(): IGeoPoint[] {\r\n\t\tlet longitude = 90 - this.deltaLongitude;\r\n\t\tlet latitude = -this.deltaLatitude;\r\n\r\n\t\tlet smallNum = 0.00001;\r\n\r\n\t\tlet delta: number;\r\n\r\n\t\tif (longitude > 0) {\r\n\t\t\tdelta = -360;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdelta = 360;\r\n\t\t}\r\n\r\n\t\treturn [{ longitude: smallNum + longitude - 180 + delta, latitude: latitude - 90 }, { longitude: longitude - smallNum + delta, latitude: latitude - 90 }, { longitude: longitude - smallNum + delta, latitude: latitude + 90 }, { longitude: smallNum + longitude - 180 + delta, latitude: latitude + 90 }];\r\n\t}\r\n\r\n\r\n\r\n\tpublic getRect2(): IGeoRectangle {\r\n\t\tlet longitude = 90 - this.deltaLongitude;\r\n\t\tlet latitude = -this.deltaLatitude;\r\n\r\n\t\tlet delta: number;\r\n\r\n\t\tif (longitude > 0) {\r\n\t\t\tdelta = -360;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdelta = 360;\r\n\t\t}\r\n\t\treturn { north: latitude + 90, south: latitude - 90, west: longitude - 180 + delta, east: longitude + delta };\r\n\t}\r\n\r\n\r\n\r\n\tprotected clipGeoArea(geoArea: IGeoPoint[][][]): IGeoPoint[][][] {\r\n\t\tif (!geoArea) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet clippedArea: IGeoPoint[][][] = [];\r\n\r\n\t\tlet clipRectangle1 = this.getClipRectangle1();\r\n\t\tlet clipRectangle2 = this.getClipRectangle2();\r\n\r\n\t\tlet rect1 = this.getRect1();\r\n\t\tlet rect2 = this.getRect2();\r\n\r\n\t\tfor (let i = 0, len = geoArea.length; i < len; i++) {\r\n\r\n\t\t\tlet surface: IGeoPoint[] = geoArea[i][0];\r\n\t\t\tlet hole: IGeoPoint[] = geoArea[i][1];\r\n\r\n\t\t\tlet clippedAreas: IGeoPoint[][][] = [];\r\n\r\n\t\t\tif (surface) {\r\n\r\n\t\t\t\tlet surfaceRect = this.getExtremes(surface);\r\n\r\n\t\t\t\tif (!this.isInside(surfaceRect, rect1) && !this.isOutside(surfaceRect, rect1)) {\r\n\t\t\t\t\tlet clippedSurface1: IGeoPoint[] = this.clip(surface, clipRectangle1);\r\n\t\t\t\t\tlet clippedHole1: IGeoPoint[] = this.clip(hole, clipRectangle1);\r\n\t\t\t\t\tclippedAreas.push([clippedSurface1, clippedHole1]);\r\n\t\t\t\t}\r\n\t\t\t\telse if (this.isInside(surfaceRect, rect1)) {\r\n\t\t\t\t\tclippedAreas.push([surface, hole]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!this.isInside(surfaceRect, rect2) && !this.isOutside(surfaceRect, rect2)) {\r\n\t\t\t\t\tlet clippedSurface2: IGeoPoint[] = this.clip(surface, clipRectangle2);\r\n\t\t\t\t\tlet clippedHole2: IGeoPoint[] = this.clip(hole, clipRectangle2);\r\n\r\n\t\t\t\t\tclippedAreas.push([clippedSurface2, clippedHole2]);\r\n\t\t\t\t}\r\n\t\t\t\telse if (this.isInside(surfaceRect, rect2)) {\r\n\t\t\t\t\tclippedAreas.push([surface, hole]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (let area of clippedAreas) {\r\n\t\t\t\tclippedArea.push(area);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (let i = 0, len = clippedArea.length; i < len; i++) {\r\n\r\n\t\t\tlet surface: IGeoPoint[] = clippedArea[i][0];\r\n\t\t\t//let hole: IGeoPoint[] = clippedArea[i][1];\r\n\r\n\t\t\tif (surface) {\r\n\r\n\t\t\t\tlet len = surface.length;\r\n\r\n\t\t\t\tlet prevPoint = surface[len - 1];\r\n\r\n\t\t\t\tfor (let i = 0; i < len; i++) {\r\n\t\t\t\t\tlet point = surface[i];\r\n\r\n\t\t\t\t\tif ($math.round(point.longitude, 4) == $math.round(prevPoint.longitude, 4)) {\r\n\t\t\t\t\t\tlet stepCount = Math.abs((prevPoint.latitude - point.latitude) * 2);\r\n\t\t\t\t\t\tlet extraPoints: IGeoPoint[] = [];\r\n\r\n\t\t\t\t\t\tif (stepCount > 1) {\r\n\t\t\t\t\t\t\tfor (let s = 1; s < stepCount; s++) {\r\n\t\t\t\t\t\t\t\textraPoints.push({ longitude: prevPoint.longitude, latitude: prevPoint.latitude + (point.latitude - prevPoint.latitude) / stepCount * s })\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tsurface.splice(i, 0, ...extraPoints);\r\n\t\t\t\t\t\t\ti = i + extraPoints.length;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tprevPoint = point;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn clippedArea;\r\n\t}\r\n\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"Orthographic\"] = Orthographic;\r\n\n\n\n// WEBPACK FOOTER //\n// ../../../../../../src/.internal/charts/map/projections/Orthographic.ts","import * as m from \"../es2015/maps\";\nwindow.am4maps = m;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./maps.js\n// module id = null\n// module chunks = ","/**\r\n * A module for the mini-map control.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Container, IContainerProperties, IContainerAdapters, IContainerEvents } from \"../../core/Container\";\r\nimport { Sprite, ISpriteEvents, SpriteEventDispatcher, AMEvent } from \"../../core/Sprite\";\r\nimport { Rectangle } from \"../../core/elements/Rectangle\";\r\nimport { IPoint } from \"../../core/defs/IPoint\";\r\nimport { IGeoPoint } from \"../../core/defs/IGeoPoint\";\r\nimport { MapChart } from \"../types/MapChart\";\r\nimport { MapSeries } from \"./MapSeries\";\r\nimport { List, IListEvents } from \"../../core/utils/List\";\r\nimport { MutableValueDisposer, MultiDisposer } from \"../../core/utils/Disposer\";\r\nimport { registry } from \"../../core/Registry\";\r\nimport { color } from \"../../core/utils/Color\";\r\nimport { InterfaceColorSet } from \"../../core/utils/InterfaceColorSet\";\r\nimport * as $utils from \"../../core/utils/Utils\";\r\nimport * as $type from \"../../core/utils/Type\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines properties for [[SmallMap]].\r\n */\r\nexport interface ISmallMapProperties extends IContainerProperties { }\r\n\r\n/**\r\n * Defines events for [[SmallMap]].\r\n */\r\nexport interface ISmallMapEvents extends IContainerEvents { }\r\n\r\n/**\r\n * Defines adapters for [[SmallMap]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface ISmallMapAdapters extends IContainerAdapters, ISmallMapProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Creates a \"bird's eye\" view of the whole map.\r\n *\r\n * This control creates a mini-map with the whole of the map, highlighting\r\n * the area which is in the current viewport of the map map.\r\n *\r\n * @see {@link ISmallMapEvents} for a list of available events\r\n * @see {@link ISmallMapAdapters} for a list of available Adapters\r\n * @important\r\n */\r\nexport class SmallMap extends Container {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: ISmallMapProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: ISmallMapAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: ISmallMapEvents;\r\n\r\n\t/**\r\n\t * A target map.\r\n\t */\r\n\tprotected _chart: MutableValueDisposer<MapChart> = new MutableValueDisposer<MapChart>();\r\n\r\n\t/**\r\n\t * A container that holds the visual elements for the mini-map.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic seriesContainer: Container;\r\n\r\n\t/**\r\n\t * The rectangle element which highlights current viewport.\r\n\t */\r\n\tpublic rectangle: Rectangle;\r\n\r\n\t/**\r\n\t * A list of map series used to draw the mini-map.\r\n\t */\r\n\tprotected _series: List<MapSeries>;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\r\n\t\t// Init\r\n\t\tsuper();\r\n\t\tthis.className = \"SmallMap\";\r\n\r\n\t\t// Set defaults\r\n\t\tthis.align = \"left\";\r\n\t\tthis.valign = \"bottom\";\r\n\t\tthis.percentHeight = 20;\r\n\t\tthis.percentWidth = 20;\r\n\t\tthis.margin(5, 5, 5, 5);\r\n\r\n\t\tlet interfaceColors = new InterfaceColorSet();\r\n\r\n\t\t// Set background defailts\r\n\t\tthis.background.fillOpacity = 0.9;\r\n\t\tthis.background.fill = interfaceColors.getFor(\"background\");\r\n\r\n\t\t// Set up events\r\n\t\tthis.events.on(\"hit\", this.moveToPosition, this, false);\r\n\t\tthis.events.on(\"maxsizechanged\", this.updateMapSize, this, false);\r\n\r\n\t\t// Create a container\r\n\t\tthis.seriesContainer = this.createChild(Container);\r\n\t\tthis.seriesContainer.shouldClone = false;\r\n\r\n\t\t// Create an outline rectangle\r\n\t\tlet rectangle: Rectangle = this.createChild(Rectangle);\r\n\t\trectangle.shouldClone = false;\r\n\t\trectangle.stroke = interfaceColors.getFor(\"alternativeBackground\");\r\n\t\trectangle.strokeWidth = 1;\r\n\t\trectangle.strokeOpacity = 0.5;\r\n\t\trectangle.fill = color(); //\"none\";\r\n\t\trectangle.verticalCenter = \"middle\";\r\n\t\trectangle.horizontalCenter = \"middle\";\r\n\t\trectangle.isMeasured = false;\r\n\t\tthis.rectangle = rectangle;\r\n\r\n\t\tthis._disposers.push(this._chart);\r\n\r\n\t\t// Apply theme\r\n\t\tthis.applyTheme();\r\n\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * A list of map series used to draw the mini-map.\r\n\t *\r\n\t * @readonly\r\n\t * @return Series\r\n\t */\r\n\tpublic get series(): List<MapSeries> {\r\n\t\tif (!this._series) {\r\n\t\t\tthis._series = new List<MapSeries>();\r\n\t\t\tthis._series.events.on(\"inserted\", this.handleSeriesAdded, this, false);\r\n\t\t\tthis._series.events.on(\"removed\", this.handleSeriesRemoved, this, false);\r\n\t\t}\r\n\t\treturn this._series;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Decorates a new series when they are pushed into a `series` list.\r\n\t *\r\n\t * @param event Event\r\n\t */\r\n\tprotected handleSeriesAdded(event: IListEvents<MapSeries>[\"inserted\"]) {\r\n\t\tlet series: MapSeries = event.newValue;\r\n\t\tif (this.chart.series.contains(series)) {\r\n\t\t\tlet newSeries = series.clone();\r\n\t\t\tthis._series.removeValue(series);\r\n\t\t\tthis._series.push(newSeries);\r\n\t\t\tseries = newSeries;\r\n\r\n\t\t\tthis.chart.dataUsers.push(newSeries);\r\n\t\t}\r\n\t\tseries.chart = this.chart;\r\n\t\tseries.parent = this.seriesContainer;\r\n\t\tseries.interactionsEnabled = false;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Cleans up after series are removed from Scrollbar.\r\n\t *\r\n\t * @param event  Event\r\n\t */\r\n\tprotected handleSeriesRemoved(event: IListEvents<MapSeries>[\"removed\"]) {\r\n\t\t//let sourceSeries: MapSeries = event.oldValue;\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * Moves main map pan position after click on the small map.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param event  Event\r\n\t */\r\n\tpublic moveToPosition(event: AMEvent<Sprite, ISpriteEvents>[\"hit\"]) {\r\n\t\tlet rectPoint: IPoint = $utils.spritePointToSprite(event.spritePoint, this, this.seriesContainer);\r\n\t\tlet geoPoint: IGeoPoint = this.chart.seriesPointToGeo(rectPoint);\r\n\t\tthis.chart.zoomToGeoPoint(geoPoint, this.chart.zoomLevel, true);\r\n\t}\r\n\r\n\t/**\r\n\t * A chart/map that this control is meant for.\r\n\t *\r\n\t * @param chart  Chart/map\r\n\t */\r\n\tpublic set chart(chart: MapChart) {\r\n\t\tif (this.chart != chart) {\r\n\t\t\tthis._chart.set(chart, new MultiDisposer([\r\n\t\t\t\t//chart.events.on(\"zoomlevelchanged\", this.updateRectangle, this, false),\r\n\t\t\t\tchart.events.on(\"mappositionchanged\", this.updateRectangle, this, false),\r\n\t\t\t\tchart.events.on(\"scaleratiochanged\", this.updateMapSize, this, false)\r\n\t\t\t]));\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Chart/map\r\n\t */\r\n\tpublic get chart(): MapChart {\r\n\t\treturn this._chart.get();\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the viewport recangle as per current map zoom/pan position.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic updateRectangle(): void {\r\n\t\tlet chart: MapChart = this.chart;\r\n\t\tlet zoomLevel: number = chart.zoomLevel;\r\n\t\tlet rectangle: Rectangle = this.rectangle;\r\n\r\n\t\trectangle.width = this.pixelWidth / zoomLevel;\r\n\t\trectangle.height = this.pixelHeight / zoomLevel;\r\n\r\n\t\tlet scale: number = Math.min(this.percentWidth, this.percentHeight) / 100;\r\n\r\n\t\tlet seriesContainer: Container = chart.seriesContainer;\r\n\r\n\t\trectangle.x = Math.ceil((zoomLevel * seriesContainer.pixelWidth / 2 - seriesContainer.pixelX) * scale / zoomLevel)// + rectangle.pixelWidth / 2);\r\n\t\trectangle.y = Math.ceil((zoomLevel * seriesContainer.pixelHeight / 2 - seriesContainer.pixelY) * scale / zoomLevel)// + rectangle.pixelHeight / 2);\r\n\r\n\t\trectangle.validate();\r\n\t}\r\n\r\n\t/**\r\n\t * Update map size so that internal elements can redraw themselves after\r\n\t * the size of the small map changes.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic updateMapSize(): void {\r\n\t\tif (this.chart) {\r\n\t\t\tthis.seriesContainer.scale = this.chart.scaleRatio * Math.min(this.percentWidth, this.percentHeight) / 100;\r\n\t\t\tthis.updateRectangle();\r\n\t\t\tthis.afterDraw();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Update elements after drawing the small map.\r\n\t */\r\n\tprotected afterDraw(): void {\r\n\t\tsuper.afterDraw();\r\n\t\tthis.seriesContainer.moveTo({ x: this.pixelWidth / 2, y: this.pixelHeight / 2 });\r\n\t\tthis.rectangle.maskRectangle = { x: -1, y: -1, width: Math.ceil(this.pixelWidth + 2), height: Math.ceil(this.pixelHeight + 2) };\r\n\t}\r\n\r\n\t/**\r\n\t * Processes JSON-based config before it is applied to the object.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param config  Config\r\n\t */\r\n\tpublic processConfig(config?: { [index: string]: any }): void {\r\n\r\n\t\tif (config) {\r\n\r\n\t\t\t// Set up series\r\n\t\t\tif ($type.hasValue(config.series) && $type.isArray(config.series)) {\r\n\t\t\t\tfor (let i = 0, len = config.series.length; i < len; i++) {\r\n\t\t\t\t\tlet series = config.series[i];\r\n\t\t\t\t\tif ($type.hasValue(series) && $type.isString(series) && this.map.hasKey(series)) {\r\n\t\t\t\t\t\tconfig.series[i] = this.map.getKey(series);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tsuper.processConfig(config);\r\n\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"SmallMap\"] = SmallMap;\r\n\n\n\n// WEBPACK FOOTER //\n// ../../../../../src/.internal/charts/map/SmallMap.ts"],"sourceRoot":""}